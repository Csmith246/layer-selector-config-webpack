(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/sql/WhereClause":769,"esri/tasks/operations/PBFWorker":770,"esri/renderers/support/utils":827,"esri/renderers/visualVariables/support/ColorStop":836,"esri/renderers/support/numberUtils":837,"esri/layers/support/commonProperties":838,"esri/layers/support/Field":851,"esri/tasks/support/QuantizationParameters":853,"esri/layers/mixins/OperationalLayer":856,"esri/tasks/support/Query":891,"esri/symbols/support/ElevationInfo":892,"esri/geometry/support/normalizeUtils":893,"esri/symbols/support/FeatureExpressionInfo":894,"esri/symbols/support/unitConversionUtils":895,"esri/tasks/support/StatisticDefinition":896,"esri/core/pbf":900,"esri/tasks/geometry/cut":1002,"esri/tasks/geometry/simplify":1003,"esri/tasks/operations/urlUtils":1037,"esri/tasks/Task":1043,"esri/geometry/support/aaBoundingBox":1046,"esri/renderers/visualVariables/support/visualVariableUtils":1056,"esri/tasks/operations/query":1070,"esri/tasks/operations/pbfQueryUtils":1074,"esri/arcade/featureset/support/shared":1077,"esri/arcade/featureset/support/IdSet":1107,"esri/layers/support/AttachmentInfo":1110,"esri/tasks/operations/queryAttachments":1111,"esri/arcade/featureset/support/FeatureSet":1114,"esri/arcade/featureset/support/sqlUtils":1115,"esri/layers/graphics/dehydratedFeatures":1119,"esri/layers/graphics/dehydratedFeatureComparison":1120,"esri/layers/support/exifUtils":1123,"esri/tasks/QueryTask":1124,"esri/tasks/operations/queryRelatedRecords":1125,"esri/core/sql/AggregateFunctions":1140,"esri/core/sql/StandardizedFunctions":1141,"esri/core/sql/WhereGrammar":1142,"esri/core/sql/sql92grammar":1143,"esri/tasks/operations/pbfFeatureServiceParser":1146,"esri/tasks/operations/pbfDehydratedFeatureSet":1147,"esri/tasks/operations/pbfOptimizedFeatureSet":1148,"esri/core/MD5":1173,"esri/geometry/geometryEngineAsync":1207,"esri/workers/WorkerClient":1332,"esri/arcade/featureset/support/stats":1333,"esri/arcade/featureset/actions/OrderBy":1334,"esri/arcade/featureset/support/OrderbyClause":1335,"esri/arcade/featureset/sources/Empty":1336,"esri/arcade/featureset/actions/AttributeFilter":1337,"esri/arcade/featureSetUtils":1468,"esri/arcade/featureSetCollection":1469,"esri/arcade/featureset/support/cache":1470,"esri/arcade/featureset/sources/FeatureLayerMemory":1471,"esri/arcade/featureset/actions/Top":1472,"esri/arcade/featureset/actions/SpatialFilter":1473,"esri/arcade/featureset/actions/Adapted":1474,"esri/arcade/featureset/sources/FeatureLayerDynamic":1978,"esri/arcade/featureset/support/FeatureSetIterator":1979,"esri/arcade/featureset/sources/FeatureLayerRelated":1980,"esri/arcade/featureset/actions/GroupBy":1981,"esri/arcade/featureset/support/StatsField":1982,"esri/arcade/functions/featuresetbase":1983,"esri/arcade/functions/featuresetgeom":1984,"esri/arcade/functions/featuresetstats":1985,"esri/arcade/functions/featuresetstring":1986})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[56,7,8,31,89,90,91,92,93,94],{1002:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(11),r(10),r(32),r(76),r(36),r(35)],void 0===(a=function(e,t,r,n,a,i,o,s,u){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,l,c){return n(this,void 0,void 0,(function(){var n,p,f,d,h,y,v;return a(this,(function(a){switch(a.label){case 0:return n="string"==typeof e?s.urlToObject(e):e,p=t[0].spatialReference,f=r({},c,{query:r({},n.query,{f:"json",sr:JSON.stringify(p),target:JSON.stringify({geometryType:u.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(l)})}),[4,o(n.path+"/cut",f)];case 1:return d=a.sent(),h=d.data,y=h.cutIndexes,v=h.geometries,[2,{cutIndexes:y,geometries:(void 0===v?[]:v).map((function(e){return i.fromJSON(e).set(p)}))}]}}))}))}}.apply(null,n))||(e.exports=a)},1003:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(11),r(10),r(76),r(36),r(35)],void 0===(a=function(e,t,r,n,a,i,o,s){function u(e){return{geometryType:s.getJsonType(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}function l(e,t,r){var n=s.getGeometryType(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))}Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,c){return n(this,void 0,void 0,(function(){var n,p,f,d;return a(this,(function(a){switch(a.label){case 0:return n="string"==typeof e?o.urlToObject(e):e,p=t[0].spatialReference,f=s.getJsonType(t[0]),d=r({},c,{query:r({},n.query,{f:"json",sr:p.wkid?p.wkid:JSON.stringify(p),geometries:JSON.stringify(u(t))})}),[4,i(n.path+"/simplify",d)];case 1:return[2,l(a.sent().data,f,p)]}}))}))}}.apply(null,n))||(e.exports=a)},1037:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var a=t[n];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){r[n]=[];for(var i=0;i<a.length;i++)r[n][i]=e(a[i])}else"object"==typeof a?a.toJSON&&(r[n]=JSON.stringify(a)):r[n]=a}return r}}.apply(null,n))||(e.exports=a)},1043:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(103),r(8),r(7),r(36),r(2)],void 0===(a=function(e,t,r,n,a,i,o,s,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.requestOptions=null,r.url=null,r}return r(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"!=typeof e?e:i({url:e},t)},Object.defineProperty(t.prototype,"parsedUrl",{get:function(){return this._parseUrl(this.url)},enumerable:!0,configurable:!0}),t.prototype._parseUrl=function(e){return e?s.urlToObject(e):null},t.prototype._encode=function(e,t,r){var n={};for(var a in e)if("declaredClass"!==a){var i=e[a];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){n[a]=[];for(var o=0;o<i.length;o++)n[a][o]=this._encode(i[o])}else if("object"==typeof i)if(i.toJSON){var s=i.toJSON(r&&r[a]);n[a]=t?s:JSON.stringify(s)}else n[a]=t?i:JSON.stringify(i);else n[a]=i}return n},n([u.property({readOnly:!0,dependsOn:["url"]})],t.prototype,"parsedUrl",null),n([u.property()],t.prototype,"requestOptions",void 0),n([u.property({type:String})],t.prototype,"url",void 0),n([u.subclass("esri.tasks.Task")],t)}(u.declared(o))}.apply(null,n))||(e.exports=a)},1046:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(15),r(30),r(236)],void 0===(a=function(e,t,r,n,a){function i(e){return void 0===e&&(e=t.ZERO),[e[0],e[1],e[2],e[3],e[4],e[5]]}function o(e,t,r,n,a,o,s){return void 0===s&&(s=i()),s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=a,s[5]=o,s}function s(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function l(e){return e[2]>=e[5]?0:e[5]-e[2]}function c(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function f(e){return 6===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.fromValues=o,t.fromExtent=function(e,t){return void 0===t&&(t=i()),t[0]=e.xmin,t[1]=e.ymin,t[2]=e.zmin,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.zmax,t},t.toExtent=function(e,t){var r=isFinite(e[2])||isFinite(e[5]);return new n(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})},t.fromMinMax=function(e,t,r){return void 0===r&&(r=i()),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},t.expandPointInPlace=function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[3]&&(e[3]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[4]&&(e[4]=t[1]),t[2]<e[2]&&(e[2]=t[2]),t[2]>e[5]&&(e[5]=t[2])},t.expand=function(e,t,r){return void 0===r&&(r=e),f(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5])):a.is(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[2]),r[4]=Math.max(e[4],t[3])):2===t.length?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1])):3===t.length&&(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2])),r},t.expandWithBuffer=function(e,t,r,n,a){void 0===r&&(r=0),void 0===n&&(n=t.length/3),void 0===a&&(a=e);for(var i=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],p=0;p<n;p++)i=Math.min(i,t[r+3*p]),o=Math.min(o,t[r+3*p+1]),s=Math.min(s,t[r+3*p+2]),u=Math.max(u,t[r+3*p]),l=Math.max(l,t[r+3*p+1]),c=Math.max(c,t[r+3*p+2]);return a[0]=i,a[1]=o,a[2]=s,a[3]=u,a[4]=l,a[5]=c,a},t.expandWithOffset=function(e,t,r,n,a){return void 0===a&&(a=e),a[0]=Math.min(e[0],e[0]+t),a[3]=Math.max(e[3],e[3]+t),a[1]=Math.min(e[1],e[1]+r),a[4]=Math.max(e[4],e[4]+r),a[2]=Math.min(e[2],e[2]+n),a[5]=Math.max(e[5],e[5]+n),a},t.expandWithNestedArray=function(e,t,r,n){void 0===n&&(n=e);var a=t.length,i=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5];if(r)for(var p=0;p<a;p++){var f=t[p];i=Math.min(i,f[0]),o=Math.min(o,f[1]),s=Math.min(s,f[2]),u=Math.max(u,f[0]),l=Math.max(l,f[1]),c=Math.max(c,f[2])}else for(p=0;p<a;p++)f=t[p],i=Math.min(i,f[0]),o=Math.min(o,f[1]),u=Math.max(u,f[0]),l=Math.max(l,f[1]);return n[0]=i,n[1]=o,n[2]=s,n[3]=u,n[4]=l,n[5]=c,n},t.allFinite=function(e){for(var t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},t.width=s,t.depth=u,t.height=l,t.diameter=function(e){var t=s(e),r=l(e),n=u(e);return Math.sqrt(t*t+r*r+n*n)},t.center=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=e[0]+s(e)/2,t[1]=e[1]+u(e)/2,t[2]=e[2]+l(e)/2,t},t.size=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=s(e),t[1]=u(e),t[2]=l(e),t},t.maximumDimension=function(e){return Math.max(s(e),l(e),u(e))},t.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},t.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},t.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},t.intersects=c,t.intersectsClippingArea=function(e,t){return!!r.isNone(t)||c(e,t)},t.offset=function(e,t,r,n,a){return void 0===a&&(a=e),a[0]=e[0]+t,a[1]=e[1]+r,a[2]=e[2]+n,a[3]=e[3]+t,a[4]=e[4]+r,a[5]=e[5]+n,a},t.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},t.setMin=function(e,t,r){return void 0===r&&(r=e),r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},t.setMax=function(e,t,r){return void 0===r&&(r=e),r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},t.set=p,t.empty=function(e){return e?p(e,t.NEGATIVE_INFINITY):i(t.NEGATIVE_INFINITY)},t.toRect=function(e,t){return t||(t=a.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},t.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},t.is=f,t.isPoint=function(e){return 0===s(e)&&0===u(e)&&0===l(e)},t.equals=function(e,t,n){if(r.isNone(e)||r.isNone(t))return e===t;if(!f(e)||!f(t))return!1;if(n){for(var a=0;a<e.length;a++)if(!n(e[a],t[a]))return!1}else for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0},t.wrap=function(e,t,r,n,a,i){return o(e,t,r,n,a,i,d)},t.POSITIVE_INFINITY=[-1/0,-1/0,-1/0,1/0,1/0,1/0],t.NEGATIVE_INFINITY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],t.ZERO=[0,0,0,0,0,0];var d=i()}.apply(null,n))||(e.exports=a)},1056:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(38),r(240),r(29),r(5),r(15),r(827),r(889)],void 0===(a=function(e,t,r,n,a,i,o,s,u){Object.defineProperty(t,"__esModule",{value:!0});var l=i.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),c=new n,p=Math.PI;function f(e,t,n){var a="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"color"===e.type}))[0]:e;if(a)if("esri.renderers.visualVariables.ColorVariable"===a.declaredClass){var i="number"==typeof t,s=i?null:t,u=s&&s.attributes,c=i?t:null,p=a.field,f=a.cache,d=f.ipData,h=f.hasExpression,y=a.cache.compiledFunc;if(!p&&!h){var v=a.stops;return v&&v[0]&&v[0].color}if("number"!=typeof c)if(h){if(!o.isSome(n)||!o.isSome(n.arcade))return void l.error("Use of arcade expressions requires an arcade context");var g={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},m=n.arcade.arcadeUtils,S=m.getViewInfo(g),b=m.createExecContext(s,S);if(!y){var w=m.createSyntaxTree(a.valueExpression);y=m.createFunction(w),a.cache.compiledFunc=y}c=m.executeFunction(y,b)}else u&&(c=u[p]);var F=a.normalizationField,x=u?parseFloat(u[F]):void 0;if(null!=c&&(!F||i||!isNaN(x)&&0!==x)){isNaN(x)||i||(c/=x);var I=_(c,d);if(I){var T=I[0],R=I[1],C=T===R?a.stops[T].color:r.blendColors(a.stops[T].color,a.stops[R].color,I[2],o.isSome(n)?n.color:void 0);return new r(C)}}}else l.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function d(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"opacity"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.OpacityVariable"===n.declaredClass){var a="number"==typeof t,i=a?null:t,s=i&&i.attributes,u=a?t:null,c=n.field,p=n.cache,f=p.ipData,d=p.hasExpression,h=n.cache.compiledFunc;if(!c&&!d){var y=n.stops;return y&&y[0]&&y[0].opacity}if("number"!=typeof u)if(d){if(o.isNone(r)||o.isNone(r.arcade))return void l.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,m=g.getViewInfo(v),S=g.createExecContext(i,m);if(!h){var b=g.createSyntaxTree(n.valueExpression);h=g.createFunction(b),n.cache.compiledFunc=h}u=g.executeFunction(h,S)}else s&&(u=s[c]);var w=n.normalizationField,F=s?parseFloat(s[w]):void 0;if(null!=u&&(!w||a||!isNaN(F)&&0!==F)){isNaN(F)||a||(u/=F);var x=_(u,f);if(x){var I=x[0],T=x[1];if(I===T)return n.stops[I].opacity;var R=n.stops[I].opacity;return R+(n.stops[T].opacity-R)*x[2]}}}else l.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function h(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"rotation"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.RotationVariable"===n.declaredClass){var a=n.axis||"heading",i="heading"===a&&"arithmetic"===n.rotationType?90:0,s="heading"===a&&"arithmetic"===n.rotationType?-1:1,u="number"==typeof t?null:t,c=u&&u.attributes,p=n.field,f=n.cache.hasExpression,d=n.cache.compiledFunc,h=0;if(!p&&!f)return h;if(f){if(o.isNone(r)||o.isNone(r.arcade))return void l.error("Use of arcade expressions requires an arcade context");var y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,g=v.getViewInfo(y),m=v.createExecContext(u,g);if(!d){var _=v.createSyntaxTree(n.valueExpression);d=v.createFunction(_),n.cache.compiledFunc=d}h=v.executeFunction(d,m)}else c&&(h=c[p]||0);return"number"!=typeof h||isNaN(h)?null:i+s*h}l.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function y(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"size"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.SizeVariable"===n.declaredClass){var a=m(function(e,t,r){var n="number"==typeof t,a=n?null:t,i=a&&a.attributes,s=n?t:null,c=e.cache.isScaleDriven,p=e.cache.compiledFunc;if(c){var f=o.isSome(r)?r.scale:void 0,d=o.isSome(r)?r.view:void 0;s=null==f||d&&"3d"===d.type?function(e){var t=null,r=null,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):f}else if(!n)switch(e.inputValueType){case"expression":if(o.isNone(r)||o.isNone(r.arcade))return void l.error("Use of arcade expressions requires an arcade context");var h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,v=y.getViewInfo(h),g=y.createExecContext(a,v);if(!p){var m=y.createSyntaxTree(e.valueExpression);p=y.createFunction(m),e.cache.compiledFunc=p}s=y.executeFunction(p,g);break;case"field":i&&(s=i[e.field]);break;case"unknown":s=null}if(!u.isValidNumber(s))return null;if(n||!e.normalizationField)return s;var _=i?parseFloat(i[e.normalizationField]):null;return u.isValidNumber(_)&&0!==_?s/_:null}(n,t,r),n,t,r,n.cache.ipData);return null==a||isNaN(a)?0:a}l.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function v(e,t,r){return null==e?null:u.isSizeVariable(e)?y(e,t,r):u.isValidNumber(e)?e:null}function g(e,t,r){return u.isValidNumber(r)&&e>r?r:u.isValidNumber(t)&&e<t?t:e}function m(e,t,r,n,a){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(v(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){var n=e.stops,a=n&&n.length&&n[0].size;return null==a&&(a=e.minSize),v(a,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){var a=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=v(t.minSize,r,n),s=v(t.maxSize,r,n),u=o.isSome(n)?n.shape:void 0;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return s;if("area"===t.scaleBy&&u){var l="circle"===u,c=l?p*Math.pow(i/2,2):i*i,f=c+a*((l?p*Math.pow(s/2,2):s*s)-c);return l?2*Math.sqrt(f/p):Math.sqrt(f)}return i+a*(s-i)}(e,t,r,n);case"proportional":return function(e,t,r,n){var a=o.isSome(n)?n.shape:void 0,i=e/t.minDataValue,s=v(t.minSize,r,n),u=v(t.maxSize,r,n);return g("circle"===a?2*Math.sqrt(i*Math.pow(s/2,2)):"square"===a||"diamond"===a||"image"===a?Math.sqrt(i*Math.pow(s,2)):i*s,s,u)}(e,t,r,n);case"stops":return function(e,t,r,n,a){var i=_(e,a),o=i[0],s=i[1],u=i[2];if(o===s)return v(t.stops[o].size,r,n);var l=v(t.stops[o].size,r,n);return l+(v(t.stops[s].size,r,n)-l)*u}(e,t,r,n,a);case"real-world-size":return function(e,t,r,n){var a=(o.isSome(n)&&n.resolution?n.resolution:1)*s.meterIn[t.valueUnit],i=v(t.minSize,r,n),u=v(t.maxSize,r,n),l=t.valueRepresentation;return g("area"===l?2*Math.sqrt(e/p)/a:"radius"===l||"distance"===l?2*e/a:e/a,i,u)}(e,t,r,n);case"identity":return e;case"unknown":return null}}function _(e,t){if(t){var r=0,n=t.length-1;return t.some((function(t,a){return e<t?(n=a,!0):(r=a,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}}t.viewScaleRE=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,t.getColor=f,t.getOpacity=d,t.getRotationAngle=h,t.getSize=y,t.getSizeFromNumberOrVariable=v,t.getSizeForValue=m,t.getSizeRangeAtScale=function(e,t,r){var n=e.cache.isScaleDriven,a=r&&"3d"===r.type;if(!(n&&a||t))return null;var i={scale:t,view:r},o=v(e.minSize,c,i),s=v(e.maxSize,c,i);if(null!=o||null!=s){if(o>s){var u=s;s=o,o=u}return{minSize:o,maxSize:s}}},t.getVisualVariableValues=function(e,t,r){if(e.visualVariables){for(var n=[],a=[],i=[],o=[],s=[],u=0,l=e.visualVariables;u<l.length;u++){var c=l[u];switch(c.type){case"color":a.push(c);break;case"opacity":i.push(c);break;case"rotation":s.push(c);break;case"size":o.push(c)}}return a.forEach((function(e){var a=f(e,t,r);n.push({variable:e,value:a})})),i.forEach((function(e){var a=d(e,t,r);n.push({variable:e,value:a})})),s.forEach((function(e){var a=h(e,t,r);n.push({variable:e,value:a})})),o.forEach((function(e){var a=y(e,t,r);n.push({variable:e,value:a})})),n.filter((function(e){return null!=e.value}))}},t.getAllSizes=function(e,t,r){for(var n=["proportional","proportional","proportional"],i=0,o=e;i<o.length;i++){var s=o[i],u=s.useSymbolValue?"symbol-value":y(s,t,r);switch(s.axis){case"width":n[0]=u;break;case"depth":n[1]=u;break;case"height":n[2]=u;break;case"width-and-depth":n[0]=u,n[1]=u;break;case"all":case void 0:case null:n[0]=u,n[1]=u,n[2]=u;break;default:a.neverReached(s.axis)}}return n}}.apply(null,n))||(e.exports=a)},1070:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(10),r(11),r(76),r(15),r(36),r(35),r(893),r(1074),r(770),r(1037),r(1047),r(27)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d){var h;function y(e,t){var r=e.geometry,n=e.toJSON(),a=n;if(r&&(a.geometry=JSON.stringify(r),a.geometryType=u.getJsonType(r),a.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(a.objectIds=n.objectIds.join(",")),n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete a.outFields:-1!==n.outFields.indexOf("*")?a.outFields="*":a.outFields=n.outFields.join(","),n.outSR?a.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(a.outSR=a.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(a.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(a.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(a.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(a.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var i=n.timeExtent,o=i.start,s=i.end;null==o&&null==s||(a.time=o===s?o:(null==o?"null":o)+","+(null==s?"null":s)),delete n.timeExtent}return a}function v(e,t,n,a,u){void 0===a&&(a={});var c="string"==typeof e?s.urlToObject(e):e,p=t.geometry?[t.geometry]:[];return a.responseType="pbf"===n?"array-buffer":"json",l.normalizeCentralMeridian(p,null,a).then((function(e){var s=e&&e[0];o.isSome(s)&&((t=t.clone()).geometry=s);var l=f.mapParameters(r({},c.query,{f:n},u,y(t,u)));return i(c.path+"/query",r({},a,{query:l}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.queryToQueryStringParameters=y,t.executeQuery=function(e,t,r,i){return a(this,void 0,void 0,(function(){var a;return n(this,(function(n){switch(n.label){case 0:return[4,v(e,t,"json",i)];case 1:return a=n.sent(),d.applyFeatureSetZUnitScaling(t,r,a.data),[2,a]}}))}))},t.executeQueryPBF=function(e,t,r,n){var a=r.useWorker?(null==h&&(h=new p.PBFWorker),h):null;return v(e,t,"pbf",n).then((function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?a.parseFeatureQuery(e.data,r).then((function(e){return t(e)})):t(c.parsePBFFeatureQuery(e.data,r))}))},t.executeQueryForIds=function(e,t,r){return v(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return v(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return v(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e}))}}.apply(null,n))||(e.exports=a)},1074:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1146)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var n=r.parseFeatureQuery(e,t).queryResult.featureResult;if(n&&n.features&&n.features.length&&n.objectIdFieldName)for(var a=n.objectIdFieldName,i=0,o=n.features;i<o.length;i++){var s=o[i];s.attributes&&(s.objectId=s.attributes[a])}return n}}.apply(null,n))||(e.exports=a)},1077:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(6),r(30),r(851)],void 0===(a=function(e,t,r,n,a){function i(e){return e instanceof Date}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={})),t.cloneField=function(e){return a.fromJSON(e.toJSON())},t.esriFieldToJson=function(e){return e.toJSON()},function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(t.IdState||(t.IdState={})),t.isString=function(e){return"string"==typeof e||e instanceof String},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isArray=function(e){return e instanceof Array},t.isDate=i,t.equalityTest=function(e,t){return e===t||!(!i(e)||!i(t))&&e.getTime()===t.getTime()},t.cloneAttributes=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.convertSquareUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null},t.shapeExtent=function(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null},t.convertLinearUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null},t.sameGeomType=function(e,t){return e===t||"point"===e&&"esriGeometryPoint"===t||"polyline"===e&&"esriGeometryPolyline"===t||"polygon"===e&&"esriGeometryPolygon"===t||"extent"===e&&"esriGeometryEnvelope"===t||"multipoint"===e&&"esriGeometryMultipoint"===t||"point"===t&&"esriGeometryPoint"===e||"polyline"===t&&"esriGeometryPolyline"===e||"polygon"===t&&"esriGeometryPolygon"===e||"extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e},t.defaultMaxRecords=1e3,t.errback=function(e){return function(t){e.reject(t)}},t.callback=function(e,t){return function(){try{e.apply(null,arguments)}catch(e){t.reject(e)}}},t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=function(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}},t.reduceArrayWithPromises=function(e,t){return r.create((function(n,a){var i=r.resolve(!0);e.reduce((function(e,n,a,i){return e.then((function(e){try{return t(e,n,a,i)}catch(e){return r.reject(e)}}),(function(e){return r.reject(e)}))}),i).then(n,a)}))},t.extractServiceUrl=function(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]},t.stableStringify=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,n="boolean"==typeof t.cycles&&t.cycles,a=t.cmp&&(r=t.cmp,function(e){return function(t,n){var a={key:t,value:e[t]},i={key:n,value:e[n]};return r(a,i)}}),i=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,o;if(Array.isArray(t)){for(o="[",r=0;r<t.length;r++)r&&(o+=","),o+=e(t[r])||"null";return o+"]"}if(null===t)return"null";if(-1!==i.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(t)-1,u=Object.keys(t).sort(a&&a(t));for(o="",r=0;r<u.length;r++){var l=u[r],c=e(t[l]);c&&(o&&(o+=","),o+=JSON.stringify(l)+":"+c)}return i.splice(s,1),"{"+o+"}"}}(e)}}.apply(null,n))||(e.exports=a)},1107:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}.apply(null,n))||(e.exports=a)},1110:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(4),r(2),r(17),r(1123)],void 0===(a=function(e,t,r,n,a,i,o,s){var u={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};return function(e){function t(t){var r=e.call(this,t)||this;return r.contentType=null,r.exifInfo=null,r.id=null,r.globalId=null,r.keywords=null,r.name=null,r.parentGlobalId=null,r.parentObjectId=null,r.size=null,r.url=null,r}var a;return r(t,e),a=t,Object.defineProperty(t.prototype,"orientationInfo",{get:function(){var e=this.exifInfo,t=s.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return u[t]||null},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new a({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})},n([i.property({type:String})],t.prototype,"contentType",void 0),n([i.property()],t.prototype,"exifInfo",void 0),n([i.property({readOnly:!0,dependsOn:["exifInfo"]})],t.prototype,"orientationInfo",null),n([i.property({type:o.Integer})],t.prototype,"id",void 0),n([i.property({type:String})],t.prototype,"globalId",void 0),n([i.property({type:String})],t.prototype,"keywords",void 0),n([i.property({type:String})],t.prototype,"name",void 0),n([i.property({json:{read:!1}})],t.prototype,"parentGlobalId",void 0),n([i.property({json:{read:!1}})],t.prototype,"parentObjectId",void 0),n([i.property({type:o.Integer})],t.prototype,"size",void 0),n([i.property({json:{read:!1}})],t.prototype,"url",void 0),a=n([i.subclass("esri.layers.support.AttachmentInfo")],t)}(i.declared(a.JSONSupport))}.apply(null,n))||(e.exports=a)},1111:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(76),r(36),r(1110),r(1037)],void 0===(a=function(e,t,r,n,a,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t){for(var r={},n=0,o=e;n<o.length;n++)for(var s=o[n],u=s.parentObjectId,l=s.parentGlobalId,c=0,p=s.attachmentInfos;c<p.length;c++){var f=p[c],d=f.id,h=a.addProxy(a.addTokenParameter(t+"/"+u+"/attachments/"+d)),y=i.fromJSON(f);y.set({url:h,parentObjectId:u,parentGlobalId:l}),r[u]?r[u].push(y):r[u]=[y]}return r},t.executeAttachmentQuery=function(e,t,a){var i={query:o.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return a&&(i=r({},a,i)),n(e.path+"/queryAttachments",i)}}.apply(null,n))||(e.exports=a)},1114:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1979),r(1107),r(1077),r(1470),r(1333),r(6),r(769),r(1207),r(28),r(902)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p){return function(){function e(e){this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=a.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}return e.prototype.optimisePagingFeatureQueries=function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)},e.prototype._hasMemorySource=function(){return!0},e.prototype.prop=function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)},e.prototype.end=function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent},e.prototype._ensureLoaded=function(){return this.load()},e.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=s.create((function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}}),r)}))),this._loadPromise},e.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new c({wkid:4326}),this.geometryType=a.layerGeometryEsriConstants.point)},e.prototype.getField=function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r}))),r},e.prototype.getFieldsIndex=function(){return null===this._fieldsIndex&&(this._fieldsIndex=new p(this.fields)),this._fieldsIndex},e.prototype._maxProcessingRate=function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())},e.prototype._maxQueryRate=function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery},e.prototype._checkCancelled=function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")},e.prototype.nativeCapabilities=function(){return this._parent.nativeCapabilities()},e.prototype._canDoAggregates=function(e,t,r,n,a){return null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a)},e.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,o){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,o)},e.prototype._getAgregagtePhysicalPage=function(e,t,r){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)},e.prototype.databaseType=function(){var e=this;if(this._databaseType===a.FeatureServiceDatabaseType.NotEvaluated){if(null!==i.applicationCache){var t=i.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:a.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:a.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:a.FeatureServiceDatabaseType.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=s.create((function(t,n){e._getDatabaseTypeImpl(r,0).then((function(r){e._databaseType=r,t(e._databaseType)}),(function(e){n(e)}))}));return null!==i.applicationCache&&(i.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch((function(t){throw i.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=n,this._databaseTypeProbed}return s.resolve(this._databaseType)},e.prototype._cacheableFeatureSetSourceKey=function(){return"MUSTBESET"},e.prototype._getDatabaseTypeImpl=function(e,t){var r=this;return t>=e.length?s.resolve(a.FeatureServiceDatabaseType.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)}))},e.prototype._runDatabaseProbe=function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):s.reject(new Error("Not Implemented"))},e.prototype.isTable=function(){return this._parent.isTable()},e.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]},e.prototype._isInFeatureSet=function(e){return a.IdState.Unknown},e.prototype._getSet=function(e){throw new Error("Not implemented in abstract class")},e.prototype._getFeature=function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?s.resolve(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):s.reject(new Error("Feature Not Found"))}))}catch(e){return s.reject(e)}},e.prototype._getFeatureBatch=function(e,t){var r=this;try{this._checkCancelled(t);var a=new n([],e,!1,null),i=[];return this._getFeatures(a,-1,e.length,t).then((function(){r._checkCancelled(t);for(var n=0,a=e;n<a.length;n++){var o=a[n];void 0!==r._featureFromCache(o)&&i.push(r._featureFromCache(o))}return i}))}catch(e){return s.reject(e)}},e.prototype._getFeatures=function(e,t,r,n){return s.resolve("success")},e.prototype._getFilteredSet=function(e,t,r,n,a){throw new Error("Not implemented in abstract class")},e.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?s.resolve(e):this._refineIfParentKnown(e,t-i,r).then((function(){if(n._checkCancelled(r),n._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var o=t-i,s=n._prepareFetchAndRefineSet(e._candidates);return n._fetchAndRefineFeatures(s,s.length>o?o:e._candidates.length,r).then((function(){return n._checkCancelled(r),n._refineKnowns(e,t-i),e}))}return e}))}catch(e){return s.reject(e)}},e.prototype._fetchAndRefineFeatures=function(e,t,r){return null},e.prototype._prepareFetchAndRefineSet=function(e){for(var t=[],r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t},e.prototype._isPhysicalFeature=function(e){return null===this._parent||this._parent._isPhysicalFeature(e)},e.prototype._refineKnowns=function(e,t){var r=0,n=null,i=[];t=this._maxQueryRate();for(var o=0;o<e._candidates.length&&"GETPAGES"!==e._candidates[o];o++){var s=!1,u=this._candidateIdTransform(e._candidates[o]);u!==e._candidates[o]&&(s=!0);var l=this._isInFeatureSet(u);if(l===a.IdState.InFeatureSet)!0===s?e._known.indexOf(u)<0&&(e._known.push(u),r+=1):(e._known.push(e._candidates[o]),r+=1),null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(i.push(n),n={start:o,end:o});else if(l===a.IdState.NotInFeatureSet)null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(i.push(n),n={start:o,end:o}),r+=1;else if(l===a.IdState.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&i.push(n);for(var c=i.length-1;c>=0;c--)e._candidates.splice(i[c].start,i[c].end-i[c].start+1)},e.prototype._refineIfParentKnown=function(e,t,r){var a=new n([],[],e._ordered,null);return a._candidates=e._candidates.slice(0),this._parent._refineSetBlock(a,t,r)},e.prototype._candidateIdTransform=function(e){return this._parent._candidateIdTransform(e)},e.prototype._checkIfNeedToExpandKnownPage=function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1)>=t)break}return!1},e.prototype._checkIfNeedToExpandCandidatePage=function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if((r+=1)>=t)break}return!1},e.prototype._expandPagedSet=function(e,t,r,n,a){return null===this._parent?s.reject(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)},e.prototype._expandPagedSetFeatureSet=function(e,t,r,n,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?s.resolve("finished"):this._getPage(e,n,a).then((function(n){return r+n<t?i._expandPagedSet(e,t,r+n,0,a):"success"}))},e.prototype._getPage=function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,o=0;o<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+o>=e.pagesDefinition.internal.set.length);o++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+o],i++;e.pagesDefinition.resultOffset+=i;var u=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(u=!0),!1===u&&a.push("GETPAGES"),s.resolve(i)}return this._getPhysicalPage(e,t,r).then((function(){return n._getPage(e,t,r)}))},e.prototype._getPhysicalPage=function(e,t,r){return null},e.prototype._clonePageDefinition=function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)},e.prototype._first=function(e){return this.iterator(e).next()},e.prototype.first=function(e){return this._first(e)},e.prototype.calculateStatistic=function(e,t,r,n){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,r,n).then((function(i){return!1===i.calculated?a._manualStat(e,t,r,n).then((function(e){return e.result})):i.result}))}))},e.prototype._manualStat=function(e,t,r,n){switch(e.toLowerCase()){case"count":return o.count(this,n).then((function(e){return{calculated:!0,result:e}}));case"distinct":return o.distinct(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return o.mean(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"stdev":return o.stdev(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"variance":return o.variance(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"sum":return o.sum(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"min":return o.min(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"max":return o.max(this,t,n).then((function(e){return{calculated:!0,result:e}}));default:return s.resolve({calculated:!0,result:0})}},e.prototype._stat=function(e,t,r,n,a,i,o){var s=this;return this._parent._stat(e,t,r,n,a,i,o).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?s._manualStat(e,t,i,o):{calculated:!1}:u}))},e.prototype._unionAllGeomSelf=function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return s.create((function(e,a){t._unionShapeInBatches(n,r,e,a)}))},e.prototype._unionAllGeom=function(e){var t=this;return s.create((function(r,n){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,r,n)}))},e.prototype._unionShapeInBatches=function(e,t,r,n){var a=this;t.next().then((function(i){try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?l.union(e).then((function(o){try{null===i?r(o):(e=[o],a._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}}),n):null===i?1===e.length?r(e[0]):r(null):a._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}}),n)},e.prototype.iterator=function(e){return new r(this,e)},e.prototype.intersection=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.intersection.bind(this)(t,r)},e.prototype.difference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.difference.bind(this)(t,r,n)},e.prototype.symmetricDifference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)},e.prototype.morphShape=function(t,r,n,a){return void 0===n&&(n="unknown"),void 0===a&&(a=null),e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)},e.prototype.morphShapeAndAttributes=function(t,r,n){return void 0===n&&(n="unknown"),e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)},e.prototype.union=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.union.bind(this)(t,r)},e.prototype.intersects=function(t){return e._featuresetFunctions.intersects.bind(this)(t)},e.prototype.envelopeIntersects=function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)},e.prototype.contains=function(t){return e._featuresetFunctions.contains.bind(this)(t)},e.prototype.overlaps=function(t){return e._featuresetFunctions.overlaps.bind(this)(t)},e.prototype.relate=function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)},e.prototype.within=function(t){return e._featuresetFunctions.within.bind(this)(t)},e.prototype.touches=function(t){return e._featuresetFunctions.touches.bind(this)(t)},e.prototype.top=function(t){return e._featuresetFunctions.top.bind(this)(t)},e.prototype.crosses=function(t){return e._featuresetFunctions.crosses.bind(this)(t)},e.prototype.buffer=function(t,r,n,a){return void 0===a&&(a=!0),e._featuresetFunctions.buffer.bind(this)(t,r,n,a)},e.prototype.filter=function(t,r){return void 0===r&&(r=null),e._featuresetFunctions.filter.bind(this)(t,r)},e.prototype.orderBy=function(t){return e._featuresetFunctions.orderBy.bind(this)(t)},e.prototype.dissolve=function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)},e.prototype.groupby=function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)},e.prototype.reduce=function(e,t,r){var n=this;return void 0===t&&(t=null),s.create((function(a,i){n._reduceImpl(n.iterator(n._defaultTracker(r)),e,t,0,a,i,0)}))},e.prototype._reduceImpl=function(e,t,r,n,a,i,o){var u=this;try{if(++o>1e3)return void setTimeout((function(){o=0,u._reduceImpl(e,t,r,n,a,i,o)}));e.next().then((function(l){try{if(null===l)a(r);else{var c=t(r,l,n,u);s.isPromiseLike(c)?c.then((function(r){u._reduceImpl(e,t,r,n+1,a,i,o)}),i):u._reduceImpl(e,t,c,n+1,a,i,o)}}catch(e){i(e)}}),i)}catch(e){i(e)}},e.prototype.removeField=function(t){return e._featuresetFunctions.removeField.bind(this)(t)},e.prototype.addField=function(t,r,n){return void 0===n&&(n=null),e._featuresetFunctions.addField.bind(this)(t,r,n)},e.prototype.sumArea=function(e,t,r){void 0===t&&(t=!1);var n=a.convertSquareUnitsToCode(e);return this.reduce((function(e,r){return null===r.geometry?0:t?l.geodesicArea(r.geometry,n).then((function(t){return e+t})):l.planarArea(r.geometry,n).then((function(t){return e+t}))}),0,r)},e.prototype.sumLength=function(e,t,r){void 0===t&&(t=!1);var n=a.convertLinearUnitsToCode(e);return this.reduce((function(e,r){return null===r.geometry?0:t?l.geodesicLength(r.geometry,n).then((function(t){return e+t})):l.planarLength(r.geometry,n).then((function(t){return e+t}))}),0,r)},e.prototype._substituteVars=function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}},e.prototype.distinct=function(e,t,r,n){var a=this;return void 0===t&&(t=1e3),void 0===r&&(r=null),this.load().then((function(){var i=u.WhereClause.create(e,a.getFieldsIndex());return a._substituteVars(i,r),a.calculateStatistic("distinct",i,t,a._defaultTracker(n))}))},e.prototype.min=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("min",a,-1,n._defaultTracker(r))}))},e.prototype.max=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("max",a,-1,n._defaultTracker(r))}))},e.prototype.avg=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("avg",a,-1,n._defaultTracker(r))}))},e.prototype.sum=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("sum",a,-1,n._defaultTracker(r))}))},e.prototype.stdev=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("stdev",a,-1,n._defaultTracker(r))}))},e.prototype.variance=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then((function(){var a=u.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("variance",a,-1,n._defaultTracker(r))}))},e.prototype.count=function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",u.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))},e.prototype._defaultTracker=function(e){return e||{aborted:!1}},e.prototype.forEach=function(e,t){var r=this;return s.create((function(n,a){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,a,0)}))},e.prototype._forEachImpl=function(e,t,r,n,a,i){var o=this;try{if(++i>1e3)return void setTimeout((function(){i=0,o._forEachImpl(e,t,r,n,a,i)}),0);e.next().then((function(u){try{if(null===u)n(r);else{var l=t(u);null==l?o._forEachImpl(e,t,r,n,a,i):s.isPromiseLike(l)?l.then((function(){try{o._forEachImpl(e,t,r,n,a,i)}catch(e){a(e)}}),a):o._forEachImpl(e,t,r,n,a,i)}}catch(e){a(e)}}),a)}catch(e){a(e)}},e.prototype.convertToJSON=function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(a.esriFieldToJson(this.fields[r]));return this.reduce((function(e,r){var n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(var a in r.attributes)n.attributes[a]=r.attributes[a];return t.featureSet.features.push(n),1}),0,e).then((function(){return t}))},e.prototype.castToText=function(){return"object, FeatureSet"},e.prototype.queryAttachments=function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)},e.prototype.serviceUrl=function(){return this._parent.serviceUrl()},e.prototype.relationshipMetaData=function(){return this._parent.relationshipMetaData()},e.prototype.schema=function(){for(var e=[],t=0,r=this.fields;t<r.length;t++){var n=r[t];e.push(a.esriFieldToJson(n))}return{objectIdField:this.objectIdField,typeIdField:this.typeIdField,geometryType:void 0===a.layerGeometryEsriConstants[this.geometryType]?"":a.layerGeometryEsriConstants[this.geometryType],hasZ:this.hasZ,hasM:this.hasM,fields:e}},e.prototype.convertToText=function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(r.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=[];return r.reduce((function(t,r){var n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t).then((function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(t)}))})):s.resolve(this.castToText())},e.prototype.getFeatureByObjectId=function(e,t){return this._parent.getFeatureByObjectId(e,t)},e._featuresetFunctions={},e}()}.apply(null,n))||(e.exports=a)},1115:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1049),r(1077),r(769)],void 0===(a=function(e,t,r,n,a){function i(e,t){return o(e.parseTree,t,e.parameters)}function o(e,t,r,n,a){var i,c,p,f;switch(void 0===n&&(n=null),void 0===a&&(a=null),e.type){case"interval":return d(o(e.value,t,r,n,a),e.qualifier,e.op);case"case_expression":var h=" CASE ";"simple"===e.format&&(h+=o(e.operand,t,r,n,a));for(var y=0;y<e.clauses.length;y++)h+=" WHEN "+o(e.clauses[y].operand,t,r,n,a)+" THEN "+o(e.clauses[y].value,t,r,n,a);return null!==e.else&&(h+=" ELSE "+o(e.else,t,r,n,a)),h+" END ";case"param":var v=r[e.value.toLowerCase()];if("string"==typeof v)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(v instanceof Date)return u(v,t);if(v instanceof Array){var g=[];for(y=0;y<v.length;y++)"string"==typeof v[y]?g.push("'"+v[y].toString().replace(/'/g,"''")+"'"):v[y]instanceof Date?g.push(u(v[y],t)):g.push(v[y].toString());return g}return v.toString();case"expr_list":c=[];for(var m=0,_=e.value;m<_.length;m++){var S=_[m];c.push(o(S,t,r,n,a))}return c;case"unary_expr":return" ( NOT "+o(e.expr,t,r,n,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+o(e.left,t,r,n,a)+" AND "+o(e.right,t,r,n,a)+") ";case"OR":return" ("+o(e.left,t,r,n,a)+" OR "+o(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+o(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+o(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":return i=[],"expr_list"===e.right.type?(i=o(e.right,t,r,n,a)," ("+o(e.left,t,r,n,a)+" IN ("+i.join(",")+")) "):(f=o(e.right,t,r,n,a))instanceof Array?" ("+o(e.left,t,r,n,a)+" IN ("+f.join(",")+")) ":" ("+o(e.left,t,r,n,a)+" IN ("+f+")) ";case"NOT IN":return i=[],"expr_list"===e.right.type?(i=o(e.right,t,r,n,a)," ("+o(e.left,t,r,n,a)+" NOT IN ("+i.join(",")+")) "):(f=o(e.right,t,r,n,a))instanceof Array?" ("+o(e.left,t,r,n,a)+" NOT IN ("+f.join(",")+")) ":" ("+o(e.left,t,r,n,a)+" NOT IN ("+f+")) ";case"BETWEEN":return p=o(e.right,t,r,n,a)," ("+o(e.left,t,r,n,a)+" BETWEEN "+p[0]+" AND "+p[1]+" ) ";case"NOTBETWEEN":return p=o(e.right,t,r,n,a)," ("+o(e.left,t,r,n,a)+" NOT BETWEEN "+p[0]+" AND "+p[1]+" ) ";case"LIKE":return""!==e.escape?" ("+o(e.left,t,r,n,a)+" LIKE "+o(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+o(e.left,t,r,n,a)+" LIKE "+o(e.right,t,r,n,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+o(e.left,t,r,n,a)+" NOT LIKE "+o(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+o(e.left,t,r,n,a)+" NOT LIKE "+o(e.right,t,r,n,a)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+o(e.left,t,r,n,a)+" "+e.operator+" "+o(e.right,t,r,n,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return u(e.value,t);case"number":return e.value.toString();case"current_time":return l("date"===e.mode,t);case"column_ref":return n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":var b=o(e.args,t,r,n,a);return s(e.name,b,t)}throw new Error("Unsupported sql syntax "+e.type)}function s(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case n.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var a="CONCAT(",i=0;i<t.length;i++)0!==i&&(a+=","),a+=t[i];return a+")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var o="";switch(r){case n.FeatureServiceDatabaseType.Oracle:return o="SUBSTR("+t[0]+","+t[1],3===t.length&&(o+=","+t[2]),o+")";case n.FeatureServiceDatabaseType.SqlServer:return 3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return o="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(o+=" FOR "+t[2]),o+")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function u(e,t){var a=r.MomentLibrary.Moment(e),i=0===a.minute()&&0===a.hour()&&0===a.second()&&0===a.millisecond();switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:return i?"date '"+a.format("YYYY-MM-DD")+"'":"date '"+a.format("YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.Oracle:return i?"TO_DATE('"+a.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+a.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case n.FeatureServiceDatabaseType.SqlServer:return"'"+a.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.PGDB:return"#"+a.format(i?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case n.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '"+a.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+a.format("YYYY-MM-DD HH:mm:ss")+"'"}}function l(e,t){switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:case n.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case n.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case n.FeatureServiceDatabaseType.PGDB:case n.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}Object.defineProperty(t,"__esModule",{value:!0}),t.toWhereClause=i,t.toWhereClauseFromTree=function(e,t,r){return o(e,t,r)},t.reformulateWithoutField=function(e,t,r,i){return a.WhereClause.create(o(e.parseTree,n.FeatureServiceDatabaseType.Standardised,e.parameters,t,r),i)},t.combine=function(e,t,r){return void 0===r&&(r="AND"),a.WhereClause.create("(("+i(e,n.FeatureServiceDatabaseType.Standardised)+")"+r+"("+i(t,n.FeatureServiceDatabaseType.Standardised)+"))",e.fieldsIndex)},t.translateFunctionToDatabaseSpecific=s,t.makeDateString=u,t.makeToday=l,t.predictType=function(e,t,r){void 0===r&&(r={});for(var n={},a={},i={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},o=0,s=t;o<s.length;o++){var u=i[(l=s[o]).type];n[l.name.toLowerCase()]=void 0===u?"":u}for(var l in r)u=i[r[l]],a[l.toLowerCase()]=void 0===u?"":u;switch(function e(t,r,n,a){var i;switch(r.type){case"interval":return"integer";case"case_expression":var o=[];if("simple"===r.format){for(var s=0;s<r.clauses.length;s++)o.push(e(t,r.clauses[s].value,n,a));null!==r.else&&o.push(e(t,r.else,n,a))}else{for(s=0;s<r.clauses.length;s++)o.push(e(t,r.else,n,a));null!==r.else&&o.push(e(t,r.else,n,a))}return p(o);case"param":var u=a[r.value.toLowerCase()];if(void 0===u&&n){var l=n[r.value.toLowerCase()];if(void 0===l)return"";if(null===l)return"";if("string"==typeof l||l instanceof String)return"string";if("boolean"==typeof l)return"boolean";if(l instanceof Date)return"date";if("number"==typeof l)return l%1==0?"integer":"double"}return void 0===u?"":u;case"expr_list":for(var c=[],f=0,d=r.value;f<d.length;f++){var h=d[f];c.push(e(t,h,n,a))}return c;case"unary_expr":return"boolean";case"binary_expr":switch(r.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==r.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return p([e(t,r.left,n,a),e(t,r.right,n,a)]);default:throw new Error("Not Supported Operator "+r.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===r.value?"":r.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var y=t[r.column.toLowerCase()];return void 0===y?"":y;case"function":switch(r.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(i=e(t,r.args,n,a))instanceof Array?i.length>0?i[0]:"":i;case"sign":return(i=e(t,r.args,n,a))instanceof Array&&(i=p(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var v=e(t,r.args,n,a);return v instanceof Array?p(v):v;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(i=e(t,r.args,n,a))instanceof Array?i.length>0?i[0]:"":i}return""}throw new Error("Unsupported sql syntax "+r.type)}(n,e.parseTree,e.parameters,a)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""};var c={boolean:1,string:2,integer:3,double:4,date:5};function p(e){if(e){for(var t="",r=0,n=e;r<n.length;r++){var a=n[r];""!==a&&(t=""===t||c[t]<c[a]?a:t)}return t}return""}function f(e){return""+e.period.toUpperCase()}function d(e,t,r){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?f(t):f(t.start)+" TO "+f(t.end))}t.scanForField=function(e,t){return function e(t,r){if(null==t)return!1;switch(t.type){case"when_clause":return e(t.operand,r)||e(t.value,r);case"case_expression":for(var n=0,a=t.clauses;n<a.length;n++){var i=a[n];if(e(i,r))return!0}return!("simple"!==t.format||!e(t.operand,r))||!(null===t.else||!e(t.else,r));case"param":return!1;case"expr_list":for(var o=0,s=t.value;o<s.length;o++)if(e(i=s[o],r))return!0;return!1;case"unary_expr":return e(t.expr,r);case"binary_expr":return e(t.left,r)||e(t.right,r);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return r.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,r)}return!1}(e.parseTree,t)},t.isSingleField=function(e){return"column_ref"===e.parseTree.type},t.convertIntervalToSql=d}.apply(null,n))||(e.exports=a)},1119:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(32),r(240),r(29),r(13),r(3),r(15),r(266),r(28),r(1046),r(236),r(35),r(264),r(851),r(1120)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y){Object.defineProperty(t,"__esModule",{value:!0}),t.equals=y.equals;t.DehydratedFeatureClass=function(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null},t.hasGeometry=function(e){return s.isSome(e.geometry)},t.isFeatureGeometry=function(e){return r.isFeatureGeometryType(e.type)};function v(e,t,r){if(!e)return null;switch(t){case"point":var n=e;return{x:n.x,y:n.y,z:n.z,m:n.m,hasZ:null!=n.z,hasM:null!=n.m,type:"point",spatialReference:r};case"polyline":var a=e;return{paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polyline",spatialReference:r};case"polygon":var i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r};case"multipoint":var o=e;return{points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:"multipoint",spatialReference:r}}}function g(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}}function m(e){return"declaredClass"in e}function _(e){return"declaredClass"in e}function S(e){return"declaredClass"in e}function b(e){return s.isNone(e)?null:m(e)?e:f.fromJSON(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,n=e.hasZ,i=e.hasM;return{rings:I(r),hasZ:n,hasM:i,spatialReference:t};case"polyline":var o=e.paths;return n=e.hasZ,i=e.hasM,{paths:I(o),hasZ:n,hasM:i,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:n=e.hasZ,hasM:i=e.hasM,spatialReference:t};case"multipoint":var s=e.points;return n=e.hasZ,i=e.hasM,{points:R(s)?T(s):s,hasZ:n,hasM:i,spatialReference:t};default:return void a.neverReached(e)}}(e))}t.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null},t.isPoint=function(e){return"point"===e.type},t.fromFeatureSetJSON=function(e){var t=r.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),i=l.fromJSON(e.spatialReference),o=e.transform,s=e.features.map((function(r){var s=function(e,t,r,a){return{uid:n.generateUID(),objectId:a&&e.attributes?e.attributes[a]:null,attributes:e.attributes,geometry:v(e.geometry,t,r),visible:!0}}(r,t,i,e.objectIdFieldName),u=s.geometry;if(u&&o)switch(u.type){case"point":s.geometry=d.hydratePoint(o,u,u,u.hasZ,u.hasM);break;case"multipoint":s.geometry=d.hydrateMultipoint(o,u,u,u.hasZ,u.hasM);break;case"polygon":s.geometry=d.hydratePolygon(o,u,u,u.hasZ,u.hasM);break;case"polyline":s.geometry=d.hydratePolyline(o,u,u,u.hasZ,u.hasM);break;default:a.neverReached(u)}return s}));return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map((function(e){return h.fromJSON(e)})):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}},t.fromJSONGeometry=v,t.makeDehydratedPoint=g,t.isHydratedGeometry=m,t.isHydratedPoint=_,t.isHydratedGraphic=S,t.hydrateGraphic=function(e,t){if(!e)return null;if(S(e))return e;var r=new n({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=o.clone(e.symbol),r.attributes=o.clone(e.attributes),r.geometry=b(e.geometry),r},t.hydrateGeometry=b,t.clonePoint=function(e,t){if(!e)return null;var r;if(_(e)){if(null==t)return e.clone();if(_(t))return t.copy(e)}return null!=t?((r=t).x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=g(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r};var w=i("esri-text-decoder")?function(e){return 32+e.length}:function(e){return 32*e.length};function F(e){if(!e)return 0;var t=32;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(typeof n){case"string":t+=w(n);break;default:case"number":t+=16}}return t}function x(e){if(s.isNone(e))return 0;var t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":for(var r=0,n=2+(e.hasZ?1:0)+(e.hasM?1:0),i="polyline"===e.type?e.paths:e.rings,o=0,l=i;o<l.length;o++)r+=l[o].length;t+=8*r*n+64,t+=128*r,t+=34,t+=32*(i.length+1);break;case"multipoint":var c=2+(e.hasZ?1:0)+(e.hasM?1:0),p=e.points.length;t+=8*p*c+64,t+=128*p,t+=34,t+=32;break;case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=u.estimateSize(e.vertexAttributes.position),t+=u.estimateSize(e.vertexAttributes.normal),t+=u.estimateSize(e.vertexAttributes.uv),t+=u.estimateSize(e.vertexAttributes.tangent);break;default:a.neverReached(e)}return t}function I(e){return function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(0!==n.length)return R(n)}return!1}(e)?e.map((function(e){return T(e)})):e}function T(e){return e.map((function(e){return u.toArray(e)}))}function R(e){return e.length&&(u.isFloat32Array(e[0])||u.isFloat64Array(e[0]))}function C(e,t){switch(c.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)c.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(r=0;r<e.rings.length;r++)c.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":c.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:a.neverReached(e)}}function E(e,t){switch(p.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)p.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(r=0;r<e.rings.length;r++)p.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":p.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:a.neverReached(e)}}t.estimateAttributesObjectSize=F,t.estimateGeometryObjectSize=x,t.estimateSize=function(e){var t=32;return t+=F(e.attributes),(t+=3)+(8+x(e.geometry))},t.numVertices=function(e){if(s.isNone(e))return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,r=0,n=e.paths;r<n.length;r++)t+=n[r].length;return t;case"polygon":t=0;for(var i=0,o=e.rings;i<o.length;i++)t+=o[i].length;return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var u=e.vertexAttributes&&e.vertexAttributes.position;return u?u.length/3:0;default:return void a.neverReached(e)}},t.hasVertices=function(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,r=e.paths;t<r.length;t++)if(r[t].length>0)return!0;return!1;case"polygon":for(var n=0,i=e.rings;n<i.length;n++)if(i[n].length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:return void a.neverReached(e)}},t.computeAABB=C,t.expandAABB=function(e,t){C(e,N),c.expand(t,N)},t.computeAABR=E,t.expandAABR=function(e,t){E(e,A),p.expand(t,A)},t.getObjectId=function(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null};var N=c.create(),A=p.create()}.apply(null,n))||(e.exports=a)},1120:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(29),r(15)],void 0===(a=function(e,t,r,n){function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],a=t[r];if(n.length!==a.length)return!1;for(var i=0;i<n.length;i++)if(n[i]!==a[i])return!1}return!0}function i(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!a(e[r],t[r]))return!1;return!0}function o(e,t){return e===t||e&&t&&e.equals(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!function(e,t){if(e===t)return!0;if(n.isNone(e)||n.isNone(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!o(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!o(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!o(e.spatialReference,t.spatialReference)&&i(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!o(e.spatialReference,t.spatialReference)&&i(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!o(e.spatialReference,t.spatialReference)&&a(e.points,t.points)}(e,t);case"mesh":return!1;default:return void r.neverReached(e)}}(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var a=0,i=r;a<i.length;a++){var o=i[a];if(e[o]!==t[o])return!1}return!0}(e.attributes,t.attributes)}}.apply(null,n))||(e.exports=a)},1123:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getExifValue=function(e){var t=e.exifInfo,n=e.exifName,a=e.tagName;if(!t||!n||!a)return null;var i=r.find(t,(function(e){return e.name===n}));return i?function(e){var t=e.tagName,n=e.tags;if(!n||!t)return null;var a=r.find(n,(function(e){return e.name===t}));return a&&a.value||null}({tagName:a,tags:i.tags}):null}}.apply(null,n))||(e.exports=a)},1124:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(103),r(8),r(32),r(2),r(1043),r(1070),r(1111),r(1125),r(1085),r(907),r(891),r(1086)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r.sourceSpatialReference=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then((function(e){return d.fromJSON(e)}))},t.prototype.executeJSON=function(e,t){return l.executeQuery(this.parsedUrl,this._normalizeQuery(e),this.sourceSpatialReference,i({},this.requestOptions,t)).then((function(e){return e.data}))},t.prototype.executeForCount=function(e,t){return l.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then((function(e){return e.data.count}))},t.prototype.executeForExtent=function(e,t){return l.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then((function(e){return{count:e.data.count,extent:o.Extent.fromJSON(e.data.extent)}}))},t.prototype.executeForIds=function(e,t){return l.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then((function(e){return e.data.objectIds}))},t.prototype.executeRelationshipQuery=function(e,t){return e=y.from(e),(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),p.executeRelationshipQuery(this.parsedUrl,e,i({},this.requestOptions,t)).then((function(e){var t=e.data,r={};return Object.keys(t).forEach((function(e){return r[e]=d.fromJSON(t[e])})),r}))},t.prototype.executeAttachmentQuery=function(e,t){var r=this;return c.executeAttachmentQuery(this.parsedUrl,f.from(e),i({},this.requestOptions,t)).then((function(e){return c.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path)}))},t.prototype._normalizeQuery=function(e){var t=h.from(e);return this.gdbVersion||this.source?(t===e?t.clone():t).set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):t},n([s.property()],t.prototype,"gdbVersion",void 0),n([s.property()],t.prototype,"source",void 0),n([s.property()],t.prototype,"sourceSpatialReference",void 0),n([s.subclass("esri.tasks.QueryTask")],t)}(s.declared(u))}.apply(null,n))||(e.exports=a)},1125:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(76),r(1037)],void 0===(a=function(e,t,r,n,a){function i(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=i,t.executeRelationshipQuery=function(e,t,o){var s={query:a.mapParameters(r({},e.query,{f:"json"},i(t)))};return o&&(s=r({},o,s)),n(e.path+"/queryRelatedRecords",s).then((function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,a={},i=0,o=t.relatedRecordGroups;i<o.length;i++){var s=o[i],u={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:s.relatedRecords};if(null!=s.objectId)a[s.objectId]=u;else for(var l in s)s.hasOwnProperty(l)&&"relatedRecords"!==l&&(a[s[l]]=u)}return e.data=a,e}))}}.apply(null,n))||(e.exports=a)},1140:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var n=r[e.toLowerCase()];if(null==n)throw new Error("Function Not Recognised");if(t.length<n.minParams||t.length>n.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return n.evaluate(t)},t.isAggregate=function(e,t){var n=r[e.toLowerCase()];return null!=n&&t>=n.minParams&&t<=n.maxParams};var r={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(a(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:a(e[0])}}};function n(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function a(e){for(var t=n(e),r=e.length,a=0,i=0,o=e;i<o.length;i++){var s=o[i];a+=Math.pow(s-t,2)}return r>1?a/(r-1):0}}.apply(null,n))||(e.exports=a)},1141:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(52)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return e.fixDefaults=function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")},e.createFromMilliseconds=function(t){var r=new e;return r.second=t/1e3,r},e.createFromValueAndQualifer=function(t,r,n){var a=new e;if(a.op="-"===n?"-":"+","interval-period"===r.type){e.fixDefaults(r);var i=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if(!i.test(t))throw new Error("Illegal Interval");a[r.period]=parseFloat(t)}else{if(e.fixDefaults(r.start),e.fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]),a[r.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]);var o=t.split(" ")[1].split(":");a.hour=parseFloat(o[0]),a.minute=parseFloat(o[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]),o=t.split(" ")[1].split(":"),a.hour=parseFloat(o[0]),a.minute=parseFloat(o[1]),a.second=parseFloat(o[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(r.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a.hour=parseFloat(t.split(":")[0]),a.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");o=t.split(":"),a.hour=parseFloat(o[0]),a.minute=parseFloat(o[1]),a.second=parseFloat(o[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(r.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");o=t.split(":"),a.minute=parseFloat(o[0]),a.second=parseFloat(o[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return a},e.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)},e}();t.SqlInterval=n,t.evaluateFunction=function(e,t){var r=a[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=a[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var a={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",a=t?e[2]:e[1];if(null==n||null==a)return null;var i="("+r.escapeRegExpString(n)+")";switch(e[0]){case"BOTH":return a.replace(new RegExp("^"+i+"*|"+i+"*$","g"),"");case"LEADING":return a.replace(new RegExp("^"+i+"*","g"),"");case"TRAILING":return a.replace(new RegExp(i+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=a)},1142:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1143)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=n}.apply(null,n))||(e.exports=a)},1143:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(t,r,n,a){this.message=t,this.expected=r,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,a,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(a=e[t],r[a.type](a));if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,a={},i={start:We},o=We,s=function(e,t){return Yt(e,t)},u=Ge("!",!1),l=Ge("=",!1),c=Ge(">=",!1),p=Ge(">",!1),f=Ge("<=",!1),d=Ge("<>",!1),h=Ge("<",!1),y=Ge("!=",!1),v=function(e){return e[0]+" "+e[2]},g=Ge("+",!1),m=Ge("-",!1),_=Ge("*",!1),S=Ge("/",!1),b=function(e,t){return e+t.join("")},w=/^[A-Za-z_\x80-\uFFFF]/,F=Be([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),x=/^[A-Za-z0-9_]/,I=Be([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),T=/^[A-Za-z0-9_.\x80-\uFFFF]/,R=Be([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),C=Ge("@",!1),E=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},N=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},A=function(e){return parseFloat(e)},D=Ge("'",!1),k=Ge("N'",!1),P=Ge("''",!1),O=/^[^']/,M=Be(["'"],!0,!1),L=function(e,t){return{type:"when_clause",operand:e,value:t}},j=Ge(".",!1),G=/^[0-9]/,B=Be([["0","9"]],!1,!1),q=/^[eE]/,U=Be(["e","E"],!1,!1),V=/^[+\-]/,W=Be(["+","-"],!1,!1),z=Ge("NULL",!0),J=Ge("TRUE",!0),Q=Ge("FALSE",!0),Z=Ge("IN",!0),Y=Ge("IS",!0),H=Ge("LIKE",!0),K=Ge("ESCAPE",!0),X=Ge("NOT",!0),$=Ge("AND",!0),ee=Ge("OR",!0),te=Ge("BETWEEN",!0),re=Ge("FROM",!0),ne=Ge("FOR",!0),ae=Ge("SUBSTRING",!0),ie=Ge("EXTRACT",!0),oe=Ge("TRIM",!0),se=Ge("POSITION",!0),ue=Ge("TIMESTAMP",!0),le=Ge("DATE",!0),ce=Ge("LEADING",!0),pe=Ge("TRAILING",!0),fe=Ge("BOTH",!0),de=Ge("TO",!0),he=Ge("INTERVAL",!0),ye=Ge("YEAR",!0),ve=Ge("MONTH",!0),ge=Ge("DAY",!0),me=Ge("HOUR",!0),_e=Ge("MINUTE",!0),Se=Ge("SECOND",!0),be=Ge("CASE",!0),we=Ge("END",!0),Fe=Ge("WHEN",!0),xe=Ge("THEN",!0),Ie=Ge("ELSE",!0),Te=Ge(",",!1),Re=Ge("(",!1),Ce=Ge(")",!1),Ee=/^[ \t\n\r]/,Ne=Be([" ","\t","\n","\r"],!1,!1),Ae=Ge("`",!1),De=/^[^`]/,ke=Be(["`"],!0,!1),Pe=0,Oe=[{line:1,column:1}],Me=0,Le=[],je=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');o=i[r.startRule]}function Ge(e,t){return{type:"literal",text:e,ignoreCase:t}}function Be(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function qe(e){var r,n=Oe[e];if(n)return n;for(r=e-1;!Oe[r];)r--;for(n={line:(n=Oe[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Oe[e]=n,n}function Ue(e,t){var r=qe(e),n=qe(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Ve(e){Pe<Me||(Pe>Me&&(Me=Pe,Le=[]),Le.push(e))}function We(){var e,t;return e=Pe,Jt()!==a&&(t=Je())!==a&&Jt()!==a?e=t:(Pe=e,e=a),e}function ze(){var e,t,r,n,i,o,s,u;if(e=Pe,(t=Je())!==a){for(r=[],n=Pe,(i=Jt())!==a&&(o=Vt())!==a&&(s=Jt())!==a&&(u=Je())!==a?n=i=[i,o,s,u]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=Jt())!==a&&(o=Vt())!==a&&(s=Jt())!==a&&(u=Je())!==a?n=i=[i,o,s,u]:(Pe=n,n=a);r!==a?e=t=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r}(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function Je(){var e,t,r,n,i,o,u,l;if(e=Pe,(t=Qe())!==a){for(r=[],n=Pe,(i=Jt())!==a&&(o=Ct())!==a&&(u=Jt())!==a&&(l=Qe())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=Jt())!==a&&(o=Ct())!==a&&(u=Jt())!==a&&(l=Qe())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);r!==a?e=t=s(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function Qe(){var e,t,r,n,i,o,u,l;if(e=Pe,(t=Ze())!==a){for(r=[],n=Pe,(i=Jt())!==a&&(o=Rt())!==a&&(u=Jt())!==a&&(l=Ze())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=Jt())!==a&&(o=Rt())!==a&&(u=Jt())!==a&&(l=Ze())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);r!==a?e=t=s(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function Ze(){var e,r,n,i,o;return e=Pe,(r=Tt())===a&&(r=Pe,33===t.charCodeAt(Pe)?(n="!",Pe++):(n=a,0===je&&Ve(u)),n!==a?(i=Pe,je++,61===t.charCodeAt(Pe)?(o="=",Pe++):(o=a,0===je&&Ve(l)),je--,o===a?i=void 0:(Pe=i,i=a),i!==a?r=n=[n,i]:(Pe=r,r=a)):(Pe=r,r=a)),r!==a&&(n=Jt())!==a&&(i=Ze())!==a?e=r={type:"unary_expr",operator:"NOT",expr:i}:(Pe=e,e=a),e===a&&(e=function(){var e,r,n;return e=Pe,(r=Xe())!==a&&Jt()!==a?((n=function(){var e;return(e=function(){var e,t,r,n,i,o;if(Pe,e=[],t=Pe,(r=Jt())!==a&&(n=Ye())!==a&&(i=Jt())!==a&&(o=Xe())!==a?t=r=[r,n,i,o]:(Pe=t,t=a),t!==a)for(;t!==a;)e.push(t),t=Pe,(r=Jt())!==a&&(n=Ye())!==a&&(i=Jt())!==a&&(o=Xe())!==a?t=r=[r,n,i,o]:(Pe=t,t=a);else e=a;return e!==a&&(e={type:"arithmetic",tail:e}),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=Ke())!==a&&Jt()!==a&&(r=Wt())!==a&&Jt()!==a&&(n=ze())!==a&&Jt()!==a&&zt()!==a?e=t={op:t,right:n}:(Pe=e,e=a),e===a&&(e=Pe,(t=Ke())!==a&&Jt()!==a&&(r=Wt())!==a&&Jt()!==a&&(n=zt())!==a?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Pe=e,e=a),e===a&&(e=Pe,(t=Ke())!==a&&Jt()!==a&&(r=st())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=a))),e}())===a&&(e=function(){var e,t,r,n,i,o;return e=Pe,(t=Tt())!==a&&Jt()!==a&&(r=Et())!==a&&Jt()!==a&&(n=Xe())!==a&&Jt()!==a&&(i=Rt())!==a&&Jt()!==a&&(o=Xe())!==a?e=t={op:"NOT"+r,right:{type:"expr_list",value:[n,o]}}:(Pe=e,e=a),e===a&&(e=Pe,(t=Et())!==a&&Jt()!==a&&(r=Xe())!==a&&Jt()!==a&&(n=Rt())!==a&&Jt()!==a&&(i=Xe())!==a?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,i):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=xt())!==a&&Jt()!==a&&(r=Tt())!==a&&Jt()!==a&&(n=Xe())!==a?e=t={op:t+"NOT",right:n}:(Pe=e,e=a),e===a&&(e=Pe,(t=xt())!==a&&Jt()!==a&&(r=Xe())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=a)),e}())===a&&(e=function(){var e,r,n,i;return e=Pe,(r=He())!==a&&Jt()!==a&&(n=dt())!==a&&Jt()!==a&&function(){var e,r,n,i;return e=Pe,"escape"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===je&&Ve(K)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="ESCAPE":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&(i=ht())!==a?e=r={op:r,right:n,escape:i.value}:(Pe=e,e=a),e===a&&(e=Pe,(r=He())!==a&&Jt()!==a&&(n=dt())!==a?e=r=function(e,t){return{op:e,right:t,escape:""}}(r,n):(Pe=e,e=a)),e}()),e}())===a&&(n=null),n!==a?e=r=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Yt(e,t.tail):Zt(t.op,e,t.right,t.escape)}(r,n):(Pe=e,e=a)):(Pe=e,e=a),e}()),e}function Ye(){var e;return">="===t.substr(Pe,2)?(e=">=",Pe+=2):(e=a,0===je&&Ve(c)),e===a&&(62===t.charCodeAt(Pe)?(e=">",Pe++):(e=a,0===je&&Ve(p)),e===a&&("<="===t.substr(Pe,2)?(e="<=",Pe+=2):(e=a,0===je&&Ve(f)),e===a&&("<>"===t.substr(Pe,2)?(e="<>",Pe+=2):(e=a,0===je&&Ve(d)),e===a&&(60===t.charCodeAt(Pe)?(e="<",Pe++):(e=a,0===je&&Ve(h)),e===a&&(61===t.charCodeAt(Pe)?(e="=",Pe++):(e=a,0===je&&Ve(l)),e===a&&("!="===t.substr(Pe,2)?(e="!=",Pe+=2):(e=a,0===je&&Ve(y)))))))),e}function He(){var e,t,r,n,i;return e=Pe,t=Pe,(r=Tt())!==a&&(n=Jt())!==a&&(i=It())!==a?t=r=[r,n,i]:(Pe=t,t=a),t!==a&&(t=v(t)),(e=t)===a&&(e=It()),e}function Ke(){var e,t,r,n,i;return e=Pe,t=Pe,(r=Tt())!==a&&(n=Jt())!==a&&(i=Ft())!==a?t=r=[r,n,i]:(Pe=t,t=a),t!==a&&(t=v(t)),(e=t)===a&&(e=Ft()),e}function Xe(){var e,t,r,n,i,o,u,l;if(e=Pe,(t=et())!==a){for(r=[],n=Pe,(i=Jt())!==a&&(o=$e())!==a&&(u=Jt())!==a&&(l=et())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=Jt())!==a&&(o=$e())!==a&&(u=Jt())!==a&&(l=et())!==a?n=i=[i,o,u,l]:(Pe=n,n=a);r!==a?e=t=s(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function $e(){var e;return 43===t.charCodeAt(Pe)?(e="+",Pe++):(e=a,0===je&&Ve(g)),e===a&&(45===t.charCodeAt(Pe)?(e="-",Pe++):(e=a,0===je&&Ve(m))),e}function et(){var e,t,r,n,i,o,s,u;if(e=Pe,(t=rt())!==a){for(r=[],n=Pe,(i=Jt())!==a&&(o=tt())!==a&&(s=Jt())!==a&&(u=rt())!==a?n=i=[i,o,s,u]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=Jt())!==a&&(o=tt())!==a&&(s=Jt())!==a&&(u=rt())!==a?n=i=[i,o,s,u]:(Pe=n,n=a);r!==a?e=t=Yt(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function tt(){var e;return 42===t.charCodeAt(Pe)?(e="*",Pe++):(e=a,0===je&&Ve(_)),e===a&&(47===t.charCodeAt(Pe)?(e="/",Pe++):(e=a,0===je&&Ve(S))),e}function rt(){var e,r,n;return(e=function(){var e;return(e=ht())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=function(){var e,t,r,n;return e=Pe,(t=mt())!==a&&(r=_t())!==a&&(n=St())!==a?e=t=parseFloat(t+r+n):(Pe=e,e=a),e===a&&(e=Pe,(t=mt())!==a&&(r=_t())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=mt())!==a&&(r=St())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=mt())!==a&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==a?(r=Pe,je++,n=at(),je--,n===a?r=void 0:(Pe=r,r=a),r!==a?e=t={type:"number",value:t}:(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,r;return e=Pe,(r=function(){var e,r,n,i;return e=Pe,"true"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(J)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}())!==a&&(r={type:"bool",value:!0}),(e=r)===a&&(e=Pe,(r=function(){var e,r,n,i;return e=Pe,"false"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=a,0===je&&Ve(Q)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}())!==a&&(r={type:"bool",value:!1}),e=r),e}())===a&&(e=function(){var e;return Pe,(e=function(){var e,r,n,i;return e=Pe,"null"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(z)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}())!==a&&(e={type:"null",value:null}),e}())===a&&(e=function(){var e,r;return e=Pe,function(){var e,r,n,i;return e=Pe,"date"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(le)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="DATE":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&(r=dt())!==a?e={type:"date",value:r.value}:(Pe=e,e=a),e}())===a&&(e=function(){var e,r;return e=Pe,function(){var e,r,n,i;return e=Pe,"timestamp"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=a,0===je&&Ve(ue)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TIMESTAMP":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&(r=dt())!==a?e={type:"timestamp",value:r.value}:(Pe=e,e=a),e}())===a&&(e=function(){var e,r,n,i;return e=Pe,Dt()!==a&&Jt()!==a?(45===t.charCodeAt(Pe)?(r="-",Pe++):(r=a,0===je&&Ve(m)),r===a&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=a,0===je&&Ve(g))),r!==a&&Jt()!==a&&(n=dt())!==a&&Jt()!==a&&(i=lt())!==a?e={type:"interval",value:n,qualifier:i,op:r}:(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,Dt()!==a&&Jt()!==a&&(r=dt())!==a&&Jt()!==a&&(n=lt())!==a?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,n):(Pe=e,e=a)),e}()),e}())===a&&(e=function(){var e,r,n;return e=Pe,function(){var e,r,n,i;return e=Pe,"extract"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===je&&Ve(ie)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="EXTRACT":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=function(){var e;return(e=kt())===a&&(e=Pt())===a&&(e=Ot())===a&&(e=Mt())===a&&(e=Lt())===a&&(e=jt()),e}())!==a&&Jt()!==a&&Nt()!==a&&Jt()!==a&&(n=Je())!==a&&Jt()!==a&&zt()!==a?e={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:r},n]}}:(Pe=e,e=a),e}())===a&&(e=function(){var e,r,n,i,o,s,u,l,c,p,f;return e=Pe,function(){var e,r,n,i;return e=Pe,"substring"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=a,0===je&&Ve(ae)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="SUBSTRING":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=Je())!==a&&Jt()!==a&&Nt()!==a&&Jt()!==a&&(n=Je())!==a&&Jt()!==a?(i=Pe,(o=function(){var e,r,n,i;return e=Pe,"for"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===je&&Ve(ne)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="FOR":(Pe=e,e=a)):(Pe=e,e=a),e}())!==a&&(s=Jt())!==a&&(u=Je())!==a&&(l=Jt())!==a?i=o=[o,s,u,l]:(Pe=i,i=a),i===a&&(i=null),i!==a&&(o=zt())!==a?(c=r,p=n,e={type:"function",name:"substring",args:{type:"expr_list",value:(f=i)?[c,p,f[2]]:[c,p]}}):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,r,n,i;return e=Pe,At()!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a?((t=ut())===a&&(t=null),t!==a&&Jt()!==a&&(r=Je())!==a&&Jt()!==a&&Nt()!==a&&Jt()!==a&&(n=Je())!==a&&Jt()!==a&&zt()!==a?e={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==(i=t)?"BOTH":i},r,n]}}:(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,At()!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a?((t=ut())===a&&(t=null),t!==a&&Jt()!==a&&(r=Je())!==a&&Jt()!==a&&zt()!==a?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Pe=e,e=a)):(Pe=e,e=a)),e}())===a&&(e=function(){var e,r,n;return e=Pe,function(){var e,r,n,i;return e=Pe,"position"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===je&&Ve(se)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="POSITION":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=Je())!==a&&Jt()!==a&&Ft()!==a&&Jt()!==a&&(n=Je())!==a&&Jt()!==a&&zt()!==a?e={type:"function",name:"position",args:{type:"expr_list",value:[r,n]}}:(Pe=e,e=a),e}())===a&&(e=function(){var e,r,n;return e=Pe,(r=function(){var e,r,n,i;if(e=Pe,(r=nt())!==a&&(r=r),(e=r)===a)if(e=Pe,96===t.charCodeAt(Pe)?(r="`",Pe++):(r=a,0===je&&Ve(Ae)),r!==a){if(n=[],De.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===je&&Ve(ke)),i!==a)for(;i!==a;)n.push(i),De.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===je&&Ve(ke));else n=a;n!==a?(96===t.charCodeAt(Pe)?(i="`",Pe++):(i=a,0===je&&Ve(Ae)),i!==a?e=r=n.join(""):(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a?((n=ze())===a&&(n=null),n!==a&&Jt()!==a&&zt()!==a?e=r={type:"function",name:r,args:n||{type:"expr_list",value:[]}}:(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e;return(e=function(){var e,t,r,n,i;if(e=Pe,Gt()!==a)if(Jt()!==a)if((t=Je())!==a)if(Jt()!==a){for(r=[],n=vt();n!==a;)r.push(n),n=vt();r!==a&&(n=Jt())!==a&&(i=Bt())!==a?e={type:"case_expression",format:"simple",operand:t,clauses:r,else:null}:(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,Gt()!==a)if(Jt()!==a)if((t=Je())!==a)if(Jt()!==a){for(r=[],n=vt();n!==a;)r.push(n),n=vt();r!==a&&(n=Jt())!==a&&(i=gt())!==a&&Jt()!==a&&Bt()!==a?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,i):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;return e}())===a&&(e=function(){var e,t,r,n;if(e=Pe,Gt()!==a)if(Jt()!==a){for(t=[],r=yt();r!==a;)t.push(r),r=yt();t!==a&&(r=Jt())!==a&&(n=Bt())!==a?e={type:"case_expression",format:"searched",clauses:t,else:null}:(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,Gt()!==a)if(Jt()!==a){for(t=[],r=yt();r!==a;)t.push(r),r=yt();t!==a&&(r=Jt())!==a&&(n=gt())!==a&&Jt()!==a&&Bt()!==a?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,n):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;return e}()),e}())===a&&(e=function(){var e,t;return Pe,(e=function(){var e;return Pe,(e=function(){var e,t,r,n;if(e=Pe,(t=at())!==a){for(r=[],n=ot();n!==a;)r.push(n),n=ot();r!==a?e=t=b(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}())!==a&&(e=e),e}())!==a&&(e=/^CURRENT_DATE$/i.test(t=e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(t)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:t}),e}())===a&&(e=st())===a&&(e=Pe,Wt()!==a&&Jt()!==a&&(r=Je())!==a&&Jt()!==a&&zt()!==a?((n=r).paren=!0,e=n):(Pe=e,e=a)),e}function nt(){var e,t,r,n;if(e=Pe,(t=at())!==a){for(r=[],n=it();n!==a;)r.push(n),n=it();r!==a?e=t=b(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function at(){var e;return w.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===je&&Ve(F)),e}function it(){var e;return x.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===je&&Ve(I)),e}function ot(){var e;return T.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===je&&Ve(R)),e}function st(){var e,r,n;return Pe,e=Pe,64===t.charCodeAt(Pe)?(r="@",Pe++):(r=a,0===je&&Ve(C)),r!==a&&(n=nt())!==a?e=r=[r,n]:(Pe=e,e=a),e!==a&&(e={type:"param",value:e[1]}),e}function ut(){var e;return(e=function(){var e,r,n,i;return e=Pe,"leading"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===je&&Ve(ce)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="LEADING":(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,r,n,i;return e=Pe,"trailing"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===je&&Ve(pe)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TRAILING":(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,r,n,i;return e=Pe,"both"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(fe)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="BOTH":(Pe=e,e=a)):(Pe=e,e=a),e}()),e}function lt(){var e,r,n;return e=Pe,(r=function(){var e,t,r,n;return e=Pe,(t=ct())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=ft())!==a&&Jt()!==a&&zt()!==a?(n=r,e=t={type:"interval-period",period:t.value,precision:n,secondary:null}):(Pe=e,e=a),e===a&&(e=Pe,(t=ct())!==a&&(t=E(t)),e=t),e}())!==a&&Jt()!==a&&function(){var e,r,n,i;return e=Pe,"to"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===je&&Ve(de)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TO":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&(n=function(){var e,t,r,n;return e=Pe,(t=ct())!==a&&(t={type:"interval-period",period:t.value,precision:null,secondary:null}),(e=t)===a&&(e=Pe,(t=jt())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=ft())!==a&&Jt()!==a&&Vt()!==a&&Jt()!==a&&(n=pt())!==a&&Jt()!==a&&zt()!==a?e=t=N(r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=jt())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=ft())!==a&&Jt()!==a&&zt()!==a?e=t={type:"interval-period",period:"second",precision:r,secondary:null}:(Pe=e,e=a),e===a&&(e=Pe,(t=jt())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==a?e=r={type:"interval-qualifier",start:r,end:n}:(Pe=e,e=a),e===a&&(e=function(){var e,t,r,n,i;return e=Pe,(t=ct())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=pt())!==a&&Jt()!==a&&zt()!==a?(i=r,e=t={type:"interval-period",period:t.value,precision:i,secondary:null}):(Pe=e,e=a),e===a&&(e=Pe,(t=ct())!==a&&(t=E(t)),(e=t)===a&&(e=Pe,(t=jt())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=ft())!==a&&Jt()!==a&&Vt()!==a&&Jt()!==a&&(n=pt())!==a&&Jt()!==a&&zt()!==a?e=t=N(r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=jt())!==a&&Jt()!==a&&Wt()!==a&&Jt()!==a&&(r=pt())!==a&&Jt()!==a&&zt()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=a),e===a&&(e=Pe,(t=jt())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ct(){var e,t;return e=Pe,(t=Ot())!==a&&(t={type:"string",value:"day"}),(e=t)===a&&(e=Pe,(t=Mt())!==a&&(t={type:"string",value:"hour"}),(e=t)===a&&(e=Pe,(t=Lt())!==a&&(t={type:"string",value:"minute"}),(e=t)===a&&(e=Pe,(t=Pt())!==a&&(t={type:"string",value:"month"}),(e=t)===a&&(e=Pe,(t=kt())!==a&&(t={type:"string",value:"year"}),e=t)))),e}function pt(){var e;return Pe,(e=bt())!==a&&(e=A(e)),e}function ft(){var e;return Pe,(e=bt())!==a&&(e=A(e)),e}function dt(){var e;return(e=ht())===a&&(e=st()),e}function ht(){var e,r,n,i,o;if(e=Pe,39===t.charCodeAt(Pe)?(r="'",Pe++):(r=a,0===je&&Ve(D)),r===a&&("N'"===t.substr(Pe,2)?(r="N'",Pe+=2):(r=a,0===je&&Ve(k))),r!==a){for(n=[],i=Pe,"''"===t.substr(Pe,2)?(o="''",Pe+=2):(o=a,0===je&&Ve(P)),o!==a&&(o="'"),(i=o)===a&&(O.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===je&&Ve(M)));i!==a;)n.push(i),i=Pe,"''"===t.substr(Pe,2)?(o="''",Pe+=2):(o=a,0===je&&Ve(P)),o!==a&&(o="'"),(i=o)===a&&(O.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===je&&Ve(M)));n!==a?(39===t.charCodeAt(Pe)?(i="'",Pe++):(i=a,0===je&&Ve(D)),i!==a?e=r={type:"string",value:n.join("")}:(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}function yt(){var e,t,r;return e=Pe,qt()!==a&&Jt()!==a&&(t=Je())!==a&&Jt()!==a&&Ut()!==a&&Jt()!==a&&(r=Je())!==a?e=L(t,r):(Pe=e,e=a),e}function vt(){var e,t,r;return e=Pe,qt()!==a&&Jt()!==a&&(t=Je())!==a&&Jt()!==a&&Ut()!==a&&Jt()!==a&&(r=Je())!==a?e=L(t,r):(Pe=e,e=a),e}function gt(){var e,r;return e=Pe,function(){var e,r,n,i;return e=Pe,"else"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(Ie)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="ELSE":(Pe=e,e=a)):(Pe=e,e=a),e}()!==a&&Jt()!==a&&(r=Je())!==a?e={type:"else_clause",value:r}:(Pe=e,e=a),e}function mt(){var e,r,n,i;return(e=bt())===a&&(e=Pe,45===t.charCodeAt(Pe)?(r="-",Pe++):(r=a,0===je&&Ve(m)),r===a&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=a,0===je&&Ve(g))),r!==a&&(n=bt())!==a?(i=n,e=r=r[0]+i):(Pe=e,e=a)),e}function _t(){var e,r,n,i;return e=Pe,46===t.charCodeAt(Pe)?(r=".",Pe++):(r=a,0===je&&Ve(j)),r!==a?((n=bt())===a&&(n=null),n!==a?e=r="."+(null!=(i=n)?i:""):(Pe=e,e=a)):(Pe=e,e=a),e}function St(){var e,r,n;return e=Pe,(r=function(){var e,r,n,i;return e=Pe,q.test(t.charAt(Pe))?(r=t.charAt(Pe),Pe++):(r=a,0===je&&Ve(U)),r!==a?(V.test(t.charAt(Pe))?(n=t.charAt(Pe),Pe++):(n=a,0===je&&Ve(W)),n===a&&(n=null),n!==a?e=r="e"+(null===(i=n)?"":i):(Pe=e,e=a)):(Pe=e,e=a),e}())!==a&&(n=bt())!==a?e=r+=n:(Pe=e,e=a),e}function bt(){var e,t;if(Pe,e=[],(t=wt())!==a)for(;t!==a;)e.push(t),t=wt();else e=a;return e!==a&&(e=e.join("")),e}function wt(){var e;return G.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===je&&Ve(B)),e}function Ft(){var e,r,n,i;return e=Pe,"in"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===je&&Ve(Z)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="IN":(Pe=e,e=a)):(Pe=e,e=a),e}function xt(){var e,r,n,i;return e=Pe,"is"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===je&&Ve(Y)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="IS":(Pe=e,e=a)):(Pe=e,e=a),e}function It(){var e,r,n,i;return e=Pe,"like"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(H)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="LIKE":(Pe=e,e=a)):(Pe=e,e=a),e}function Tt(){var e,r,n,i;return e=Pe,"not"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===je&&Ve(X)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="NOT":(Pe=e,e=a)):(Pe=e,e=a),e}function Rt(){var e,r,n,i;return e=Pe,"and"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===je&&Ve($)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="AND":(Pe=e,e=a)):(Pe=e,e=a),e}function Ct(){var e,r,n,i;return e=Pe,"or"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===je&&Ve(ee)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="OR":(Pe=e,e=a)):(Pe=e,e=a),e}function Et(){var e,r,n,i;return e=Pe,"between"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===je&&Ve(te)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="BETWEEN":(Pe=e,e=a)):(Pe=e,e=a),e}function Nt(){var e,r,n,i;return e=Pe,"from"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(re)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="FROM":(Pe=e,e=a)):(Pe=e,e=a),e}function At(){var e,r,n,i;return e=Pe,"trim"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(oe)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TRIM":(Pe=e,e=a)):(Pe=e,e=a),e}function Dt(){var e,r,n,i;return e=Pe,"interval"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===je&&Ve(he)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="INTERVAL":(Pe=e,e=a)):(Pe=e,e=a),e}function kt(){var e,r,n,i;return e=Pe,"year"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(ye)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="YEAR":(Pe=e,e=a)):(Pe=e,e=a),e}function Pt(){var e,r,n,i;return e=Pe,"month"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=a,0===je&&Ve(ve)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="MONTH":(Pe=e,e=a)):(Pe=e,e=a),e}function Ot(){var e,r,n,i;return e=Pe,"day"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===je&&Ve(ge)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="DAY":(Pe=e,e=a)):(Pe=e,e=a),e}function Mt(){var e,r,n,i;return e=Pe,"hour"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(me)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="HOUR":(Pe=e,e=a)):(Pe=e,e=a),e}function Lt(){var e,r,n,i;return e=Pe,"minute"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===je&&Ve(_e)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="MINUTE":(Pe=e,e=a)):(Pe=e,e=a),e}function jt(){var e,r,n,i;return e=Pe,"second"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===je&&Ve(Se)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="SECOND":(Pe=e,e=a)):(Pe=e,e=a),e}function Gt(){var e,r,n,i;return e=Pe,"case"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(be)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="CASE":(Pe=e,e=a)):(Pe=e,e=a),e}function Bt(){var e,r,n,i;return e=Pe,"end"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===je&&Ve(we)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="END":(Pe=e,e=a)):(Pe=e,e=a),e}function qt(){var e,r,n,i;return e=Pe,"when"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(Fe)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="WHEN":(Pe=e,e=a)):(Pe=e,e=a),e}function Ut(){var e,r,n,i;return e=Pe,"then"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===je&&Ve(xe)),r!==a?(n=Pe,je++,i=it(),je--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="THEN":(Pe=e,e=a)):(Pe=e,e=a),e}function Vt(){var e;return 44===t.charCodeAt(Pe)?(e=",",Pe++):(e=a,0===je&&Ve(Te)),e}function Wt(){var e;return 40===t.charCodeAt(Pe)?(e="(",Pe++):(e=a,0===je&&Ve(Re)),e}function zt(){var e;return 41===t.charCodeAt(Pe)?(e=")",Pe++):(e=a,0===je&&Ve(Ce)),e}function Jt(){var e,t;for(e=[],t=Qt();t!==a;)e.push(t),t=Qt();return e}function Qt(){var e;return Ee.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===je&&Ve(Ne)),e}function Zt(e,t,r,n){var a={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(a.escape=n),a}function Yt(e,t){for(var r=e,n=0;n<t.length;n++)r=Zt(t[n][1],r,t[n][3]);return r}if((n=o())!==a&&Pe===t.length)return n;throw n!==a&&Pe<t.length&&Ve({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(Le,Me<t.length?t.charAt(Me):null,Me<t.length?Ue(Me,Me+1):Ue(Me,Me))}}}.apply(null,[]))||(e.exports=n)},1146:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(9),r(5),r(900),r(1147),r(1148)],void 0===(a=function(e,t,r,n,a,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=n.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function p(e){return e>=u.length?null:u[e]}function f(e){return e>=c.length?null:c[e]}function d(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function h(e,t,r){for(var n=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var a=e.getUInt32(),i=e.pos()+a,o=0;e.pos()<i;)t.addCoordinatePoint(n,e.getSInt64(),0,o++);break;case 1:case 2:default:e.skip()}return n}function y(e,t,r){for(var n=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),o=e.pos()+i,s=0;e.pos()<o;)t.addLength(n,e.getUInt32(),s++);break;case 3:for(var u=e.getUInt32(),l=(o=e.pos()+u,0),c=0;e.pos()<o;)t.addCoordinate(n,e.getSInt64(),c,l),++l===a&&(c++,l=0);break;case 1:default:e.skip()}return n}function v(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g(e){for(var t,r={type:p(0)};e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.type=p(e.getEnum());break;case 3:r.alias=e.getString();break;case 4:r.sqlType=(t=e.getEnum())>=l.length?null:l[t];break;case 5:case 6:default:e.skip()}return r}function m(e,t,r,n){for(var a=t.createFeature(r),i=0;e.next();)switch(e.tag()){case 1:var o=n[i++].name;a.attributes[o]=e.processMessage(v);break;case 2:a.geometry=e.processMessageWithArgs(y,t,r);break;case 4:a.centroid=e.processMessageWithArgs(h,t,r);break;default:e.skip()}return a}function _(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function S(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function b(e){for(var t={originPosition:f(0)};e.next();)switch(e.tag()){case 1:t.originPosition=f(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(S);break;default:e.skip()}return t}function w(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function F(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function x(e,t){var r=t.createFeatureResult();r.geometryType=d(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(w);break;case 7:r.geometryType=d(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(F,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(b);break;case 9:var a=e.getBool();r.exceededTransferLimit=a;break;case 13:t.addField(r,e.processMessage(g));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(m,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function I(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(x,t);break;default:e.skip()}return r}t.parseFeatureQuery=function(e,t){var n=function(e){return e&&"dehydrated"===e.type?new i.Context(e):new o.Context(e)}(t);try{for(var u=new a(new Uint8Array(e),new DataView(e)),l={};u.next();)switch(u.tag()){case 2:l.queryResult=u.processMessageWithArgs(I,n);break;default:u.skip()}return l}catch(e){var c=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return s.error(c),{queryResult:{featureResult:n.createFeatureResult()}}}}}.apply(null,n))||(e.exports=a)},1147:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(240),r(29),r(28),r(1119),r(851),r(1047)],void 0===(a=function(e,t,r,n,a,i,o,s){function u(e,t){return t}function l(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:h)(e,t+n,1)}}function c(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:h)(e,t+n,1);case 2:return d(e,t,2)}}function p(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:h)(e,t+n,1);case 2:return d(e,t,3)}}function f(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:h)(e,t+n,1);case 2:return d(e,t,2);case 3:return d(e,t,3)}}function d(e,t,r){var n=e.translate,a=e.scale;return n[r]+t*a[r]}function h(e,t,r){var n=e.translate,a=e.scale;return n[r]-t*a[r]}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new i.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=s.getGeometryZScaler(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(var r=0,n=e.features;r<n.length;r++)t(n[r].geometry)}},e.prototype.createSpatialReference=function(){return new a},e.prototype.addField=function(e,t){e.fields.push(o.fromJSON(t));var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var n in t.attributes){var a=t.attributes[n];"string"==typeof a&&a.length>r&&(t.attributes[n]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){var t=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,r,n,a){return t.addCoordinatePoint(e,r,a)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,r,n,a){return t.addCoordinatePolygon(e,r,a)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,r,n,a){return t.addCoordinatePolyline(e,r,a)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,r,n,a){return t.addCoordinateMultipoint(e,r,a)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:n.neverReached(e.geometryType)}},e.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new i.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},e.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var n=this.lengths.reduce((function(e,t){return e+t}),0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var a=this.transformPathLikeValue(t,r),i=e[e.length-1];0===r&&i.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=a},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?f:t?c:r?p:l},e}();t.Context=y}.apply(null,n))||(e.exports=a)},1148:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(97),r(37),r(265),r(278),r(243)],void 0===(a=function(e,t,r,n,a,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!n.equals(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=r.getMetersPerVerticalUnitForSR(this.options.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==t)for(var a=0,i=e.features;a<i.length;a++){var o=i[a];if(o.geometry&&o.geometry.coords)for(var s=o.geometry.coords,u=2;u<s.length;u+=3)s[u]*=t}}},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new a.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new o.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new o.default},e}();t.Context=s}.apply(null,n))||(e.exports=a)},1173:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,n,a,i,o){return r((s=r(r(t,e),r(a,o)))<<(u=i)|s>>>32-u,n);var s,u}function a(e,t,r,a,i,o,s){return n(t&r|~t&a,e,t,i,o,s)}function i(e,t,r,a,i,o,s){return n(t&a|r&~a,e,t,i,o,s)}function o(e,t,r,a,i,o,s){return n(t^r^a,e,t,i,o,s)}function s(e,t,r,a,i,o,s){return n(r^(t|~a),e,t,i,o,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.outputTypes={Base64:0,Hex:1,String:2,Raw:3},t.createMD5Hash=function(e,n){void 0===n&&(n=t.outputTypes.Hex);var u=n||t.outputTypes.Base64,l=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,u=-271733879,l=-1732584194,c=271733878,p=0;p<e.length;p+=16){var f=n,d=u,h=l,y=c;n=a(n,u,l,c,e[p+0],7,-680876936),c=a(c,n,u,l,e[p+1],12,-389564586),l=a(l,c,n,u,e[p+2],17,606105819),u=a(u,l,c,n,e[p+3],22,-1044525330),n=a(n,u,l,c,e[p+4],7,-176418897),c=a(c,n,u,l,e[p+5],12,1200080426),l=a(l,c,n,u,e[p+6],17,-1473231341),u=a(u,l,c,n,e[p+7],22,-45705983),n=a(n,u,l,c,e[p+8],7,1770035416),c=a(c,n,u,l,e[p+9],12,-1958414417),l=a(l,c,n,u,e[p+10],17,-42063),u=a(u,l,c,n,e[p+11],22,-1990404162),n=a(n,u,l,c,e[p+12],7,1804603682),c=a(c,n,u,l,e[p+13],12,-40341101),l=a(l,c,n,u,e[p+14],17,-1502002290),n=i(n,u=a(u,l,c,n,e[p+15],22,1236535329),l,c,e[p+1],5,-165796510),c=i(c,n,u,l,e[p+6],9,-1069501632),l=i(l,c,n,u,e[p+11],14,643717713),u=i(u,l,c,n,e[p+0],20,-373897302),n=i(n,u,l,c,e[p+5],5,-701558691),c=i(c,n,u,l,e[p+10],9,38016083),l=i(l,c,n,u,e[p+15],14,-660478335),u=i(u,l,c,n,e[p+4],20,-405537848),n=i(n,u,l,c,e[p+9],5,568446438),c=i(c,n,u,l,e[p+14],9,-1019803690),l=i(l,c,n,u,e[p+3],14,-187363961),u=i(u,l,c,n,e[p+8],20,1163531501),n=i(n,u,l,c,e[p+13],5,-1444681467),c=i(c,n,u,l,e[p+2],9,-51403784),l=i(l,c,n,u,e[p+7],14,1735328473),n=o(n,u=i(u,l,c,n,e[p+12],20,-1926607734),l,c,e[p+5],4,-378558),c=o(c,n,u,l,e[p+8],11,-2022574463),l=o(l,c,n,u,e[p+11],16,1839030562),u=o(u,l,c,n,e[p+14],23,-35309556),n=o(n,u,l,c,e[p+1],4,-1530992060),c=o(c,n,u,l,e[p+4],11,1272893353),l=o(l,c,n,u,e[p+7],16,-155497632),u=o(u,l,c,n,e[p+10],23,-1094730640),n=o(n,u,l,c,e[p+13],4,681279174),c=o(c,n,u,l,e[p+0],11,-358537222),l=o(l,c,n,u,e[p+3],16,-722521979),u=o(u,l,c,n,e[p+6],23,76029189),n=o(n,u,l,c,e[p+9],4,-640364487),c=o(c,n,u,l,e[p+12],11,-421815835),l=o(l,c,n,u,e[p+15],16,530742520),n=s(n,u=o(u,l,c,n,e[p+2],23,-995338651),l,c,e[p+0],6,-198630844),c=s(c,n,u,l,e[p+7],10,1126891415),l=s(l,c,n,u,e[p+14],15,-1416354905),u=s(u,l,c,n,e[p+5],21,-57434055),n=s(n,u,l,c,e[p+12],6,1700485571),c=s(c,n,u,l,e[p+3],10,-1894986606),l=s(l,c,n,u,e[p+10],15,-1051523),u=s(u,l,c,n,e[p+1],21,-2054922799),n=s(n,u,l,c,e[p+8],6,1873313359),c=s(c,n,u,l,e[p+15],10,-30611744),l=s(l,c,n,u,e[p+6],15,-1560198380),u=s(u,l,c,n,e[p+13],21,1309151649),n=s(n,u,l,c,e[p+4],6,-145523070),c=s(c,n,u,l,e[p+11],10,-1120210379),l=s(l,c,n,u,e[p+2],15,718787259),u=s(u,l,c,n,e[p+9],21,-343485551),n=r(n,f),u=r(u,d),l=r(l,h),c=r(c,y)}return[n,u,l,c]}(function(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(u){case t.outputTypes.Raw:return l;case t.outputTypes.Hex:return function(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(l);case t.outputTypes.String:return function(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(l);case t.outputTypes.Base64:return function(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-i)&63));return t.join("")}(l)}}}.apply(null,n))||(e.exports=a)},1207:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(68),r.dj.m(e),r(44),r(146),r(148),r(45),r(30),r(159),r(1332),r(6)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p){function f(e,t){var r;if(null==e||void 0===e)return e;if("number"==typeof e)return e;var n=e.toString();if(""===n)return null;if(2==t){if(void 0!==(r=F[n]))return r}else if(0==t){if(void 0!==(r=w[n]))return r;if(void 0!==(r=x[e]))return r}else if(3==t&&void 0!==(r=w[n]))return r;if(1==t&&void 0!==(r=x[e]))return r;if(!0===/^\d+$/.test(n))return parseInt(n);throw Error("Unrecognised Unit Type")}function d(e){if(null!=e)switch(e){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function h(e){if(null==e)return null;if(b)switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m};case"multipoint":return{points:e.points,hasZ:e.hasZ,hasM:e.hasM};case"polyline":return{paths:e.paths,hasZ:e.hasZ,hasM:e.hasM};case"polygon":return{rings:e.rings,hasZ:e.hasZ,hasM:e.hasM};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax}}else switch(e.type){case"point":return{x:e.x,y:e.y};case"multipoint":return{points:e.points};case"polyline":return{paths:e.paths};case"polygon":return{rings:e.rings};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax}}return null}function y(e,t){if(null===e)return null;var r=function(e){if(void 0===s.fromJson){if(void 0!==e.x&&void 0!==e.y)return new s(e);if(void 0!==e.paths)return new o(e);if(void 0!==e.rings)return new i(e);if(void 0!==e.points)return new l(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return new u(e)}else{if(void 0!==e.x&&void 0!==e.y)return s.fromJson(e);if(void 0!==e.paths)return o.fromJson(e);if(void 0!==e.rings)return i.fromJson(e);if(void 0!==e.points)return l.fromJson(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return u.fromJson(e)}}(e);return b?r.set("spatialReference",t):r.setSpatialReference(t),r}function v(e){return null==e||void 0===e?null:-1!=e.wkid&&null!==e.wkid&&void 0!==e.wkid?{wkid:e.wkid}:""!==e.wkt&&void 0!==e.wkt&&null!==e.wkt?{wkt:e.wkt}:null}function g(e,t,r){return p.create((function(n,a){var i=t.spatialReference;T.a({action:e,geoma:h(t),geomb:h(r),spatialReference:v(t.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(y(e.result,i))}),(function(e){a(e)}))}))}function m(e,t,r){return p.create((function(n,a){T.a({action:e,geoma:h(t),geomb:h(r),spatialReference:v(t.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(e.result)}),(function(e){a(e)}))}))}var _,S,b=0==r.version.indexOf("4.");(S=_||(_={}))[S.Linear=0]="Linear",S[S.Angular=1]="Angular",S[S.Area=2]="Area",S[S.LinearOrAngular=3]="LinearOrAngular";var w={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},F={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},x={degrees:9102,radians:9101},I=function(){function t(){this.c=!0,this.i=null}return t.prototype.A=function(e){var t=this;this.i=new c,this.i.setWorker(this.l(),(function(){t.c=!1,e()}))},t.prototype.l=function(){return e.B?e.B("./geometryenginewebworker"):n.id.replace(/\/[^\/]*$/gi,"/")+"./geometryenginewebworker"},t}(),T=function(){function e(){}return e.a=function(t){return p.create((function(r,n){e.h.push({task:t,d:{resolve:r,reject:n}}),e.f()}))},e.f=function(){if(0<e.h.length){for(var t=null,r=0;r<e.b.length;r++)if(!1===e.b[r].c){t=e.b[r];break}if(null===t&&e.b.length<e.g&&(r=new I,e.b.push(r),r.A((function(){e.f()}))),null!==t){var n=this.h.shift();t.c=!0,t.i.postMessage(n.task).then((function(r){t.c=!1;try{n.d.resolve(r)}catch(e){}e.f()}),(function(r){t.c=!1;try{n.d.reject(r)}catch(e){}e.f()}))}}},e.b=[],e.h=[],e.g=4,e}();return function(){function e(){}return e._removeAllWorkers=function(){T.b=[]},e._setMaxWorkers=function(t){e._removeAllWorkers(),T.g=t},e._getMaxWorkers=function(){return T.g},e._getNumWorkers=function(){return T.b.length},e.extendedSpatialReferenceInfo=function(e){return p.create((function(t,r){T.a({action:"extendedspatialreferenceinfo",spatialReference:v(e)}).then((function(e){0===e.status?r(Error(e.error.message)):t(e.result)}),(function(e){r(e)}))}))},e.equals=function(e,t){return!(null===e&&null!==t||null===t&&null!==e)&&m("equals",e,t)},e.intersects=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("intersects",e,t)},e.touches=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("touches",e,t)},e.within=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("within",e,t)},e.disjoint=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("disjoint",e,t)},e.overlaps=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("overlaps",e,t)},e.crosses=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("crosses",e,t)},e.contains=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("contains",e,t)},e.isSimple=function(e){return m("issimple",e,null)},e.clip=function(e,t){return g("clip",e,t)},e.simplify=function(e){return p.create((function(t,r){var n=e.spatialReference;T.a({action:"simplify",geoma:h(e),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?r(Error(e.error.message)):t(y(e.result,n))}),(function(e){r(e)}))}))},e.rotate=function(e,t,r){return p.create((function(n,a){var i=e.spatialReference;if(null==r)switch(e.type){case"point":r=e;break;case"extent":r=b?e.get("center"):e.getCenter();break;default:r=b?e.get("extent").get("center"):e.getExtent().getCenter()}T.a({action:"rotate",geoma:h(e),spatialReference:v(e.spatialReference),angle:t,rotpt:h(r)}).then((function(e){0===e.status?a(Error(e.error.message)):n(y(e.result,i))}),(function(e){a(e)}))}))},e.flipHorizontal=function(e,t){return p.create((function(r,n){var a=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=b?e.get("center"):e.getCenter();break;default:t=b?e.get("extent").get("center"):e.getExtent().getCenter()}T.a({action:"fliph",geoma:h(e),spatialReference:v(e.spatialReference),flippt:h(t)}).then((function(e){0===e.status?n(Error(e.error.message)):r(y(e.result,a))}),(function(e){n(e)}))}))},e.flipVertical=function(e,t){return p.create((function(r,n){var a=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=b?e.get("center"):e.getCenter();break;default:t=b?e.get("extent").get("center"):e.getExtent().getCenter()}T.a({action:"flipv",geoma:h(e),spatialReference:v(e.spatialReference),flippt:h(t)}).then((function(e){0===e.status?n(Error(e.error.message)):r(y(e.result,a))}),(function(e){n(e)}))}))},e.distance=function(e,t,r){return p.create((function(n,a){T.a({action:"distance",geoma:h(e),geomb:h(t),spatialReference:v(e.spatialReference),distanceunits:f(r,3)}).then((function(e){0===e.status?a(Error(e.error.message)):n(e.result)}),(function(e){a(e)}))}))},e.relate=function(e,t,r){return p.create((function(n,a){T.a({action:"relate",geoma:h(e),geomb:h(t),relation:r,spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(e.result)}),(function(e){a(e)}))}))},e.nearestCoordinate=function(e,t,r){return p.create((function(n,a){var i=e.spatialReference;T.a({action:"nearestcoord",geoma:h(e),geomb:h(t),spatialReference:v(e.spatialReference),testinterior:void 0===r||r}).then((function(e){0===e.status?a(Error(e.error.message)):(e.result.coordinate=y(e.result.coordinate,i),n(e.result))}),(function(e){a(e)}))}))},e.nearestVertex=function(e,t){return p.create((function(r,n){var a=e.spatialReference;T.a({action:"nearestvertex",geoma:h(e),geomb:h(t),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?n(Error(e.error.message)):(e.result.coordinate=y(e.result.coordinate,a),r(e.result))}),(function(e){n(e)}))}))},e.nearestVertices=function(e,t,r,n){return p.create((function(a,i){var o=e.spatialReference;T.a({action:"nearestvertices",geoma:h(e),geomb:h(t),spatialReference:v(e.spatialReference),searchradius:r,maxreturn:n}).then((function(e){if(0===e.status)i(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t].coordinate=y(e.result[t].coordinate,o);a(e.result)}}),(function(e){i(e)}))}))},e.cut=function(e,t){return p.create((function(r,n){var a=e.spatialReference;T.a({action:"cut",geoma:h(e),geomb:h(t),spatialReference:v(e.spatialReference)}).then((function(e){if(0===e.status)n(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],a);r(e.result)}}),(function(e){n(e)}))}))},e.generalize=function(e,t,r,n){return p.create((function(a,i){var o=e.spatialReference;T.a({action:"generalize",geoma:h(e),maxdeviation:t,removedegenerateparts:r,maxdeviationunit:f(n,3),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?i(Error(e.error.message)):a(y(e.result,o))}),(function(e){i(e)}))}))},e.densify=function(e,t,r){return p.create((function(n,a){var i=e.spatialReference;T.a({action:"densify",geoma:h(e),maxsegmentlength:t,maxsegmentlengthunit:f(r,3),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(y(e.result,i))}),(function(e){a(e)}))}))},e.geodesicDensify=function(e,t,r,n){return void 0===n&&(n=0),p.create((function(a,i){var o=e.spatialReference;T.a({action:"geodensify",geoma:h(e),maxsegmentlength:t,maxsegmentlengthunit:f(r,3),spatialReference:v(e.spatialReference),curveType:n}).then((function(e){0===e.status?i(Error(e.error.message)):a(y(e.result,o))}),(function(e){i(e)}))}))},e.intersect=function(t,r){return t instanceof a?g("intersect",t,r):e.u(t,r)},e.u=function(e,t){return p.create((function(r,n){for(var a=[],i=0;i<e.length;i++)a.push(h(e[i]));var o=t.spatialReference;T.a({action:"intersectmany",geom:h(t),geometries:a,spatialReference:v(t.spatialReference)}).then((function(e){if(0===e.status)n(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],o);r(e.result)}}),(function(e){n(e)}))}))},e.difference=function(t,r){return t instanceof a?g("difference",t,r):e.s(t,r)},e.s=function(e,t){return p.create((function(r,n){for(var a=[],i=0;i<e.length;i++)a.push(h(e[i]));var o=t.spatialReference;T.a({action:"differencemany",geom:h(t),geometries:a,spatialReference:v(t.spatialReference)}).then((function(e){if(0===e.status)n(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],o);r(e.result)}}),(function(e){n(e)}))}))},e.symmetricDifference=function(t,r){return t instanceof a?g("symdifference",t,r):e.w(t,r)},e.w=function(e,t){return p.create((function(r,n){for(var a=[],i=0;i<e.length;i++)a.push(h(e[i]));var o=t.spatialReference;T.a({action:"symdifferencemany",geom:h(t),geometries:a,spatialReference:v(t.spatialReference)}).then((function(e){if(0===e.status)n(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],o);r(e.result)}}),(function(e){n(e)}))}))},e.union=function(e,t){return void 0===t&&(t=null),p.create((function(r,n){var i=[];if(null===e)r(null);else if(e instanceof a&&(e=[e],null!==t&&e.push(t)),0===e.length)r(null);else{for(var o=0;o<e.length;o++)i.push(h(e[o]));var s=e[0].spatialReference;T.a({action:"unionmany",geometries:i,spatialReference:v(s)}).then((function(e){0===e.status?n(Error(e.error.message)):r(y(e.result,s))}),(function(e){n(e)}))}}))},e.buffer=function(t,r,n,i){if(void 0===i&&(i=!1),t instanceof a)return p.create((function(e,a){var i=t.spatialReference;T.a({action:"buffer",geoma:h(t),spatialReference:v(t.spatialReference),distance:r,unit:f(n,3),geodesic:!1,geodesicmaxdeviation:NaN,geodesiccurvetype:0}).then((function(t){0===t.status?a(Error(t.error.message)):e(y(t.result,i))}),(function(e){a(e)}))}));if("[object Array]"!==Object.prototype.toString.call(r)){for(var o=[],s=0;s<t.length;s++)o.push(r);r=o}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");o=[];var u=0;for(s=0;s<t.length;s++)void 0===r[s]?o.push(u):(o.push(r[s]),u=r[s]);r=o}return e.j(t,r,n,!1,i,"geodesic",NaN)},e.geodesicBuffer=function(t,r,n,i,o,s){if(t instanceof a)return p.create((function(e,a){void 0===o&&(o=NaN);var s=t.spatialReference;T.a({action:"buffer",geoma:h(t),spatialReference:v(t.spatialReference),distance:r,unit:f(n,0),geodesic:!0,geodesicmaxdeviation:o,geodesiccurvetype:d(i)}).then((function(t){0===t.status?a(Error(t.error.message)):e(y(t.result,s))}),(function(e){a(e)}))}));if("[object Array]"!==Object.prototype.toString.call(r)){for(var u=[],l=0;l<t.length;l++)u.push(r);r=u}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");u=[];var c=0;for(l=0;l<t.length;l++)void 0===r[l]?u.push(c):(u.push(r[l]),c=r[l]);r=u}return e.j(t,r,n,!0,i,o,s)},e.j=function(e,t,r,n,a,i,o){return p.create((function(s,u){var l=[];if(void 0===o&&(o=NaN),null===e)s(null);else if(0===e.length)s(null);else{for(var c=0;c<e.length;c++)l.push(h(e[c]));r=f(r,n?0:3);var p=e[0].spatialReference;T.a({action:"buffermany",geometries:l,spatialReference:v(p),distances:t,tounionresults:a,unit:r,geodesic:n,geodesicmaxdeviation:o,geodesiccurvetype:d(i)}).then((function(e){if(0===e.status)u(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],p);s(e.result)}}),(function(e){u(e)}))}}))},e.convexHull=function(t,r){return void 0===r&&(r=!1),t instanceof a?p.create((function(e,r){var n=t.spatialReference;T.a({action:"convexhull",geoma:h(t),spatialReference:v(t.spatialReference)}).then((function(t){0===t.status?r(Error(t.error.message)):e(y(t.result,n))}),(function(e){r(e)}))})):e.o(t,r)},e.o=function(e,t){return p.create((function(r,n){for(var a=[],i=0;i<e.length;i++)a.push(h(e[i]));var o=0<e.length?e[0].spatialReference:null;T.a({action:"convexhullmany",geometries:a,merge:t}).then((function(e){if(0===e.status)n(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],o);r(e.result)}}),(function(e){n(e)}))}))},e.offset=function(t,r,n,i,o,s){var u=0;if(null!=i&&null!=i)switch(i){case"round":u=0;break;case"bevel":u=1;break;case"miter":u=2;break;case"square":u=3}return t instanceof a?p.create((function(e,a){var i=t.spatialReference;T.a({action:"offset",geoma:h(t),spatialReference:v(t.spatialReference),distance:r,joins:u,bevelratio:o,flattenerror:s,offsetunit:f(n,3)}).then((function(t){0===t.status?a(Error(t.error.message)):e(y(t.result,i))}),(function(e){a(e)}))})):e.v(t,r,n,u,o,s)},e.v=function(e,t,r,n,a,i){return p.create((function(o,s){for(var u=[],l=0;l<e.length;l++)u.push(h(e[l]));var c=0<e.length?e[0].spatialReference:null;T.a({action:"offsetmany",geometries:u,spatialReference:v(c),distance:t,joins:n,bevelratio:a,offsetunit:f(r,3),flattenerror:i}).then((function(e){if(0===e.status)s(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],c);o(e.result)}}),(function(e){s(e)}))}))},e.planarArea=function(e,t){return p.create((function(r,n){T.a({action:"area",geoma:h(e),unit:f(t,2),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?n(Error(e.error.message)):r(e.result)}),(function(e){n(e)}))}))},e.planarLength=function(e,t){return p.create((function(r,n){T.a({action:"length",geoma:h(e),unit:f(t,3),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?n(Error(e.error.message)):r(e.result)}),(function(e){n(e)}))}))},e.geodesicArea=function(e,t,r){return p.create((function(n,a){T.a({action:"geodesicarea",geoma:h(e),unit:f(t,2),geodesiccurvetype:d(r),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(e.result)}),(function(e){a(e)}))}))},e.geodesicLength=function(e,t,r){return p.create((function(n,a){T.a({action:"geodesiclength",geoma:h(e),unit:f(t,0),geodesiccurvetype:d(r),spatialReference:v(e.spatialReference)}).then((function(e){0===e.status?a(Error(e.error.message)):n(e.result)}),(function(e){a(e)}))}))},e}()}.apply(null,n))||(e.exports=a)},1332:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(6),r(36)],void 0===(a=function(e,t,r,n){return function(){function t(){var e=this;this.worker=null,this._queue=new Map,this._useProxy=!1,this._acceptMessage=function(t){var r=t.data,n=r.msgId;if(e._queue.has(n)){var a=e._queue.get(n);"error"===r.status?(a.reject(t.data),e._queue.delete(n)):(a.resolve(t.data),e._queue.delete(n))}},this._errorMessage=function(e){console.log("Worker Error: "+e.message+"\nIn "+e.filename+" on "+e.lineno)}}return t.prototype.setWorker=function(e,t){var r=this._getUrl(e);r=n.normalize(r);var a,i=!n.hasSameOrigin(r,location.href);if(this.worker&&((a=this.worker).removeEventListener("message",this._acceptMessage,!1),a.removeEventListener("error",this._errorMessage,!1),a.terminate(),a=null),i){var o=URL.createObjectURL(new Blob(['\nfunction actionHandler(evt) {\n  var msg = evt.data;\n  var error, success;\n\n  if (msg.action) {\n    switch (msg.action) {\n      case "import-script":\n        try {\n          if (!Array.isArray(msg.url)) {\n            msg.url = [msg.url];\n          }\n\n          importScripts(msg.url);\n          success = true;\n        }\n        catch (err) {\n          error = err;\n        }\n\n        break;\n    }\n\n    if (success) {\n      postMessage({\n        msgId: msg.msgId,\n        success: true\n      });\n    }\n    else if (error) {\n      postMessage({\n        status: "error",\n        msgId: msg.msgId,\n        message: error.message\n      });\n    }\n  }\n}\n\nself.addEventListener("message", actionHandler, false);\n'],{type:"text/javascript"}));t(this._createWorker(o,r))}else t(this._createWorker(r))},t.prototype.postMessage=function(e,t){if(!this.worker)return r.reject({message:"No worker was set."});(Array.isArray(e)||"object"!=typeof e)&&(e={data:e});var n=r.createDeferred(),a=Math.floor(64e9*Math.random()).toString(36);return e.msgId=a,this._queue.set(a,n),t?this.worker.postMessage(e,t):this.worker.postMessage(e),n.promise},t.prototype.terminate=function(){this.worker&&this.worker.terminate(),this._queue.forEach((function(e){e.reject(r.createAbortError("terminated"))})),this._queue.clear()},t.prototype.importScripts=function(e){var t=this;Array.isArray(e)||(e=[e]);var r=e.map((function(e){var r=t._getUrl(e,!0);return t._useProxy&&!n.hasSameOrigin(r,location.href)&&(r=n.getProxyUrl(r).path+"?"+encodeURI(r)),r}));return this.postMessage({action:"import-script",url:r}).then((function(e){e.target=t}))},t.prototype._createWorker=function(e,t){var r=new Worker(e);return r.addEventListener("message",this._acceptMessage,!1),r.addEventListener("error",this._errorMessage,!1),this.worker=r,t&&this.importScripts(t),r},t.prototype._getUrl=function(t,r){void 0===r&&(r=!1),t.match(/\.js$/)||(t+=".js");var a=e.toUrl(t);return r?n.makeAbsolute(a):a},t}()}.apply(null,n))||(e.exports=a)},1333:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1049),r(1077),r(1115),r(6)],void 0===(a=function(e,t,r,n,a,i){function o(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function s(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function u(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function l(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function c(e,t,n,a){void 0===a&&(a=!1);try{var o=e.iterator(n);return i.create((function(e,n){!function e(t,n,a,i,o,s){r.tick(t.next().then((function(r){try{if(null!==r){var u=a.calculateValue(r);return null===u?!1===i&&(n[n.length]=u):n[n.length]=u,e(t,n,a,i,o,s)}o(n)}catch(e){s(e)}}),s))}(o,[],t,a,e,n)}))}catch(e){return i.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,r){switch(void 0===r&&(r=1e3),e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],a={},i=[],o=0;o<e.length;o++){if(void 0!==e[o]&&null!==e[o]){var s=e[o];if(n.isNumber(s)||n.isString(s))void 0===a[s]&&(r.push(s),a[s]=1);else{for(var u=!1,l=0;l<i.length;l++)!0===n.equalityTest(i[l],s)&&(u=!0);!1===u&&(i.push(s),r.push(s))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return o(t);case"min":return Math.min.apply(Math,t);case"sum":return l(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(s(t));case"var":case"variance":return s(t);case"count":return t.length}return 0},t.min=function(e,t,r){return c(e,t,r,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))},t.max=function(e,t,r){return c(e,t,r,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))},t.mean=function(e,t,r){var n="";return!1===a.isSingleField(t)&&(n=a.predictType(t,e.fields,null)),c(e,t,r,!0).then((function(e){if(0===e.length)return null;var t,r=o(e);return null===r?r:"integer"===n?(t=+(t=r),isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t):r}))},t.variance=function(e,t,r){return c(e,t,r,!0).then((function(e){return 0===e.length?null:u(e)}))},t.stdev=function(e,t,r){return c(e,t,r,!0).then((function(e){return 0===e.length?null:Math.sqrt(u(e))}))},t.sum=function(e,t,r){return c(e,t,r,!0).then((function(e){return 0===e.length?null:l(e)}))},t.count=function(e,t){try{return e.iterator(t).count()}catch(e){return i.reject(e)}},t.distinct=function(e,t,r,n){return void 0===r&&(r=1e3),void 0===n&&(n=null),function(e,t,r,n){try{return function e(t,r,n,a,i){return t.next().then((function(o){if(null!==o){var s=a.calculateValue(o);return null!=s&&void 0===r[s]&&(n.push(s),r[s]=1),n.length>=i&&-1!==i?n:e(t,r,n,a,i)}return n}))}(e.iterator(n),{},[],t,r)}catch(e){return i.reject(e)}}(e,t,r,n)}}.apply(null,n))||(e.exports=a)},1334:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(1049),r(1114),r(1107),r(1335),r(6)],void 0===(a=function(e,t,r,n,a,i,o,s){var u=function(e){function t(t){var r=e.call(this,t)||this;return r._orderbyclause=null,r.declaredClass="esri.arcade.featureset.actions.OrderBy",r._maxProcessing=100,r._orderbyclause=t.orderbyclause,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)})).then((function(r){return t._checkCancelled(e),t._wset=r,t._wset})):s.resolve(this._wset)},t.prototype.manualOrderSet=function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then((function(e){r._orderbyclause.order(e);for(var t=new i([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t}))},t.prototype.getIdColumnDictionary=function(e,t,r,a){var i=this;if(r<e._known.length-1){var o=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return n.tick(this._parent._expandPagedSet(e,o,0,0,a)).then((function(){return i.getIdColumnDictionary(e,t,r,a)}));for(var u=r+1,l=[];u<e._known.length&&"GETPAGES"!==e._known[u];)l.push(e._known[u]),u++;return r+=l.length,n.tick(this._parent._getFeatureBatch(l,a)).then((function(n){i._checkCancelled(a);for(var o=0,s=n;o<s.length;o++){var u=s[o];t.push({id:u.attributes[i.objectIdField],feature:u})}return i.getIdColumnDictionary(e,t,r,a)}))}return e._candidates.length>0?n.tick(this._refineSetBlock(e,this._maxProcessingRate(),a)).then((function(){return i._checkCancelled(a),i.getIdColumnDictionary(e,t,r,a)})):s.resolve(t)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},t.prototype._fetchAndRefineFeatures=function(){return s.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,a){var o=this;return this._ensureLoaded().then((function(){return o._parent._getFilteredSet(e,t,r,null===n?o._orderbyclause:n,a)})).then((function(e){var n;o._checkCancelled(a),n=new i(e._candidates.slice(0),e._known.slice(0),e._ordered,o._clonePageDefinition(e.pagesDefinition));var s=!0;return e._candidates.length>0&&(s=!1),!1===n._ordered?o.manualOrderSet(n,a).then((function(e){return!1===s&&(null===t&&null===r||(e=new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,o._clonePageDefinition(e.pagesDefinition)))),e})):n}))},t}(a);return a._featuresetFunctions.orderBy=function(e){return""===e?this:new u({parentfeatureset:this,orderbyclause:new o(e)})},u}.apply(null,n))||(e.exports=a)},1335:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}return function(){function e(e){var t=e.split(",");this._fields=[],this._directions=[];for(var r=0;r<t.length;r++){var n=t[r].match(/\S+/g);this._fields.push(n[0]),2===n.length?"asc"===n[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return e.prototype.constructClause=function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},e.prototype.order=function(e){var t=this;e.sort((function(e,n){for(var a=0;a<t._fields.length;a++){var i,o=t.featureValue(e.feature,t._fields[a],a),s=t.featureValue(n.feature,t._fields[a],a);if(0!==(i=1===t._directions[a]?r(o,s):-1*r(o,s)))return i}return 0}))},e.prototype.scanForField=function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},e.prototype.replaceFields=function(t){for(var r="",n=0;n<this._fields.length;n++){0!==n&&(r+=",");for(var a=this._fields[n],i=0,o=t;i<o.length;i++){var s=o[i];if(a.toLowerCase()===s.field.toLowerCase()){a=s.newfield;break}}r+=a,1===this._directions[n]?r+=" ASC":r+=" DESC"}return new e(r)},e.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null},e}()}.apply(null,n))||(e.exports=a)},1336:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(1114),r(1107),r(1077),r(6)],void 0===(a=function(e,t,r,n,a,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.layers.featureset.sources.Empty",r._maxProcessing=1e3,r._wset=new a([],[],!1,null),r._parent=t.parentfeatureset,r._databaseType=i.FeatureServiceDatabaseType.Standardised,r}return r(t,e),t.prototype._getSet=function(){return o.resolve(this._wset)},t.prototype.optimisePagingFeatureQueries=function(){},t.prototype._isInFeatureSet=function(){return i.IdState.NotInFeatureSet},t.prototype._getFeature=function(){return o.reject(new Error("No Feature Found in EmptySet"))},t.prototype.queryAttachments=function(){return o.resolve([])},t.prototype._getFeatures=function(){return o.resolve("success")},t.prototype._featureFromCache=function(){return null},t.prototype._fetchAndRefineFeatures=function(){return o.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(){return o.resolve(new a([],[],!1,null))},t.prototype._stat=function(e,t,r,n,a,i,o){return this._manualStat(e,t,i,o)},t.prototype._canDoAggregates=function(){return o.resolve(!1)},t}(n)}.apply(null,n))||(e.exports=a)},1337:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(1114),r(1107),r(1077),r(1115),r(6),r(769),r(28)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l){var c=function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.actions.AttributeFilter",r._maxProcessing=1e3,r._parent=t.parentfeatureset,t.whereclause instanceof u.WhereClause?(r._whereclause=t.whereclause,r._whereClauseFunction=null):(r._whereClauseFunction=t.whereclause,r._whereclause=null),r}return r(t,e),t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new l({wkid:4326}),this.geometryType=i.layerGeometryEsriConstants.point)},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)})).then((function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):s.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===i.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?i.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeWhereClause=function(e){return this._whereclause.testFeature(e)},t.prototype.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return s.isPromiseLike(t)?t:s.resolve(t)}catch(e){return s.reject(e)}return s.resolve(this.executeWhereClause(e))},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,o=new a([],e,!1,null),u=Math.min(t,e.length);return this._parent._getFeatures(o,-1,u,r).then((function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var a=0;a<u;a++){var o=n._parent._featureFromCache(e[a]);!0===n.executeWhereClause(o)?n._idstates[e[a]]=i.IdState.InFeatureSet:n._idstates[e[a]]=i.IdState.NotInFeatureSet}return"success"}var l=[];for(a=0;a<u;a++)o=n._parent._featureFromCache(e[a]),l.push(n.executeWhereClauseDeferred(o));return s.all(l).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=i.IdState.InFeatureSet:n._idstates[e[a]]=i.IdState.NotInFeatureSet;return"success"}))}))},t.prototype._getFilteredSet=function(e,t,r,n,i){var s=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=o.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((function(){return s._parent._getFilteredSet(e,t,r,n,i)})).then((function(e){return s._checkCancelled(i),null!==s._whereClauseFunction?new a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)):new a(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition))}))},t.prototype._stat=function(e,t,r,n,a,i,u){var l=this;if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,i,u):s.resolve({calculated:!1});var c=this._whereclause;return null!==a&&null!==this._whereclause&&(c=o.combine(this._whereclause,a)),this._parent._stat(e,t,r,n,c,i,u).then((function(o){return!1===o.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,u):{calculated:!1}:o}))},t.prototype._canDoAggregates=function(e,t,r,n,a){return null!==this._whereClauseFunction?s.resolve(!1):(null!==a?null!==this._whereclause&&(a=o.combine(this._whereclause,a)):a=this._whereclause,null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,u){return null===this._parent?s.reject(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=o.combine(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,u))},t}(n);return n._featuresetFunctions.filter=function(e){if("function"==typeof e)return new c({parentfeatureset:this,whereclause:e});var t=null;return e instanceof u.WhereClause&&(t=e),new c({parentfeatureset:this,whereclause:t})},c}.apply(null,n))||(e.exports=a)},1468:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(8),r(76),r(1469),r(1978),r(1471),r(1980),r(1470),r(1077),r(6),r(904),r(63),r(78),r(1334),r(1472),r(1473),r(1337),r(1981)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h){function y(e,t){if(l.applicationCache){var r=l.applicationCache.getLayerInfo(e);if(r)return r.then((function(r){return p.resolve(new f({url:e,outFields:t,sourceJSON:r}))}));var n=new f({url:e,outFields:t}),a=p.create((function(e,t){n.load().then((function(){e(n.sourceJSON)}),(function(e){t(e)}))}));return l.applicationCache&&(l.applicationCache.setLayerInfo(e,a),a=a.catch((function(t){throw l.applicationCache.clearLayerInfo(e),t}))),a.then((function(){return p.resolve(n)}))}return p.resolve(new f({url:e,outFields:t}))}function v(e,t,r,n,a){return y(e,["*"]).then((function(e){return p.resolve(g(e,t,r,n,a))}))}function g(e,t,r,n,a){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===a&&(a=null),!0===e._hasMemorySource()?new s({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new o({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function m(e){if(null!==l.applicationCache){var t=l.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=a(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),p.resolve(t)}return p.resolve({layers:[],tables:[]})}));return null!==l.applicationCache&&(l.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw l.applicationCache.clearLayerInfo(e),t}))),r}Object.defineProperty(t,"__esModule",{value:!0}),t.initialiseMetaDataCache=function(){null===l.applicationCache&&(l.applicationCache=new l)},t.constructFeatureSetFromUrl=v,t.constructFeatureSet=g,t.constructAssociationMetaDataFeatureSetFromUrl=function(e,t){var r={metadata:null,networkId:-1,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return m(e).then((function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(var i=0,o=n.layers;i<o.length;i++){var s=o[i];r.layerNameLkp[s.id]=s.name}if(n.tables)for(var u=0,c=n.tables;u<c.length;u++)s=c[u],r.layerNameLkp[s.id]=s.name;var f=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=f,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==l.applicationCache){var n=l.applicationCache.getLayerInfo(r);if(null!==n)return n}var i=a(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==l.applicationCache&&(l.applicationCache.setLayerInfo(r,i),i=i.catch((function(e){throw l.applicationCache.clearLayerInfo(r),e}))),i}(e,f).then((function(n){if(n){r.queryelem=n,r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(var i=0,o=r.queryelem.dataElement.domainNetworks;i<o.length;i++){for(var s=o[i],u=0,c=s.edgeSources?s.edgeSources:[];u<c.length;u++)(g={layerId:(y=c[u]).layerId,sourceId:y.sourceId,className:r.layerNameLkp[y.layerId]?r.layerNameLkp[y.layerId]:null}).className&&(r.lkp[g.className]=g);for(var d=0,h=s.junctionSources?s.junctionSources:[];d<h.length;d++){var y,g;(g={layerId:(y=h[d]).layerId,sourceId:y.sourceId,className:r.layerNameLkp[y.layerId]?r.layerNameLkp[y.layerId]:null}).className&&(r.lkp[g.className]=g)}}if(r.queryelem.dataElement.terminalConfigurations)for(var m=0,_=r.queryelem.dataElement.terminalConfigurations;m<_.length;m++)for(var S=0,b=_[m].terminals;S<b.length;S++){var w=b[S];r.terminals.push({terminalId:w.terminalId,terminalName:w.terminalName})}return function(e){if(null!==l.applicationCache){var t=l.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=a(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return p.resolve(t)}return p.resolve(null)}));return null!==l.applicationCache&&(l.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw l.applicationCache.clearLayerInfo(e),t}))),r}(e+"/"+f).then((function(n){return n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId?v(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"],!1,null).then((function(e){return e.load()})).then((function(e){return{lkp:r.lkp,associations:e,terminals:r.terminals}})):{associations:null,lkp:null,terminals:[]}}))}return{associations:null,lkp:null,terminals:[]}}))}return{associations:null,lkp:null,terminals:[]}}))},t.constructFeatureSetFromRelationship=function(e,t,r,n,a,i,o){void 0===n&&(n=null),void 0===a&&(a=null),void 0===i&&(i=!0),void 0===o&&(o=null);var s=e.serviceUrl();return s?v(s="/"===s.charAt(s.length-1)?s+t.relatedTableId.toString():s+"/"+t.relatedTableId.toString(),n,a,i,o).then((function(s){return new u({layer:e,relatedLayer:s,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:i,lrucache:o})})):null};var _=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._map=t,a._overridespref=r,a.lrucache=n,a._instantLayers=[],a}return r(t,e),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=g(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype.featureSetByName=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=null),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return a.featureSetByName(e,t,r)}catch(e){return p.reject(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var s=this._instantLayers[o];if(s.opitem.title===e&&s.includeGeometry===t&&s.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find((function(t){return t instanceof f&&t.title===e}));if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var l=this._map.tables.find((function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)}));if(l){if(l._materializedTable);else{var c=l.outFields?l:n({},l,{outFields:["*"]});l._materializedTable=new f(c)}return l._materializedTable.load().then((function(){return a.resolvePromise(a.makeAndAddFeatureSet(l._materializedTable,t,r))}))}}return this.resolvePromise(null)},t.prototype.featureSetById=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return a.featureSetById(e,t,r)}catch(e){return p.reject(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var s=this._instantLayers[o];if(s.opitem.id===e&&s.includeGeometry===t&&s.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find((function(t){return t instanceof f&&t.id===e}));if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var l=this._map.tables.find((function(t){return t.id===e}));if(l){if(l._materializedTable);else{var c=n({},l,{outFields:["*"]});l._materializedTable=new f(c)}return l._materializedTable.load().then((function(){return a.resolvePromise(a.makeAndAddFeatureSet(l._materializedTable,t,r))}))}}return this.resolvePromise(null)},t}(i),S=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._url=t,a._overridespref=r,a.lrucache=n,a.metadata=null,a._instantLayers=[],a}return r(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=g(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype._loadMetaData=function(){var e=this;return m(this._url).then((function(t){return e.metadata=t,t}))},t.prototype.load=function(){return this._loadMetaData()},t.prototype.clone=function(){return new t(this._url,this._overridespref,this.lrucache)},t.prototype.featureSetByName=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=null),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var o=this._instantLayers[i];if(o.opitem.title===e&&o.includeGeometry===t&&o.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){for(var i=null,o=0,s=a.layers?a.layers:[];o<s.length;o++)(c=s[o]).name===e&&(i=c);if(!i)for(var u=0,l=a.tables?a.tables:[];u<l.length;u++){var c;(c=l[u]).name===e&&(i=c)}return i?y(n._url+"/"+i.id,["*"]).then((function(e){return n.makeAndAddFeatureSet(e,t,r)})):n.resolvePromise(null)}))},t.prototype.featureSetById=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=["*"]),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();var a=JSON.stringify(r);e=null!=e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var o=this._instantLayers[i];if(o.opitem.id===e&&o.includeGeometry===t&&o.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){for(var i=null,o=0,s=a.layers?a.layers:[];o<s.length;o++)null!==(c=s[o]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c);if(!i)for(var u=0,l=a.tables?a.tables:[];u<l.length;u++){var c;null!==(c=l[u]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c)}return i?y(n._url+"/"+i.id,["*"]).then((function(e){return n.makeAndAddFeatureSet(e,t,r)})):n.resolvePromise(null)}))},t}(i);t.createFeatureSetCollectionFromMap=function(e,t,r){return void 0===r&&(r=null),new _(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r){return void 0===r&&(r=null),new S(e,t,r)},t.getPortal=function(e,t){return null===e?t:new d({url:e.field("url")})},t.constructFeatureSetFromPortalItem=function(e,t,r,n,a,i,o){if(l.applicationCache){var s=l.applicationCache.getLayerInfo(e+":"+i.url);if(s)return s.then((function(e){try{var i=new f({url:c.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});return p.resolve(g(i,r,n,a,o))}catch(e){return p.reject(e)}}),(function(e){return p.reject(e)}))}return p.create((function(s,u){var p=new h({id:e,portal:i}).load();l.applicationCache&&l.applicationCache.setLayerInfo(e+":"+i.url,p),p.then((function(e){try{var i=new f({url:c.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});s(g(i,r,n,a,o))}catch(e){u(e)}}),(function(t){l.applicationCache&&l.applicationCache.clearLayerInfo(e+":"+i.url),u(t)}))}))}}.apply(null,n))||(e.exports=a)},1469:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(6)],void 0===(a=function(e,t,r){return function(){function e(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return e.prototype.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},e.prototype.featureSetByName=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},e.prototype.featureSetById=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},e.prototype.castToText=function(){return"object, FeatureSetCollection"},e.prototype.resolvePromise=function(e){return r.resolve(e)},e}()}.apply(null,n))||(e.exports=a)},1470:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(){function e(){this._databaseTypeMetaData={},this._layerInfo={}}return e.prototype.clearDatabaseType=function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]},e.prototype.getDatabaseType=function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]},e.prototype.setDatabaseType=function(e,t){this._databaseTypeMetaData[e]=t},e.prototype.getLayerInfo=function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]},e.prototype.setLayerInfo=function(e,t){this._layerInfo[e]=t},e.prototype.clearLayerInfo=function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]},e.applicationCache=null,e}()}.apply(null,n))||(e.exports=a)},1471:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(240),r(1114),r(1107),r(1077),r(1115),r(6),r(44),r(904),r(851),r(891)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",r._removeGeometry=!1,r._overrideFields=null,r._forceIsTable=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,!0===t.isTable&&(r._forceIsTable=!0),void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=u.create((function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}}),r),e._layer.load()}))),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++)if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,a=this._layer.outFields;n<a.length;n++)if(a[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,u=this.fields;s<u.length;s++){var l;if("oid"===(l=u[s]).type)e.push(l),i.push(l.name);else for(var c=0,p=this._overrideFields;c<p.length;c++)if(p[c].toLowerCase()===l.name.toLowerCase()){e.push(l),i.push(l.name);break}}this.fields=e,this._overrideFields=i}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=o.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype.isTable=function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType},t.prototype._isInFeatureSet=function(){return o.IdState.InFeatureSet},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):u.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,a=this.fields;r<a.length;r++){var i=a[r];t[i.name]=e.attributes[i.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,a){var l=this,c="",p=!1;if(null!==n&&(c=n.constructClause(),p=!0),this.isTable()&&t&&null!==e&&""!==e){var d=new i([],[],!0,null);return u.resolve(d)}var h=new f;return h.where=null===r?null===t?"1=1":"":s.toWhereClause(r,o.FeatureServiceDatabaseType.Standardised),h.spatialRelationship=this._makeRelationshipEnum(e),h.outSpatialReference=this.spatialReference,h.orderByFields=""!==c?c.split(","):null,h.geometry=null===t?null:t,h.returnGeometry=!0,h.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(h).then((function(e){if(null===e)return new i([],[],p,null);l._checkCancelled(a);var t=[];return e.features.forEach((function(e){var r=e.attributes[l._layer.objectIdField];t.push(r),l._featureCache[r]=l._changeFeature(e)})),new i([],t,p,null)}))},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._queryAllFeatures=function(){var e=this;if(this._wset)return u.resolve(this._wset);var t=new f;return t.where="1=1",this._ensureLoaded().then((function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new i([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then((function(t){var r=[];return t.features.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new i([],r,!1,null),e._wset}))}))},t.prototype._getFeatures=function(e,t,r){var n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(var a=e._lastFetchedIndex;a<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[a]]&&(e._known[a]!==t&&n.push(e._known[a]),n.length>r)));a++);return 0===n.length?u.resolve("success"):u.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e){return u.resolve(e)},t.prototype._stat=function(){return u.resolve({calculated:!1})},t.prototype._canDoAggregates=function(){return u.resolve(!1)},t.prototype.relationshipMetaData=function(){return[]},t._cloneAttr=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.prototype.nativeCapabilities=function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}},t.create=function(e,r){var n=e.layerDefinition.objectIdField,a=e.layerDefinition.geometryType;void 0===a&&(a=e.featureSet.geometryType||"");var i=e.featureSet.features,o=r.toJSON();if(""===n||void 0===n){for(var s=!1,u=0,f=e.layerDefinition.fields;u<f.length;u++)if("oid"===(R=f[u]).type||"esriFieldTypeOID"===R.type){n=R.name,s=!0;break}if(!1===s){for(var d="FID",h=!0,y=0;h;){for(var v=!0,g=0,m=e.layerDefinition.fields;g<m.length;g++)if((R=m[g]).name===d){v=!1;break}!0===v?h=!1:d="FID"+(++y).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:d,alias:d});for(var _=[],S=0;S<i.length;S++)_.push({geometry:e.featureSet.features[S].geometry,attributes:e.featureSet.features[S].attributes?this._cloneAttr(e.featureSet.features[S].attributes):{}}),_[S].attributes[d]=S;i=_,n=d}}for(var b=[],w=0,F=e.layerDefinition.fields;w<F.length;w++)(R=F[w])instanceof p?b.push(R):b.push(p.fromJSON(R));var x=a;switch(x){case"esriGeometryPoint":x="point";break;case"esriGeometryPolyline":x="polyline";break;case"esriGeometryPolygon":x="polygon";break;case"esriGeometryExtent":x="extent";break;case"esriGeometryMultipoint":x="multipoint"}for(var I=0,T=i;I<T.length;I++){var R;(R=T[I]).geometry&&R.geometry instanceof l==0&&(R.geometry.type=x,void 0===R.geometry.spatialReference&&(R.geometry.spatialReference=o))}var C={outFields:["*"],source:i,fields:b,objectIdField:n,spatialReference:r};return C.geometryType=x||"point",new t({layer:new c(C),spatialReference:r,isTable:null===x||""===x})},t.prototype.queryAttachments=function(){return u.resolve([])},t.prototype.getFeatureByObjectId=function(e){var t=new f;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((function(e){return 1===e.features.length?e.features[0]:null}))},t}(a)}.apply(null,n))||(e.exports=a)},1472:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(1114),r(1107),r(1077),r(6)],void 0===(a=function(e,t,r,n,a,i,o){var s=function(e){function t(t){var r=e.call(this,t)||this;return r._topnum=0,r.declaredClass="esri.arcade.featureset.actions.Top",r._countedin=0,r._maxProcessing=100,r._topnum=t.topnum,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getSet(e)})).then((function(e){return t._wset=new a(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset})):o.resolve(this._wset)},t.prototype._setKnownLength=function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);if(t===i.IdState.NotInFeatureSet)return t;var r=this._idstates[e];return r===i.IdState.InFeatureSet||r===i.IdState.NotInFeatureSet?r:t===i.IdState.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=i.IdState.InFeatureSet,this._countedin++,i.IdState.InFeatureSet):(this._idstates[e]=i.IdState.NotInFeatureSet,i.IdState.NotInFeatureSet):i.IdState.Unknown},t.prototype._expandPagedSet=function(e,t,r,n,a){var i=this;if(null===this._parent)return o.reject(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var s=e._known.length;return s>0&&"GETPAGES"===e._known[s-1]&&(e._known.length=s-1),(s=e._candidates.length)>0&&"GETPAGES"===e._candidates[s-1]&&(e._candidates.length=s-1),o.resolve("success")}return this._parent._expandPagedSet(e,t,r,n,a).then((function(t){return i._setKnownLength(e)>i._topnum&&(e._known.length=i._topnum),i._setKnownLength(e)>=i._topnum&&(e._candidates.length=0),t}))},t.prototype._getFeatures=function(e,t,r,n){var i=this,s=[],u=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,u))return this._expandPagedSet(e,u,0,0,n).then((function(){return i._getFeatures(e,t,r,n)}));-1!==t&&void 0===this._featureCache[t]&&s.push(t);for(var l=0,c=e._lastFetchedIndex;c<e._known.length&&(++l<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[c]]&&(e._known[c]!==t&&s.push(e._known[c]),s.length>u-1)));c++);if(0===s.length)return o.resolve("success");var p=new a([],s,!1,null),f=Math.min(s.length,r);return this._parent._getFeatures(p,-1,f,n).then((function(){for(var e=0;e<f;e++){var t=i._parent._featureFromCache(s[e]);void 0!==t&&(i._featureCache[s[e]]=t)}return"success"}))},t.prototype._getFilteredSet=function(e,t,r,n,i){var o=this;return this._ensureLoaded().then((function(){return o._getSet(i)})).then((function(e){return new a(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,o._clonePageDefinition(e.pagesDefinition))}))},t.prototype._refineKnowns=function(e,t){for(var r=0,n=null,a=[],o=0;o<e._candidates.length;o++){var s=this._isInFeatureSet(e._candidates[o]);if(s===i.IdState.InFeatureSet){if(e._known.push(e._candidates[o]),r+=1,null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(a.push(n),n={start:o,end:o}),e._known.length>=this._topnum)break}else if(s===i.IdState.NotInFeatureSet)null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(a.push(n),n={start:o,end:o}),r+=1;else if(s===i.IdState.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var u=a.length-1;u>=0;u--)e._candidates.splice(a[u].start,a[u].end-a[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},t.prototype._stat=function(){return o.resolve({calculated:!1})},t.prototype._canDoAggregates=function(){return o.resolve(!1)},t}(n);return n._featuresetFunctions.top=function(e){return new s({parentfeatureset:this,topnum:e})},s}.apply(null,n))||(e.exports=a)},1473:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(1336),r(1114),r(1107),r(1077),r(6),r(1207)],void 0===(a=function(e,t,r,n,a,i,o,s,u){var l=function(e){function t(t){var r=e.call(this,t)||this;return r._relation="",r._relationGeom=null,r._relationString="",r.declaredClass="esri.arcade.featureset.actions.SpatialFilter",r._relationString=t.relationString,r._parent=t.parentfeatureset,r._maxProcessing=40,r._relation=t.relation,r._relationGeom=t.relationGeom,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(r){return t._checkCancelled(e),t._wset=new i(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):s.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===o.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?o.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeSpatialRelationTest=function(e){if(null===e.geometry)return s.resolve(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=o.shapeExtent(this._relationGeom),r=o.shapeExtent(e.geometry);return u.intersects(t,r);case"esriSpatialRelIntersects":return u.intersects(this._relationGeom,e.geometry);case"esriSpatialRelContains":return u.contains(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return u.overlaps(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return u.within(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return u.touches(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return u.crosses(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return u.relate(this._relationGeom,e.geometry,this._relationString)}},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,a=new i([],e,!1,null),u=Math.min(t,e.length);return this._parent._getFeatures(a,-1,u,r).then((function(){n._checkCancelled(r);for(var t=[],a=0;a<u;a++){var i=n._parent._featureFromCache(e[a]);t.push(n.executeSpatialRelationTest(i))}return s.all(t)})).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=o.IdState.InFeatureSet:n._idstates[e[a]]=o.IdState.NotInFeatureSet;return"success"}))},t.prototype._getFilteredSet=function(e,t,r,n,a){var o=this;return this._ensureLoaded().then((function(){return o._parent._getFilteredSet("esriSpatialRelRelation"!==o._relation?o._relation:o._relation+":"+o._relationString,o._relationGeom,r,n,a)})).then((function(e){return o._checkCancelled(a),null!==t?new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,o._clonePageDefinition(e.pagesDefinition)):new i(e._candidates.slice(0),e._known.slice(0),e._ordered,o._clonePageDefinition(e.pagesDefinition))}))},t.prototype._stat=function(e,t,r,n,a,i,o){var u=this;return""!==r?s.resolve({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,o).then((function(s){return!1===s.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,o):{calculated:!1}:s}))},t.prototype._canDoAggregates=function(e,t,r,n,a){return""!==r||null!==n||null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,o){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,o)},t}(a);return a._featuresetFunctions.intersects=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},a._featuresetFunctions.contains=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},a._featuresetFunctions.overlaps=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},a._featuresetFunctions.within=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},a._featuresetFunctions.touches=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},a._featuresetFunctions.crosses=function(e){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},a._featuresetFunctions.relate=function(e,t){return null==e?new n({parentfeatureset:this}):new l({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})},l}.apply(null,n))||(e.exports=a)},1474:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(240),r(1227),r(1114),r(1107),r(1077),r(1115),r(6),r(769),r(28)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(){this.sqlRewritable=!1}return e.prototype.postInitialization=function(e,t){},e}();t.AdaptedField=f;var d=function(e){function t(t){var r=e.call(this)||this;return r.field=t,r.sqlRewritable=!0,r}return r(t,e),t.prototype.extractValue=function(e){return e.attributes[this.field.name]},t.prototype.rewriteSql=function(e){return{rewritten:this.sqlRewritable,where:e}},t}(f);t.OriginalField=d;var h=function(e){function t(t,r,n){var a=e.call(this)||this;return a.originalField=t,a.sqlRewritable=!0,a.field=s.cloneField(t),a.field.name=r,a.field.alias=n,a}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:u.reformulateWithoutField(e,this.field.name,this.originalField.name,t.getFieldsIndex())}},t.prototype.extractValue=function(e){return e.attributes[this.originalField.name]},t}(f);t.FieldRename=h;var y=function(e){function t(t,r,n){var a=e.call(this)||this;for(var i in a.field=t,a.codefield=r,a.lkp=n,a.reverseLkp={},n)a.reverseLkp[n[i]]=i;return a.sqlRewritable=!0,a}return r(t,e),t.prototype.rewriteSql=function(e,r){var n=this.evaluateNodeToWhereClause(e.parseTree,s.FeatureServiceDatabaseType.Standardised,this.field.name,this.codefield instanceof c.WhereClause?u.toWhereClause(this.codefield,s.FeatureServiceDatabaseType.Standardised):this.codefield,e.parameters);return n.indexOf(t.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:c.WhereClause.create(n,r._parent.getFieldsIndex())}},t.prototype.evaluateNodeToWhereClause=function(e,r,n,a,i){var o,s,l,c;switch(void 0===n&&(n=null),void 0===a&&(a=null),e.type){case"interval":return u.convertIntervalToSql(this.evaluateNodeToWhereClause(e.value,r,n,a,i),e.qualifier,e.op);case"case_expression":var p=" CASE ";"simple"===e.format&&(p+=this.evaluateNodeToWhereClause(e.operand,r,n,t.BADNESS,i));for(var f=0;f<e.clauses.length;f++)p+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[f].operand,r,n,t.BADNESS,i)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[f].value,r,n,t.BADNESS,i);return null!==e.else&&(p+=" ELSE "+this.evaluateNodeToWhereClause(e.else,r,n,t.BADNESS,i)),p+" END ";case"param":var d=i[e.value.toLowerCase()];if("string"==typeof d)return"'"+i[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(d instanceof Date)return u.makeDateString(d,r);if(d instanceof Array){var h=[];for(f=0;f<d.length;f++)"string"==typeof d[f]?h.push("'"+d[f].toString().replace(/'/g,"''")+"'"):d[f]instanceof Date?h.push(u.makeDateString(d[f],r)):h.push(d[f].toString());return h}return d.toString();case"expr_list":s=[];for(var y=0,v=e.value;y<v.length;y++){var g=v[y];s.push(this.evaluateNodeToWhereClause(g,r,n,a,i))}return s;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,r,n,t.BADNESS,i)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" AND "+this.evaluateNodeToWhereClause(e.right,r,n,a,i)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" OR "+this.evaluateNodeToWhereClause(e.right,r,n,a,i)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IS NOT NULL )";case"IN":if(o=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){for(var m=[],_=!0,S=0,b=e.right.value;S<b.length;S++){if("string"!==(x=b[S]).type){_=!1;break}if(void 0===this.lkp[x.value]){_=!1;break}m.push(this.lkp[x.value].toString())}if(_)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+m.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,r,n,a,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+o.join(",")+")) "}return(c=this.evaluateNodeToWhereClause(e.right,r,n,a,i))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+c+")) ";case"NOT IN":if(o=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){m=[],_=!0;for(var w=0,F=e.right.value;w<F.length;w++){var x;if("string"!==(x=F[w]).type){_=!1;break}if(void 0===this.lkp[x.value]){_=!1;break}m.push(this.lkp[x.value].toString())}if(_)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+m.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,r,n,a,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+o.join(",")+")) "}return(c=this.evaluateNodeToWhereClause(e.right,r,n,a,i))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+c+")) ";case"BETWEEN":return l=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"NOTBETWEEN":return l=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+a+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+a+") ";return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return u.makeDateString(e.value,r);case"number":return e.value.toString();case"current_time":return u.makeToday("date"===e.mode,r);case"column_ref":return n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":var I=this.evaluateNodeToWhereClause(e.args,r,n,t.BADNESS,i);return u.translateFunctionToDatabaseSpecific(e.name,I,r)}throw new Error("Unsupported sql syntax "+e.type)},t.prototype.extractValue=function(e){return this.codefield instanceof c.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]},t.BADNESS="_!!!_BAD_LKP_!!!!",t}(f);t.StringToCodeAdapted=y;var v=function(e){function t(t,r){var n=e.call(this)||this;return n.field=t,n.sql=r,n}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:!0,where:u.reformulateWithoutField(e,this.field.name,u.toWhereClause(this.sql,s.FeatureServiceDatabaseType.Standardised),t.getFieldsIndex())}},t.prototype.extractValue=function(e){return this.sql.calculateValueCompiled(e)},t}(f);t.SqlExpressionAdapted=v;var g=function(e){function t(t){var r=e.call(this,t)||this;return r._calcFunc=null,r.declaredClass="esri.arcade.featureset.actions.Adapted",r.adaptedFields=null,r._extraFilter=null,r._extraFilter=t.extraFilter,r._parent=t.parentfeatureset,r._maxProcessing=30,r.adaptedFields=t.adaptedFields,r}return r(t,e),t.findField=function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(a.name.toLowerCase()===t.toString().toLowerCase())return a}return null},t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new p({wkid:4326}),this.objectIdField="",this.geometryType=s.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null),this.fields=[];for(var e=0,t=this.adaptedFields;e<t.length;e++){var r=t[e];r.postInitialization(this,this._parent),this.fields.push(r.field)}},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)})).then((function(r){return t._checkCancelled(e),t._wset=new o(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):l.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,i){var s=this,u=[];-1!==t&&void 0===this._featureCache[t]&&u.push(t);var c=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,c))return this._expandPagedSet(e,c,0,0,i).then((function(){return s._getFeatures(e,t,r,i)}));for(var p=0,f=e._lastFetchedIndex;f<e._known.length&&(++p<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[f]]&&(e._known[f]!==t&&u.push(e._known[f]),u.length>=c-1)));f++);if(0===u.length)return l.resolve("success");e=new o([],u,e._ordered,null);var d=Math.min(u.length,r);return this._parent._getFeatures(e,-1,d,i).then((function(){s._checkCancelled(i);for(var e=[],t=0;t<d;t++){var r=s._parent._featureFromCache(u[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:u[t]})}for(var o=0,l=e;o<l.length;o++){for(var c=l[o],p=[],f=0,h=s.adaptedFields;f<h.length;f++){var y=h[f];p[y.field.name]=y.extractValue(c)}s._featureCache[c.id]=new n({attributes:p,geometry:a.cloneGeometry(c.geometry)})}return"success"}))},t.prototype._fetchAndRefineFeatures=function(){return l.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,a){var i,s=this,l=this.reformulateWithoutAdaptions(r);i=l.cannot,r=l.where;var c=!1;if(null!==n){c=!0;for(var p=[],f=0,y=this.adaptedFields;f<y.length;f++){var v=y[f];if(!(v instanceof d)&&!0===n.scanForField(v.field.name)){if(!(v instanceof h)){n=null,c=!1;break}p.push({field:v.field.name,newfield:v.originalField.name})}}n&&p.length>0&&(n=n.replaceFields(p))}return null!==r?null!==this._extraFilter&&(r=u.combine(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((function(){return s._parent._getFilteredSet(e,t,r,n,a)})).then((function(e){return s._checkCancelled(a),!0===i?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===c&&e._ordered,s._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),!0===c&&e._ordered,s._clonePageDefinition(e.pagesDefinition))}))},t.prototype.reformulateWithoutAdaptions=function(e){var t={cannot:!1,where:e};if(null!==e)for(var r=0,n=this.adaptedFields;r<n.length;r++){var a=n[r];if(!0===u.scanForField(e,a.field.name)){var i=a.rewriteSql(e,this);if(!0!==i.rewritten){t.cannot=!0,t.where=null;break}t.where=i.where}}return t},t.prototype._stat=function(e,t,r,n,a,i,o){var s=this,c=!1,p=this.reformulateWithoutAdaptions(t);return c=p.cannot,t=p.where,p=this.reformulateWithoutAdaptions(a),c=c||p.cannot,null!==(a=p.where)?null!==this._extraFilter&&(a=u.combine(this._extraFilter,a)):a=this._extraFilter,!0===c?null===a&&""===r&&null===n?this._manualStat(e,t,i,o):l.resolve({calculated:!1}):this._parent._stat(e,t,r,n,a,i,o).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?s._manualStat(e,t,i,o):{calculated:!1}:u}))},t.prototype._canDoAggregates=function(e,t,r,n,a){if(null===this._parent)return l.resolve(!1);for(var i=0;i<e.length;i++)for(var o=0,s=this.adaptedFields;o<s.length;o++){var c=s[o];if(e[i].toLowerCase()===c.field.name.toLowerCase()&&!(c instanceof d))return l.resolve(!1)}var p=[];for(i=0;i<t.length;i++){var f=t[i];if(null!==f.workingexpr){var h=this.reformulateWithoutAdaptions(f.workingexpr);if(h.cannot)return l.resolve(!1);var y=f.clone();y.workingexpr=h.where,p.push(y)}else p.push(f)}var v=this.reformulateWithoutAdaptions(a);return v.cannot?l.resolve(!1):(null!==(a=v.where)?null!==this._extraFilter&&(a=u.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._canDoAggregates(e,p,r,n,a))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,o){if(null===this._parent)return l.reject(new Error("Should never be called"));for(var s=[],c=0;c<t.length;c++){var p=t[c];if(null!==p.workingexpr){var f=this.reformulateWithoutAdaptions(p.workingexpr);if(f.cannot)return l.reject(new Error("Should never be called"));var d=p.clone();d.workingexpr=f.where,s.push(d)}else s.push(p)}var h=this.reformulateWithoutAdaptions(a);return h.cannot?l.reject(new Error("Should never be called")):(null!==(a=h.where)?null!==this._extraFilter&&(a=u.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,s,r,n,a,i,o))},t}(i);t.AdaptedFeatureSet=g}.apply(null,n))||(e.exports=a)},1978:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(240),r(76),r(1226),r(1114),r(1107),r(1077),r(1115),r(1115),r(1333),r(1173),r(6),r(35),r(904),r(242),r(1124),r(1070),r(907),r(891),r(896)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y,v,g,m,_,S,b){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",r._removeGeometry=!1,r._overrideFields=null,r.formulaCredential=null,r._pageJustIds=!1,r._requestStandardised=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return u.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},t.prototype.convertQueryToLruCacheKey=function(e){var t=u.stableStringify(e.toJSON());return f.createMD5Hash(t,f.outputTypes.String)},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=d.create((function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}}),r),e._layer.load()}catch(e){r(e)}}))),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++)if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,a=this._layer.outFields;n<a.length;n++)if(a[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],o=0,s=this.fields;o<s.length;o++){var l;if("oid"===(l=s[o]).type)e.push(l),i.push(l.name);else for(var c=0,p=this._overrideFields;c<p.length;c++)if(p[c].toLowerCase()===l.name.toLowerCase()){e.push(l),i.push(l.name);break}}this.fields=e,this._overrideFields=i}if(this._layer.source&&this._layer.source.sourceJSON){var f=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,null!=f&&f>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised)):null!=f&&(f>=10.5&&(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,this._requestStandardised=!0),f>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised))}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype._isInFeatureSet=function(){return u.IdState.InFeatureSet},t.prototype._refineSetBlock=function(e){return d.resolve(e)},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):d.resolve(this._wset)},t.prototype._runDatabaseProbe=function(e){var t=this;return d.create((function(r,n){try{t._ensureLoaded().then((function(){try{var a=new S;a.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(a).then((function(){r(!0)}),(function(){try{r(!1)}catch(e){n(e)}}))}catch(e){n(e)}}))}catch(e){n(e)}}))},t.prototype._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},t.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url},t.prototype.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode},t.prototype.queryPBF=function(e){return e.quantizationParameters={mode:"edit"},m.executeQueryPBF(this._layer.parsedUrl,e,{type:"optimized"}).then((function(e){return _.fromJSON(v.convertToFeatureSet(e.data)).unquantize()}))},t.prototype.nativeCapabilities=function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}},t.prototype.executeQuery=function(e,t){var r=this,n=new g({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var o=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(o))&&(i=!0!==a?n[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(o,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(o),e})))}return null===i&&(i=!0!==a?n[t](e):this.queryPBF(e)),i},t.prototype._getFilteredSet=function(e,t,r,n,a){var i=this;return this.databaseType().then((function(o){if(i.isTable()&&t&&null!==e&&""!==e)return new s([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,a);var u="",c=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),c=!0);var p=new S;return p.where=null===r?null===t?"1=1":"":l.toWhereClause(r,o),i._requestStandardised&&(p.sqlFormat="standard"),p.spatialRelationship=i._makeRelationshipEnum(e),p.outSpatialReference=i.spatialReference,p.orderByFields=""!==u?u.split(","):null,p.geometry=null===t?null:t,p.relationParameter=i._makeRelationshipParam(e),i.executeQuery(p,"executeForIds").then((function(e){return null===e&&(e=[]),i._checkCancelled(a),new s([],e,c,null)}))}))},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,a){var i=this;try{var o="",u=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=n.constructClause(),u=!0),this.databaseType().then((function(n){var c=null===r?null===t?"1=1":"":l.toWhereClause(r,n);i._layer.definitionExpression&&(c=""!==c?"(("+i._layer.definitionExpression+") AND ("+c+"))":i._layer.definitionExpression);var p=i._maxQueryRate(),f=i._layer.capabilities.query.maxRecordCount;void 0!==f&&f<p&&(p=f);var d=null;if(!0===i._pageJustIds)d=new s([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:p,resultOffset:0,geometry:null===t?null:t,where:c,orderByFields:o,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var h=!0;!0===i._removeGeometry&&(h=!1);var y=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._layer.outFields?i._layer.outFields:["*"]);d=new s([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:y.join(","),resultRecordCount:p,resultOffset:0,geometry:null===t?null:t,where:c,orderByFields:o,returnGeometry:h,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}return i._expandPagedSet(d,p,0,1,a).then((function(){return d}))}))}catch(e){return d.reject(e)}},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,o=new S;return this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=e.pagesDefinition.spatialRel,o.relationParameter=e.pagesDefinition.relationParam,o.outFields=e.pagesDefinition.outFields.split(","),o.num=e.pagesDefinition.resultRecordCount,o.start=e.pagesDefinition.internal.lastRetrieved,o.geometry=e.pagesDefinition.geometry,o.where=e.pagesDefinition.where,o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=e.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference,this.executeQuery(o,"execute").then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==a)return"done";for(var o=0;o<t.features.length;o++)e.pagesDefinition.internal.set[i+o]=t.features[o].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(o=0;o<t.features.length;o++)n._featureCache[t.features[o].attributes[n._layer.objectIdField]]=t.features[o];return t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return d.reject(e)}},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFeatures=function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var o=0,s=e._lastFetchedIndex;s<e._known.length;s++){if(e._lastFetchedIndex+=1,o++,void 0===this._featureCache[e._known[s]]){var u=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var l=this._layer._mode;if(void 0!==l._featureMap[e._known[s]]){var c=l._featureMap[e._known[s]];null!==c&&(u=!0,this._featureCache[e._known[s]]=c)}}if(!1===u&&(e._known[s]!==t&&i.push(e._known[s]),i.length>=this._maxProcessingRate()-1))break}if(o>=r&&0===i.length)break}if(0===i.length)return d.resolve("success");try{var p=new S;return this._requestStandardised&&(p.sqlFormat="standard"),p.objectIds=i,p.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),p.returnGeometry=!0,!0===this._removeGeometry&&(p.returnGeometry=!1),p.outSpatialReference=this.spatialReference,this.executeQuery(p,"execute").then((function(e){if(a._checkCancelled(n),void 0!==e.error)return d.reject(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return d.reject(e)}}catch(e){return d.reject(e)}},t.prototype._getDistinctPages=function(e,t,r,n,a,i,o,s,u){var c=this;return this._ensureLoaded().then((function(){return c.databaseType()})).then((function(p){for(var f=r.parseTree.column,h=0;h<c._layer.fields.length;h++)if(c._layer.fields[h].name.toLowerCase()===f.toLowerCase()){f=c._layer.fields[h].name;break}var y=new S;c._requestStandardised&&(y.sqlFormat="standard");var v=null===i?null===a?"1=1":"":l.toWhereClause(i,p);return c._layer.definitionExpression&&(v=""!==v?"(("+c._layer.definitionExpression+") AND ("+v+"))":c._layer.definitionExpression),y.where=v,y.spatialRelationship=c._makeRelationshipEnum(n),y.relationParameter=c._makeRelationshipParam(n),y.geometry=null===a?null:a,y.returnDistinctValues=!0,y.returnGeometry=!1,y.outFields=[f],c.executeQuery(y,"execute").then((function(l){if(c._checkCancelled(u),!l.hasOwnProperty("features"))return d.reject(new Error("Unnexected Result querying statistics from layer"));for(var p=!1,h=0;h<c._layer.fields.length;h++)if(c._layer.fields[h].name===f){"date"===c._layer.fields[h].type&&(p=!0);break}for(h=0;h<l.features.length;h++){if(p){var y=l.features[h].attributes[f];null!==y?s.push(new Date(y)):s.push(y)}else s.push(l.features[h].attributes[f]);if(s.length>=o)break}return 0===l.features.length?s:l.features.length===c._layer.capabilities.query.maxRecordCount&&s.length<o?c._getDistinctPages(e+l.features.length,t,r,n,a,i,o,s,u).then((function(e){return{calculated:!0,result:e}})):s}))}))},t.prototype._distinctStat=function(e,t,r,n,a,i,o){return this._getDistinctPages(0,e,t,r,n,a,i,[],o).then((function(e){return{calculated:!0,result:e}}))},t.prototype.isTable=function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},t.prototype._countstat=function(e,t,r,n){var a=this;return this.databaseType().then((function(e){var i=new S;if(a._requestStandardised&&(i.sqlFormat="standard"),a.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var o=null===n?null===r?"1=1":"":l.toWhereClause(n,e);return a._layer.definitionExpression&&(o=""!==o?"(("+a._layer.definitionExpression+") AND ("+o+"))":a._layer.definitionExpression),i.where=o,i.where=o,i.spatialRelationship=a._makeRelationshipEnum(t),i.relationParameter=a._makeRelationshipParam(t),i.geometry=null===r?null:r,i.returnGeometry=!1,a.executeQuery(i,"executeForCount").then((function(e){return{calculated:!0,result:e}}))}))},t.prototype._stats=function(e,t,r,n,a,i,o){var s=this;return this._ensureLoaded().then((function(){var u=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsSqlExpression,f=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsStatistics,h=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsDistinct;return"count"===e?h?s._countstat(e,r,n,a):{calculated:!1}:!1===f||!1===c.isSingleField(t)&&!1===u||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:s._manualStat(e,t,i,o):"distinct"===e?!1===h?""!==r||null!==a?{calculated:!1}:s._manualStat(e,t,i,o):s._distinctStat(e,t,r,n,a,i,o):s.databaseType().then((function(i){if(s.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var o=new S;s._requestStandardised&&(o.sqlFormat="standard");var u=null===a?null===n?"1=1":"":l.toWhereClause(a,i);s._layer.definitionExpression&&(u=""!==u?"(("+s._layer.definitionExpression+") AND ("+u+"))":s._layer.definitionExpression),o.where=u,o.spatialRelationship=s._makeRelationshipEnum(r),o.relationParameter=s._makeRelationshipParam(r),o.geometry=null===n?null:n;var c=new b;c.statisticType=p.decodeStatType(e),c.onStatisticField=l.toWhereClause(t,i),c.outStatisticFieldName="ARCADE_STAT_RESULT",o.returnGeometry=!1;var f="ARCADE_STAT_RESULT";return o.outStatistics=[c],s.executeQuery(o,"execute").then((function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return d.reject(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){f=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[f];return null!==n&&(n=new Date(e.features[0].attributes[f])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[f]}}))}))}))},t.prototype._stat=function(e,t,r,n,a,i,o){return this._stats(e,t,r,n,a,i,o)},t.prototype._canDoAggregates=function(e,t){var r=this;return this._ensureLoaded().then((function(){var e=!1,n=r._layer.capabilities&&r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsSqlExpression;if(void 0!==r._layer.capabilities&&null!==r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsStatistics&&!0===r._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var a=0;a<t.length-1;a++)null!==t[a].workingexpr&&(!1===t[a].workingexpr.isStandardized||!1===c.isSingleField(t[a].workingexpr)&&!1===n)&&(e=!1);return!1!==e}))},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,o){var u=this;return this._ensureLoaded().then((function(){return u.databaseType()})).then((function(c){var p="",f=!1,d=!1;null!==i&&u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsOrderBy&&(p=i.constructClause(),d=!0),u._layer.capabilities&&u._layer.capabilities.query&&!1===u._layer.capabilities.query.supportsPagination&&(d=!1,f=!0,p=u._layer.objectIdField);for(var h=[],y=0;y<t.length;y++){var v=new b;v.onStatisticField=null!==t[y].workingexpr?l.toWhereClause(t[y].workingexpr,c):"",v.outStatisticFieldName=t[y].field,v.statisticType=t[y].toStatisticsName(),h.push(v)}""===p&&(p=e.join(","));var g=u._maxQueryRate(),m=u._layer.capabilities.query.maxRecordCount;void 0!==m&&m<g&&(g=m);var _=null===a?null===n?"1=1":"":l.toWhereClause(a,c);return u._layer.definitionExpression&&(_=""!==_?"(("+u._layer.definitionExpression+") AND ("+_+"))":u._layer.definitionExpression),new s([],["GETPAGES"],d,{groupbypage:!0,spatialRel:u._makeRelationshipEnum(r),relationParam:u._makeRelationshipParam(r),outFields:["*"],useOIDpagination:f,generatedOid:o,resultRecordCount:g,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:h,geometry:null===n?null:n,where:_,orderByFields:p,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}})}))},t.prototype._getAgregagtePhysicalPage=function(e,t,r){var a=this;try{var i=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(i=""!==i?"("+i+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var o=e.pagesDefinition.internal.lastRetrieved,s=o,u=new S;return this._requestStandardised&&(u.sqlFormat="standard"),u.where=i,u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields,u.outStatistics=e.pagesDefinition.outStatistics,u.geometry=e.pagesDefinition.geometry,u.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastRetrieved,u.returnGeometry=e.pagesDefinition.returnGeometry,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&u.geometry&&u.spatialRelationship?d.resolve([]):this.executeQuery(u,"execute").then((function(t){if(a._checkCancelled(r),!t.hasOwnProperty("features"))return d.reject(new Error("Unnexected Result querying aggregates from layer"));var i=[];if(e.pagesDefinition.internal.lastRetrieved!==o)return[];for(var u=0;u<t.features.length;u++)e.pagesDefinition.internal.set[s+u]=t.features[u].attributes[e.pagesDefinition.generatedOid];for(u=0;u<t.features.length;u++)i.push(new n({attributes:t.features[u].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=o+e.pagesDefinition.resultRecordCount,i}))}catch(e){return d.reject(e)}},t.create=function(e,r,n,a){return new t({layer:new y({url:e,outFields:null===r?["*"]:r}),spatialReference:n,lrucache:a})},t.prototype.relationshipMetaData=function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]},t.prototype.serviceUrl=function(){return u.extractServiceUrl(this._layer.parsedUrl.path)},t.prototype.queryAttachments=function(e,t,r,n){var a=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var o={objectIds:[e]};return(t&&t>0||r&&r>0)&&(o.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(o.attachmentTypes=n),this._layer.queryAttachments(o).then((function(t){var r=[];return t&&t[e]&&t[e].forEach((function(t){var n=a._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new i(t.id,t.name,t.contentType,t.size,n))})),r}))}return d.resolve([])},t.prototype.queryRelatedFeatures=function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),a(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups)for(var a=r.spatialReference,i=0,o=r.relatedRecordGroups;i<o.length;i++){for(var s=o[i],u=s.objectId,l=[],c=0,p=s.relatedRecords;c<p.length;c++){var f=p[c];f.geometry&&(f.geometry.spatialReference=a);var y=new n({geometry:f.geometry?h.fromJSON(f.geometry):null,attributes:f.attributes});l.push(y)}t[u]={features:l,exceededTransferLimit:!0===r.exceededTransferLimit}}return t}return d.reject("Invalid Request")}))},t.prototype.getFeatureByObjectId=function(e,t){var r=new g({url:this._layer.parsedUrl.path}),n=new S;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then((function(e){return 1===e.features.length?e.features[0]:null}))},t}(o)}.apply(null,n))||(e.exports=a)},1979:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(6)],void 0===(a=function(e,t,r){return function(){function e(e,t){this._lastId=-1,this._progress=t,this._parent=e}return e.prototype.reset=function(){this._lastId=-1},e.prototype.nextBatch=function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(r){return t.nextBatch(e)}),(function(r){return t.nextBatch(e)}));var n={returnpromise:null,hasset:!1},a=[];return n.returnpromise=r.create((function(r,i){t._parent._getSet(t._progress).then((function(o){var s=o._known.length-1;if("GETPAGES"===o._known[o._known.length-1]&&(s-=1),t._lastId+e<s&&o._known.length>0&&"GETPAGES"===o._known[o._known.length-1])t._parent._expandPagedSet(o,t._parent._maxQueryRate(),0,0,t._progress).then((function(r){return n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)}));else{if(s>=t._lastId+e||0===o._candidates.length){for(var u=0;u<e;u++){var l=u+t._lastId+1;if(l>=o._known.length)break;a[u]=o._known[l]}return t._lastId+=a.length,0===a.length&&(n.hasset=!0,t._parent._mainSetInUse=null,r([])),void t._parent._getFeatureBatch(a,t._progress).then((function(e){n.hasset=!0,t._parent._mainSetInUse=null,r(e)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}t._parent._refineSetBlock(o,t._parent._maxProcessingRate(),t._progress).then((function(){n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(r,i)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)}))})),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise},e.prototype.next=function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=r.create((function(r,n){e._parent._getSet(e._progress).then((function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then((function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()})).then(r,n):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then((function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then((function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise},e.prototype.count=function(){var e=this;return-1!==this._parent._totalCount?r.resolve(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,r.resolve(e._parent._totalCount)}))},e.prototype._refineAllSets=function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return r.resolve(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return r.resolve(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):r.resolve(e)})):r.resolve(e)},e}()}.apply(null,n))||(e.exports=a)},1980:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(240),r(1114),r(1107),r(1077),r(6),r(1086)],void 0===(a=function(e,t,r,n,a,i,o,s,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",r._findObjectId=-1,r._requestStandardised=!1,r._removeGeometry=!1,r._overrideFields=null,r.featureObjectId=null,r.relatedLayer=null,r.relationship=null,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,r._findObjectId=t.objectId,r.featureObjectId=t.objectId,r.relationship=t.relationship,r.relatedLayer=t.relatedLayer,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=s.create((function(t,r){s.all([e._layer.load(),e.relatedLayer.load()]).then((function(){e._initialiseFeatureSet(),t(e)}),r)}))),this._loadPromise},t.prototype.nativeCapabilities=function(){return this.relatedLayer.nativeCapabilities()},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{for(var e=[],t=[],r=0,n=this.fields;r<n.length;r++){var a=n[r];if("oid"===a.type)e.push(a),t.push(a.name);else for(var i=0,o=this._overrideFields;i<o.length;i++)if(o[i].toLowerCase()===a.name.toLowerCase()){e.push(a),t.push(a.name);break}}this.fields=e,this._overrideFields=t}var s=this._layer.nativeCapabilities();s&&(this._databaseType=s.databaseType,this._requestStandardised=s.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types},t.prototype.databaseType=function(){var e=this;return this.relatedLayer.databaseType().then((function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType}))},t.prototype.isTable=function(){return this.relatedLayer.isTable()},t.prototype._isInFeatureSet=function(){return o.IdState.InFeatureSet},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):s.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,a=this.fields;r<a.length;r++){var i=a[r];t[i.name]=e.attributes[i.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,a){var o=this;return this.databaseType().then((function(){if(o.isTable()&&t&&null!==e&&""!==e)return new i([],[],!0,null);var s=o._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new i([],[],!0,null);if(s.capabilities.queryRelated&&s.capabilities.queryRelated.supportsPagination)return o._getFilteredSetUsingPaging(e,t,r,n,a);var l="",c=!1;null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(l=n.constructClause(),c=!0);var p=new u;p.objectIds=[o._findObjectId];var f=null!==o._overrideFields?o._overrideFields:o._fieldsIncludingObjectId(o.relatedLayer.fields?o.relatedLayer.fields.map((function(e){return e.name})):["*"]);p.outFields=f,p.relationshipId=o.relationship.id,p.where="1=1";var d=!0;return!0===o._removeGeometry&&(d=!1),p.returnGeometry=d,o._requestStandardised&&(p.sqlFormat="standard"),p.outSpatialReference=o.spatialReference,p.orderByFields=""!==l?l.split(","):null,s.source.queryRelatedFeatures(p).then((function(n){o._checkCancelled(a);for(var s=n[o._findObjectId]?n[o._findObjectId].features:[],u=[],l=0;l<s.length;l++)o._featureCache[s[l].attributes[o._layer.objectIdField]]=s[l],u.push(s[l].attributes[o._layer.objectIdField]);var p=t&&null!==e&&""!==e,f=null!=r;return new i(p||f?u:[],p||f?[]:u,c,null)}))}))},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,a){var o=this;try{var u="",l=!1,c=this._layer.nativeCapabilities();return null!==n&&c&&c.capabilities.queryRelated&&!0===c.capabilities.queryRelated.supportsOrderBy&&(u=n.constructClause(),l=!0),this.databaseType().then((function(){var n=o._maxQueryRate(),s=c.capabilities.query.maxRecordCount;void 0!==s&&s<n&&(n=s);var p,f=t&&null!==e&&""!==e,d=null!=r,h=!0;!0===o._removeGeometry&&(h=!1);var y=null!==o._overrideFields?o._overrideFields:o._fieldsIncludingObjectId(o.relatedLayer.fields?o.relatedLayer.fields.map((function(e){return e.name})):["*"]);return p=new i(f||d?["GETPAGES"]:[],f||d?[]:["GETPAGES"],l,{outFields:y.join(","),resultRecordCount:n,resultOffset:0,objectIds:[o._findObjectId],where:"1=1",orderByFields:u,returnGeometry:h,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}}),o._expandPagedSet(p,n,0,0,a).then((function(){return p}))}))}catch(e){return s.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,o=this._layer.nativeCapabilities(),l=new u;return!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=e.pagesDefinition.objectIds,l.resultOffset=e.pagesDefinition.internal.lastRetrieved,l.resultRecordCount=e.pagesDefinition.resultRecordCount,l.outFields=e.pagesDefinition.outFields.split(","),l.where=e.pagesDefinition.where,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,o.source.queryRelatedFeatures(l).then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==a)return 0;for(var o=t[n._findObjectId]?t[n._findObjectId].features:[],s=0;s<o.length;s++)e.pagesDefinition.internal.set[i+s]=o[s].attributes[n._layer.objectIdField];for(s=0;s<o.length;s++)n._featureCache[o[s].attributes[n._layer.objectIdField]]=o[s];var u=!t[n._findObjectId]||!1===t[n._findObjectId].exceededTransferLimit;return o.length!==e.pagesDefinition.resultRecordCount&&u&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+o.length,o.length}))}catch(e){return s.reject(e)}},t.prototype._getFeatures=function(e,t,r,n){var a=this,i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);var o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o))return this._expandPagedSet(e,o,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var u=0,l=e._lastFetchedIndex;l<e._known.length&&(++u<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[l]&&void 0===this._featureCache[e._known[l]]&&(e._known[l]!==t&&i.push(e._known[l]),i.length>r)))&&!(u>=r&&0===i.length);l++);return 0===i.length?s.resolve("success"):s.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e,t,r){return s.resolve(e)},t.prototype._stat=function(e,t,r,n,a,i,o){return s.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,a){return s.resolve(!1)},t.prototype.relationshipMetaData=function(){return this.relatedLayer.relationshipMetaData()},t.prototype.serviceUrl=function(){return this.relatedLayer.serviceUrl()},t.prototype.queryAttachments=function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)},t.prototype.getFeatureByObjectId=function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)},t}(a)}.apply(null,n))||(e.exports=a)},1981:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(240),r(1049),r(1474),r(1337),r(1334),r(1114),r(1107),r(1335),r(1077),r(1115),r(1115),r(1333),r(1982),r(1173),r(6),r(769),r(28),r(851),r(902)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y,v,g,m,_,S,b){function w(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var F=function(e){function t(t){var r=e.call(this,t)||this;return r._decodedStatsfield=[],r._decodedGroupbyfield=[],r._candosimplegroupby=!0,r.phsyicalgroupbyfields=[],r.objectIdField="ROW__ID",r._internalObjectIdField="ROW__ID",r._adaptedFields=[],r.declaredClass="esri.arcade.featureset.actions.Aggregate",r._uniqueIds=1,r._maxQuery=10,r._maxProcessing=10,r._parent=t.parentfeatureset,r._config=t,r}return r(t,e),t.prototype.isTable=function(){return!0},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then((function(e){return t._wset=e,t._wset})):g.resolve(this._wset)},t.prototype._isInFeatureSet=function(){return p.IdState.InFeatureSet},t.prototype.nextUniqueName=function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t},t.prototype.convertToEsriFieldType=function(e){return e},t.prototype._initialiseFeatureSet=function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new b([]);for(this.objectIdField="ROW__ID";!1===t;){for(var a=!1,o=0;o<this._config.groupbyfields.length;o++)if(this._config.groupbyfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(o=0;o<this._config.statsfields.length;o++)if(this._config.statsfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(var s=0,u=this._config.statsfields;s<u.length;s++){var l=u[s],c=new y;c.field=l.name,c.tofieldname=l.name,c.workingexpr=l.expression instanceof m.WhereClause?l.expression:m.WhereClause.create(l.expression,n),c.typeofstat=w(l.statistic),this._decodedStatsfield.push(c)}this._decodedGroupbyfield=[];for(var h=0,v=this._config.groupbyfields;h<v.length;h++){var g={name:(l=v[h]).name,singlefield:null,tofieldname:l.name,expression:l.expression instanceof m.WhereClause?l.expression:m.WhereClause.create(l.expression,n)};this._decodedGroupbyfield.push(g)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(var F=0,x=this._parent.fields;F<x.length;F++)e[(l=x[F]).name.toUpperCase()]=1;this.types=null}else this.geometryType=p.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null,this.spatialReference=new _({wkid:4326});this.fields=[];var I=new y;I.field=this.nextUniqueName(e),I.tofieldname=this.objectIdField,I.workingexpr=m.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),I.typeofstat="MIN",this._decodedStatsfield.push(I);for(var T=0,R=this._decodedGroupbyfield;T<R.length;T++){var C=R[T],E=new S;if(C.name=this.nextUniqueName(e),E.name=C.tofieldname,E.alias=E.name,f.isSingleField(C.expression)){if(!(k=this._parent.getField(d.toWhereClause(C.expression,p.FeatureServiceDatabaseType.Standardised))))throw new Error("Field is not present for Aggregation");C.name=k.name,C.singlefield=k.name,this.phsyicalgroupbyfields.push(k.name),E.type=k.type}else{E.type=this.convertToEsriFieldType(d.predictType(C.expression,this._parent.fields));var N=new S;N.name=C.name,N.alias=N.name,this.phsyicalgroupbyfields.push(C.name),this._adaptedFields.push(new i.SqlExpressionAdapted(N,C.expression)),this._candosimplegroupby=!1}this.fields.push(E)}if(this._adaptedFields.length>0)for(var A=0,D=this._parent.fields;A<D.length;A++)l=D[A],this._adaptedFields.push(new i.OriginalField(l));for(o=0;o<this._decodedStatsfield.length;o++){E=new S;var k=null;(C=this._decodedStatsfield[o]).field=this.nextUniqueName(e),C.tofieldname===this.objectIdField&&(this._internalObjectIdField=C.field),E.name=C.tofieldname,E.alias=E.name;var P=null!==C.workingexpr&&f.isSingleField(C.workingexpr)?d.toWhereClause(C.workingexpr,p.FeatureServiceDatabaseType.Standardised):"";switch(this._decodedStatsfield[o].typeofstat){case"SUM":if(""!==P){if(!(k=this._parent.getField(P)))throw new Error("Field is not present for Aggregation");E.type=k.type}else E.type="double";break;case"MIN":case"MAX":if(""!==P){if(!(k=this._parent.getField(P)))throw new Error("Field is not present for Aggregation");E.type=k.type}else E.type="double";break;case"COUNT":E.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==P&&!(k=this._parent.getField(P)))throw new Error("Field is not present for Aggregation");E.type="double"}this.fields.push(E)}},t.prototype._canDoAggregates=function(){return g.resolve(!1)},t.prototype._getFeatures=function(e,t,r,n){var a=this;-1!==t&&void 0===this._featureCache[t]&&[].push(t);var i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?this._expandPagedSet(e,i,0,0,n).then((function(){return a._getFeatures(e,t,r,n)})):g.resolve("success")},t.prototype._getFilteredSet=function(e,t,r,n,a){var u=this;if(""!==e)return g.resolve(new l([],[],!0,null));var p=null,d={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((function(){if(null!==r)for(var e=0;e<u._decodedStatsfield.length;e++)if(!0===f.scanForField(r,u._decodedStatsfield[e].tofieldname)){d.nowhereclause=!0,r=null;break}if(null!==n){for(d.ordered=!0,e=0;e<u._decodedStatsfield.length;e++)if(!0===n.scanForField(u._decodedStatsfield[e].tofieldname)){n=null,d.ordered=!1;break}if(null!==n)for(var t=0,a=u._decodedGroupbyfield;t<a.length;t++){var i=a[t];if(null===i.singlefield&&!0===n.scanForField(i.tofieldname)){n=null,d.ordered=!1;break}}}return!1===u._candosimplegroupby?g.resolve(!1):u._parent._canDoAggregates(u.phsyicalgroupbyfields,u._decodedStatsfield,"",null,null)})).then((function(e){if(e){var t=null;r&&(t=u._reformulateWhereClauseWithoutGroupByFields(r));var f=null;return n&&(f=u._reformulateOrderClauseWithoutGroupByFields(n)),u._parent._getAggregatePagesDataSourceDefinition(u.phsyicalgroupbyfields,u._decodedStatsfield,"",null,t,f,u._internalObjectIdField).then((function(e){return u._checkCancelled(a),p=!0===d.nowhereclause?new l(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===d.ordered&&e._ordered,u._clonePageDefinition(e.pagesDefinition)):new l(e._candidates.slice(0),e._known.slice(0),!0===d.ordered&&e._ordered,u._clonePageDefinition(e.pagesDefinition))}))}var h=u._parent;if(u._adaptedFields.length>0&&(h=new i.AdaptedFeatureSet({parentfeatureset:u._parent,adaptedFields:u._adaptedFields,extraFilter:null})),!0===d.nowhereclause)p=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:u._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:h,orderbyclause:new c(u.phsyicalgroupbyfields.join(",")+","+u._parent.objectIdField+" ASC")})}});else{var y=h;if(null!==r){var v=null;r&&(v=u._reformulateWhereClauseWithoutGroupByFields(r)),y=new o({parentfeatureset:y,whereclause:v})}p=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:u._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:y,orderbyclause:new c(u.phsyicalgroupbyfields.join(",")+","+u._parent.objectIdField+" ASC")})}})}return p}))},t.prototype._reformulateWhereClauseWithoutStatsFields=function(e){for(var t=0,r=this._decodedStatsfield;t<r.length;t++){var n=r[t];e=d.reformulateWithoutField(e,n.tofieldname,d.toWhereClause(n.workingexpr,p.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex())}return e},t.prototype._reformulateWhereClauseWithoutGroupByFields=function(e){for(var t=0,r=this._decodedGroupbyfield;t<r.length;t++){var n=r[t];n.tofieldname!==n.name&&(e=d.reformulateWithoutField(e,n.tofieldname,d.toWhereClause(n.expression,p.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex()))}return e},t.prototype._reformulateOrderClauseWithoutGroupByFields=function(e){for(var t=[],r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r];a.tofieldname!==a.name&&t.push({field:a.tofieldname,newfield:a.name})}return t.length>0?e.replaceFields(t):e},t.prototype._clonePageDefinition=function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)},t.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,g.resolve(e)}catch(e){return g.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._getPhysicalPage=function(e,t,r){var a=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?g.create((function(t,n){a._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then((function(e){t(e)}),n)})):this._getAgregagtePhysicalPage(e,t,r).then((function(e){for(var t=0,r=e;t<r.length;t++){for(var i=r[t],o={geometry:i.geometry,attributes:{}},s=0,u=a._decodedGroupbyfield;s<u.length;s++){var l=u[s];o.attributes[l.tofieldname]=i.attributes[l.name]}for(var c=0,p=a._decodedStatsfield;c<p.length;c++)l=p[c],o.attributes[l.tofieldname]=i.attributes[l.field];a._featureCache[o.attributes[a.objectIdField]]=new n(o)}return e.length}))},t.prototype._sequentialGetPhysicalItem=function(e,t,r,n){var a=this;return g.create((function(i,o){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):a._nextAggregateItem(e,t,r,n,(function(o){null===o?i(n.length):(t-=1,i(a._sequentialGetPhysicalItem(e,t,r,n)))}),o)}))},t.prototype._nextAggregateItem=function(e,t,r,n,i,o){var s=this;try{a.tick(e.pagesDefinition.internal.iterator.next()).then((function(a){if(null===a)if(null!==e.pagesDefinition.internal.workingItem){var u=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(u),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(u.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,i(null)}else e.pagesDefinition.internal.fullyResolved=!0,i(null);else{var l=s._generateAggregateHash(a);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[a],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id)return u=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem),n.push(u),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(u.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[a],id:l},void i(u);e.pagesDefinition.internal.workingItem.features.push(a)}s._nextAggregateItem(e,t,r,n,i,o)}}),o)}catch(e){o(e)}},t.prototype._calculateFieldStat=function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=h.calculateStat("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=h.calculateStat("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=h.calculateStat("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=h.calculateStat("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=h.calculateStat("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=h.calculateStat("avg",n,-1)}return!0},t.prototype._calculateAndAppendAggregateItem=function(e){for(var t={attributes:{},geometry:null},r=0,a=this._decodedGroupbyfield;r<a.length;r++){var i=a[r],o=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);t.attributes[i.tofieldname]=o}for(var s=0,u=this._decodedStatsfield;s<u.length;s++){var l=u[s];this._calculateFieldStat(e,l,t)}for(var c=[],p=0;p<this._decodedStatsfield.length;p++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[p],t));return this._featureCache[t.attributes[this.objectIdField]]=new n({attributes:t.attributes,geometry:t.geometry}),t},t.prototype._generateAggregateHash=function(e){for(var t="",r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r],i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);t+=null==i?":":":"+i.toString()}return v.createMD5Hash(t,v.outputTypes.String)},t.prototype._stat=function(){return g.resolve({calculated:!1})},t.prototype.getFeatureByObjectId=function(){return g.resolve(null)},t}(u);return u._featuresetFunctions.groupby=function(e,t){return new F({parentfeatureset:this,groupbyfields:e,statsfields:t})},F}.apply(null,n))||(e.exports=a)},1982:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1077),r(1115),r(769)],void 0===(a=function(e,t,r,n,a){return function(){function e(){}return e.prototype.clone=function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t},e.parseStatField=function(t,i,o){var s=new e;s.field=t;var u=a.WhereClause.create(i,o),l=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=a.WhereClause.create(n.toWhereClauseFromTree(e.parseTree.args.value[0],r.FeatureServiceDatabaseType.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(u);if(null===l)throw new Error("Invalid Statistic Function");var c=l.name.toUpperCase().trim();if("MIN"===c){if(s.typeofstat="MIN",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===c){if(s.typeofstat="MAX",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===c)s.typeofstat="COUNT",s.workingexpr=l.expr;else if("STDEV"===c){if(s.typeofstat="STDDEV",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===c){if(s.typeofstat="SUM",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===c){if(s.typeofstat="AVG",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===c){if(s.typeofstat="AVG",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==c)throw new Error("Invalid Statistic Function");if(s.typeofstat="VAR",s.workingexpr=l.expr,null===u)throw new Error("Invalid Statistic Function Parameters")}return s},e.prototype.toStatisticsName=function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}},e}()}.apply(null,n))||(e.exports=a)},1983:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1190),r(1104),r(1104),r(1134),r(1469),r(1468),r(1049),r(1474),r(1337),r(1334),r(1472),r(1336),r(1471),r(1335),r(1077),r(1115),r(1283),r(6),r(769),r(904),r(851)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y,v,g,m,_,S,b,w){function F(e,t,r){var n=e.getVariables();if(n.length>0){for(var a=[],i=0;i<n.length;i++){var o={name:n[i]};a.push(t.evaluateIdentifier(r,o))}return _.all(a).then((function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e}))}return _.resolve(e)}function x(e,t,r){for(var n in void 0===r&&(r=null),e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function I(e){if(null===e)return null;var t={type:x(e,"type",""),name:x(e,"name","")};if("range"===t.type)t.range=x(e,"range",[]);else{t.codedValues=[];for(var r=0,n=x(e,"codedValues",[]);r<n.length;r++){var a=n[r];t.codedValues.push({name:x(a,"name",""),code:x(a,"code",null)})}}return t}function T(e){if(null===e)return null;var t={},r=x(e,"wkt",null);null!==r&&(t.wkt=r);var n=x(e,"wkid",null);return null!==n&&(t.wkid=n),t}function R(e){if(null===e)return null;var t={hasZ:x(e,"hasz",!1),hasM:x(e,"hasm",!1)},r=x(e,"spatialreference",null);r&&(t.spatialReference=T(r));var n=x(e,"x",null);if(null!==n)return t.x=n,t.y=x(e,"y",null),t;var a=x(e,"rings",null);if(null!==a)return t.rings=a,t;var i=x(e,"paths",null);if(null!==i)return t.paths=i,t;var o=x(e,"points",null);if(null!==o)return t.points=o,t;for(var s=0,u=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];s<u.length;s++){var l=u[s],c=x(e,l,null);null!==c&&(t[l]=c)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(u.pcCheck(r,2,4),r[0]instanceof o){var n=u.toString(r[1]),a=u.defaultUndefined(r[2],null),i=u.toBoolean(u.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===u.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,(function(e,n,a){if(u.pcCheck(a,2,5),null===a[0])throw new Error("Portal is required");if(a[0]instanceof r){var i=u.toString(a[1]),o=u.toString(a[2]),l=u.defaultUndefined(a[3],null),c=u.toBoolean(u.defaultUndefined(a[4],!0));if(null===l&&(l=["*"]),!1===u.isArray(l))throw new Error("Invalid Parameter");var p=null;return t.services&&t.services.portal&&(p=t.services.portal),p=s.getPortal(a[0],p),s.constructFeatureSetFromPortalItem(i,o,t.spatialReference,l,c,p,t.lrucache)}if(!1===u.isString(a[0]))throw new Error("Portal is required");var f=u.toString(a[0]),d=u.toString(a[1]),h=u.defaultUndefined(a[2],null),y=u.toBoolean(u.defaultUndefined(a[3],!0));if(null===h&&(h=["*"]),!1===u.isArray(h))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return s.constructFeatureSetFromPortalItem(f,d,t.spatialReference,h,y,t.services.portal,t.lrucache);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(u.pcCheck(r,2,4),r[0]instanceof o){var n=u.toString(r[1]),a=u.defaultUndefined(r[2],null),i=u.toBoolean(u.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===u.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,(function(e,r,a){u.pcCheck(a,1,1);var i,o=a[0],s={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(u.isString(o))void 0!==(o=JSON.parse(o)).layerDefinition?(s.layerDefinition=o.layerDefinition,s.featureSet=o.featureSet,o.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=o.layerDefinition.spatialReference)):(s.featureSet.features=o.features,s.featureSet.geometryType=o.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=o.objectIdFieldName,s.layerDefinition.typeIdField=o.typeIdFieldName,s.layerDefinition.fields=o.fields,o.spatialReference&&(s.layerDefinition.spatialReference=o.spatialReference));else{if(!(a[0]instanceof n))throw new Error("Invalid Parameter");var l=x(o=JSON.parse(a[0].castToText()),"layerdefinition");if(null!==l){s.layerDefinition.geometryType=x(l,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=x(l,"objectidfield",""),s.layerDefinition.typeIdField=x(l,"typeidfield",""),(F=x(l,"spatialreference",null))&&(s.layerDefinition.spatialReference=T(F));for(var c=0,p=x(l,"fields",[]);c<p.length;c++){var f={name:x(N=p[c],"name",""),alias:x(N,"alias",""),type:x(N,"type",""),nullable:x(N,"nullable",!0),editable:x(N,"editable",!0),length:x(N,"length",null),domain:I(x(N,"domain"))};s.layerDefinition.fields.push(f)}var d=x(o,"featureset",null);if(d){for(var y={},v=0,g=s.layerDefinition.fields;v<g.length;v++)y[(w=g[v]).name.toLowerCase()]=w.name;for(var m=0,_=x(d,"features",[]);m<_.length;m++){var S={},b=x(O=_[m],"attributes",{});for(var w in b)S[y[w.toLowerCase()]]=b[w];s.featureSet.features.push({attributes:S,geometry:R(x(O,"geometry",null))})}}}else{var F;s.layerDefinition.geometryType=x(o,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=x(o,"objectidfieldname",""),s.layerDefinition.typeIdField=x(o,"typeidfieldname",""),(F=x(o,"spatialreference",null))&&(s.layerDefinition.spatialReference=T(F));for(var C=0,E=x(o,"fields",[]);C<E.length;C++){var N;f={name:x(N=E[C],"name",""),alias:x(N,"alias",""),type:x(N,"type",""),nullable:x(N,"nullable",!0),editable:x(N,"editable",!0),length:x(N,"length",null),domain:I(x(N,"domain"))},s.layerDefinition.fields.push(f)}y={};for(var A=0,D=s.layerDefinition.fields;A<D.length;A++)y[(w=D[A]).name.toLowerCase()]=w.name;for(var k=0,P=x(o,"features",[]);k<P.length;k++){var O;for(var w in S={},b=x(O=P[k],"attributes",{}))S[y[w.toLowerCase()]]=b[w];s.featureSet.features.push({attributes:S,geometry:R(x(O,"geometry",null))})}}}if(0==(!!(i=s).layerDefinition&&!!i.featureSet&&!1!==function(e,t){for(var r=0,n=["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"];r<n.length;r++)if(n[r]===e)return!0;return!1}(i.layerDefinition.geometryType)&&null!==i.layerDefinition.objectIdField&&""!==i.layerDefinition.objectIdField&&!1!==u.isArray(i.layerDefinition.fields)&&!1!==u.isArray(i.featureSet.features)))throw new Error("Invalid Parameter");return h.create(s,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return u.pcCheck(a,2,2),u.isFeatureSet(a[0])?a[0].load().then((function(r){var n=S.WhereClause.create(a[1],r.getFieldsIndex()),i=n.getVariables();if(i.length>0){for(var o=[],s=0;s<i.length;s++){var u={name:i[s]};o.push(e.evaluateIdentifier(t,u))}return _.all(o).then((function(e){for(var t={},r=0;r<i.length;r++)t[i[r]]=e[r];return n.parameters=t,new c({parentfeatureset:a[0],whereclause:n})}))}return _.resolve(new c({parentfeatureset:a[0],whereclause:n}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){if(u.pcCheck(n,2,2),u.isFeatureSet(n[0])){var a=new y(n[1]);return _.resolve(new p({parentfeatureset:n[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){return u.pcCheck(n,2,2),u.isFeatureSet(n[0])?_.resolve(new f({parentfeatureset:n[0],topnum:n[1]})):u.isArray(n[0])?u.toNumber(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,u.toNumber(n[1])):u.isImmutableArray(n[0])?u.toNumber(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,u.toNumber(n[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return u.pcCheck(r,1,1),u.isFeatureSet(r[0])?r[0].first(e.abortSignal).then((function(e){if(null!==e){var t=i.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e})):u.isArray(r[0])?0===r[0].length?_.resolve(null):_.resolve(r[0][0]):u.isImmutableArray(r[0])?0===r[0].length()?_.resolve(null):_.resolve(r[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,a){u.pcCheck(a,1,2);var o={minsize:-1,maxsize:-1,types:null};if(a.length>1)if(a[1]instanceof n){if(a[1].hasField("minsize")&&(o.minsize=u.toNumber(a[1].field("minsize"))),a[1].hasField("maxsize")&&(o.maxsize=u.toNumber(a[1].field("maxsize"))),a[1].hasField("types")){var l=u.toStringArray(a[1].field("types"),!1);l.length>0&&(o.types=l)}}else if(null!==a[1])throw new Error("Invalid Parameter");if(a[0]instanceof i){var c=a[0]._layer;return c instanceof b&&(c=s.constructFeatureSet(c,t.spatialReference,["*"],!0,t.lrucache)),null===c||!1===u.isFeatureSet(c)?[]:c.load().then((function(){return c.queryAttachments(a[0].field(c.objectIdField),o.minsize,o.maxsize,o.types)}))}if(null===a[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){u.pcCheck(n,2,4);var a=n[0],o=u.toString(n[1]),l=u.defaultUndefined(n[2],null),c=u.toBoolean(u.defaultUndefined(n[3],!0));if(null===l&&(l=["*"]),!1===u.isArray(l))throw new Error("Invalid Parameter");if(null===n[0])return null;if(!(n[0]instanceof i))throw new Error("Invalid Parameter");var p=a._layer;return p instanceof b&&(p=s.constructFeatureSet(p,t.spatialReference,["*"],!0,t.lrucache)),null===p||!1===u.isFeatureSet(p)?null:p.load().then((function(e){var r=e.relationshipMetaData().filter((function(e){return e.name===o}));if(0===r.length)return null;if(void 0!==r[0].relationshipTableId&&null!==r[0].relationshipTableId&&r[0].relationshipTableId>-1)return s.constructFeatureSetFromRelationship(e,r[0],a.field(e.objectIdField),e.spatialReference,l,c,t.lrucache);var n=e.serviceUrl();return n?(n="/"===n.charAt(n.length-1)?n+r[0].relatedTableId.toString():n+"/"+r[0].relatedTableId.toString(),s.constructFeatureSetFromUrl(n,e.spatialReference,l,c,t.lrucache).then((function(t){return t.load().then((function(){return t.relationshipMetaData()})).then((function(n){if(n=n.filter((function(e){return e.id===r[0].id})),!1===a.hasField(r[0].keyField)||null===a.field(r[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[r[0].keyField]).then((function(e){if(e){var a=S.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return a.parameters={id:e.attributes[r[0].keyField]},t.filter(a)}return new d({parentfeatureset:t})}));var i=S.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return i.parameters={id:a.field(r[0].keyField)},t.filter(i)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){u.pcCheck(n,2,3);var a=n[0],o=u.toString(u.defaultUndefined(n[1],"")).toLowerCase(),c=u.isString(n[2])?u.toString(n[2]):null;if(null===n[0])return null;if(!(n[0]instanceof i))throw new Error("Invalid Parameter");var p=a._layer;return p instanceof b&&(p=s.constructFeatureSet(p,t.spatialReference,["*"],!0,t.lrucache)),null===p||!1===u.isFeatureSet(p)?null:p.load().then((function(){var e=p.serviceUrl();return s.constructAssociationMetaDataFeatureSetFromUrl(e,t.spatialReference)})).then((function(e){var t=null,r=null,n=!1;if(null!==c&&""!==c&&void 0!==c){for(var i=0,s=e.terminals;i<s.length;i++){var f=s[i];f.terminalName===c&&(r=f.terminalId)}null===r&&(n=!0)}for(var d=e.associations.getFieldsIndex(),h=d.get("TOGLOBALID").name,y=d.get("FROMGLOBALID").name,g=d.get("TOTERMINALID").name,m=d.get("FROMTERMINALID").name,_=d.get("FROMNETWORKSOURCEID").name,b=d.get("TONETWORKSOURCEID").name,F=d.get("ASSOCIATIONTYPE").name,x=d.get("ISCONTENTVISIBLE").name,I=d.get("OBJECTID").name,T=0,R=p.fields;T<R.length;T++){var C=R[T];if("global-id"===C.type){t=a.field(C.name);break}}var E=null,N={};for(var A in e.lkp)N[A]=e.lkp[A].sourceId;var D=new l.StringToCodeAdapted(new w({name:"classname",alias:"classname",type:"string"}),null,N),k="";switch(o){case"connected":var P=h+"='@T'",O=y+"='@T'";null!==r&&(P+=" AND "+g+"=@A",O+=" AND "+m+"=@A"),k="(("+P+") OR ("+O+"))",k=u.multiReplace(k,"@T",t),P=u.multiReplace(P,"@T",t),null!==r&&(P=u.multiReplace(P,"@A",r.toString()),k=u.multiReplace(k,"@A",r.toString())),D.codefield=S.WhereClause.create("CASE WHEN "+P+" THEN "+_+" ELSE "+b+" END",e.associations.getFieldsIndex());var M=v.cloneField(l.AdaptedFeatureSet.findField(e.associations.fields,y));M.name="globalid",M.alias="globalid",E=new l.SqlExpressionAdapted(M,S.WhereClause.create("CASE WHEN "+P+" THEN "+y+" ELSE "+h+" END",e.associations.getFieldsIndex()));break;case"container":k=h+"='"+t+"' AND "+F+" = 2",null!==r&&(k+=" AND "+g+" = "+r.toString()),D.codefield=_,k="( "+k+" )",E=new l.FieldRename(l.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalid");case"content":k="("+y+"='"+t+"' AND "+F+" = 2)",null!==r&&(k+=" AND "+m+" = "+r.toString()),D.codefield=b,k="( "+k+" )",E=new l.FieldRename(l.AdaptedFeatureSet.findField(e.associations.fields,h),"globalid","globalid");break;case"structure":k="("+h+"='"+t+"' AND "+F+" = 3)",null!==r&&(k+=" AND "+g+" = "+r.toString()),D.codefield=_,k="( "+k+" )",E=new l.FieldRename(l.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalId");break;case"attached":k="("+y+"='"+t+"' AND "+F+" = 3)",null!==r&&(k+=" AND "+m+" = "+r.toString()),D.codefield=b,k="( "+k+" )",E=new l.FieldRename(l.AdaptedFeatureSet.findField(e.associations.fields,h),"globalid","globalId");break;default:throw new Error("Invalid Parameter")}return n&&(k="1 <> 1"),new l.AdaptedFeatureSet({parentfeatureset:e.associations,adaptedFields:[new l.OriginalField(l.AdaptedFeatureSet.findField(e.associations.fields,I)),new l.OriginalField(l.AdaptedFeatureSet.findField(e.associations.fields,x)),E,D],extraFilter:k?S.WhereClause.create(k,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,i){return u.pcCheck(i,3,3),u.isFeatureSet(i[0])?i[0].load().then((function(r){var n=[],o=[],s=!1,l=[];if(u.isString(i[1]))l.push(i[1]);else if(i[1]instanceof a)l.push(i[1]);else if(u.isArray(i[1]))l=i[1];else{if(!u.isImmutableArray(i[1]))return e.failDefferred("Illegal Value: GroupBy");l=i[1].toArray()}for(var c=0,p=l;c<p.length;c++){var f=p[c];if(u.isString(f)){var d=S.WhereClause.create(u.toString(f),r.getFieldsIndex()),h=!0===g.isSingleField(d)?u.toString(f):"%%%%FIELDNAME";n.push({name:h,expression:d}),"%%%%FIELDNAME"===h&&(s=!0)}else{if(!(f instanceof a))return e.failDefferred("Illegal Value: GroupBy");var y=f.hasField("name")?f.field("name"):"%%%%FIELDNAME";if(d=f.hasField("expression")?f.field("expression"):"","%%%%FIELDNAME"===y&&(s=!0),!y)return e.failDefferred("Illegal Value: GroupBy");n.push({name:y,expression:S.WhereClause.create(d||y,r.getFieldsIndex())})}}if(l=[],u.isString(i[2]))l.push(i[2]);else if(u.isArray(i[2]))l=i[2];else if(u.isImmutableArray(i[2]))l=i[2].toArray();else{if(!(i[2]instanceof a))return e.failDefferred("Illegal Value: GroupBy");l.push(i[2])}for(var v=0,m=l;v<m.length;v++){if(!((f=m[v])instanceof a))return e.failDefferred("Illegal Value: GroupBy");var b=f.hasField("name")?f.field("name"):"",w=f.hasField("statistic")?f.field("statistic"):"";if(d=f.hasField("expression")?f.field("expression"):"",!b||!w||!d)return e.failDefferred("Illegal Value: GroupBy");o.push({name:b,statistic:w.toLowerCase(),expression:S.WhereClause.create(d,r.getFieldsIndex())})}if(s){for(var x={},I=0,T=r.fields;I<T.length;I++)x[(P=T[I]).name.toLowerCase()]=1;for(var R=0,C=n;R<C.length;R++)"%%%%FIELDNAME"!==(P=C[R]).name&&(x[P.name.toLowerCase()]=1);for(var E=0,N=o;E<N.length;E++)"%%%%FIELDNAME"!==(P=N[E]).name&&(x[P.name.toLowerCase()]=1);for(var A=0,D=0,k=n;D<k.length;D++){var P;if("%%%%FIELDNAME"===(P=k[D]).name){for(;1===x["field_"+A.toString()];)A++;x["field_"+A.toString()]=1,P.name="FIELD_"+A.toString()}}}for(var O=[],M=0,L=n;M<L.length;M++){var j=L[M];O.push(F(j.expression,e,t))}for(var G=0,B=o;G<B.length;G++)j=B[G],O.push(F(j.expression,e,t));return O.length>0?_.all(O).then((function(){return _.resolve(i[0].groupby(n,o))})):_.resolve(i[0].groupby(n,o))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,i){return u.isFeatureSet(i[0])?(u.pcCheck(i,2,2),i[0].load().then((function(r){var n=[],o=[];if(u.isString(i[1]))o.push(i[1]);else if(i[1]instanceof a)o.push(i[1]);else if(u.isArray(i[1]))o=i[1];else{if(!u.isImmutableArray(i[1]))return e.failDefferred("Illegal Value: GroupBy");o=i[1].toArray()}for(var s=!1,l=0,c=o;l<c.length;l++){var p=c[l];if(u.isString(p)){var f=S.WhereClause.create(u.toString(p),r.getFieldsIndex()),d=!0===g.isSingleField(f)?u.toString(p):"%%%%FIELDNAME";n.push({name:d,expression:f}),"%%%%FIELDNAME"===d&&(s=!0)}else{if(!(p instanceof a))return e.failDefferred("Illegal Value: GroupBy");var h=p.hasField("name")?p.field("name"):"%%%%FIELDNAME";if(f=p.hasField("expression")?p.field("expression"):"","%%%%FIELDNAME"===h&&(s=!0),!h)return e.failDefferred("Illegal Value: GroupBy");n.push({name:h,expression:S.WhereClause.create(f||h,r.getFieldsIndex())})}}if(s){for(var y={},v=0,m=r.fields;v<m.length;v++)y[(R=m[v]).name.toLowerCase()]=1;for(var b=0,w=n;b<w.length;b++)"%%%%FIELDNAME"!==(R=w[b]).name&&(y[R.name.toLowerCase()]=1);for(var x=0,I=0,T=n;I<T.length;I++){var R;if("%%%%FIELDNAME"===(R=T[I]).name){for(;1===y["field_"+x.toString()];)x++;y["field_"+x.toString()]=1,R.name="FIELD_"+x.toString()}}}for(var C=[],E=0,N=n;E<N.length;E++){var A=N[E];C.push(F(A.expression,e,t))}return C.length>0?_.all(C).then((function(){return _.resolve(i[0].groupby(n,[]))})):_.resolve(i[0].groupby(n,[]))}))):function(e,t,r,n){if(1===n.length){if(u.isArray(n[0]))return m.calculateStat(e,n[0],-1);if(u.isImmutableArray(n[0]))return m.calculateStat(e,n[0].toArray(),-1)}return m.calculateStat(e,n,-1)}("distinct",0,0,i)}))})}}.apply(null,n))||(e.exports=a)},1984:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1227),r(1049),r(1473),r(1336),r(6),r(44),r(1207)],void 0===(a=function(e,t,r,n,a,i,o,s,u){function l(e,t,l,c,p){return p(e,t,(function(e,t,p){if(p.length<2)return c(new Error("Missing Parameters"));if(null===(p=n.autoCastFeatureToGeometry(p))[0]&&null===p[1])return o.resolve(!1);if(n.isFeatureSet(p[0]))return p[1]instanceof s?o.resolve(new a({parentfeatureset:p[0],relation:l,relationGeom:p[1]})):null===p[1]?o.resolve(new i({parentfeatureset:p[0]})):c("Spatial Relation cannot accept this parameter type");if(p[0]instanceof s){if(p[1]instanceof s){var f=null;switch(l){case"esriSpatialRelEnvelopeIntersects":f=u.intersects(r.shapeExtent(p[0]),r.shapeExtent(p[1]));break;case"esriSpatialRelIntersects":f=u.intersects(p[0],p[1]);break;case"esriSpatialRelContains":f=u.contains(p[0],p[1]);break;case"esriSpatialRelOverlaps":f=u.overlaps(p[0],p[1]);break;case"esriSpatialRelWithin":f=u.within(p[0],p[1]);break;case"esriSpatialRelTouches":f=u.touches(p[0],p[1]);break;case"esriSpatialRelCrosses":f=u.crosses(p[0],p[1])}return null!==f?f:o.reject(new Error("Unrecognised Relationship"))}return n.isFeatureSet(p[1])?o.resolve(new a({parentfeatureset:p[1],relation:l,relationGeom:p[0]})):null===p[1]?o.resolve(!1):c("Spatial Relation cannot accept this parameter type")}return null!==p[0]?c("Spatial Relation cannot accept this parameter type"):n.isFeatureSet(p[1])?o.resolve(new i({parentfeatureset:p[1]})):p[1]instanceof s||null===p[1]?o.resolve(!1):void 0}))}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.intersects=function(t,r){return l(t,r,"esriSpatialRelIntersects",e.failDefferred,e.standardFunctionAsync)},e.functions.envelopeintersects=function(t,r){return l(t,r,"esriSpatialRelEnvelopeIntersects",e.failDefferred,e.standardFunctionAsync)},e.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),e.functions.contains=function(t,r){return l(t,r,"esriSpatialRelContains",e.failDefferred,e.standardFunctionAsync)},e.functions.overlaps=function(t,r){return l(t,r,"esriSpatialRelOverlaps",e.failDefferred,e.standardFunctionAsync)},e.functions.within=function(t,r){return l(t,r,"esriSpatialRelWithin",e.failDefferred,e.standardFunctionAsync)},e.functions.touches=function(t,r){return l(t,r,"esriSpatialRelTouches",e.failDefferred,e.standardFunctionAsync)},e.functions.crosses=function(t,r){return l(t,r,"esriSpatialRelCrosses",e.failDefferred,e.standardFunctionAsync)},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=n.autoCastFeatureToGeometry(r),n.pcCheck(r,3,3),r[0]instanceof s&&r[1]instanceof s)return u.relate(r[0],r[1],n.toString(r[2]));if(r[0]instanceof s&&null===r[1])return!1;if(r[1]instanceof s&&null===r[0])return!1;if(n.isFeatureSet(r[0])&&null===r[1])return new i({parentfeatureset:r[0]});if(n.isFeatureSet(r[1])&&null===r[0])return new i({parentfeatureset:r[1]});if(n.isFeatureSet(r[0])&&r[1]instanceof s)return r[0].relate(r[1],n.toString(r[2]));if(n.isFeatureSet(r[1])&&r[0]instanceof s)return r[1].relate(r[0],n.toString(r[2]));if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")}))})}}.apply(null,n))||(e.exports=a)},1985:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1049),r(1283),r(6),r(769)],void 0===(a=function(e,t,r,n,a,i){function o(e,t,o,u,l,c){if(1===u.length){if(r.isArray(u[0]))return a.resolve(n.calculateStat(e,u[0],r.defaultUndefined(u[1],-1)));if(r.isImmutableArray(u[0]))return a.resolve(n.calculateStat(e,u[0].toArray(),r.defaultUndefined(u[1],-1)))}else if(2===u.length){if(r.isArray(u[0]))return a.resolve(n.calculateStat(e,u[0],r.defaultUndefined(u[1],-1)));if(r.isImmutableArray(u[0]))return a.resolve(n.calculateStat(e,u[0].toArray(),r.defaultUndefined(u[1],-1)));if(r.isFeatureSet(u[0]))return u[0].load().then((function(n){return s(i.WhereClause.create(u[1],n.getFieldsIndex()),c,l).then((function(n){return u[0].calculateStatistic(e,n,r.defaultUndefined(u[2],1e3),t.abortSignal)}))}))}else if(3===u.length&&r.isFeatureSet(u[0]))return u[0].load().then((function(n){return s(i.WhereClause.create(u[1],n.getFieldsIndex()),c,l).then((function(n){return u[0].calculateStatistic(e,n,r.defaultUndefined(u[2],1e3),t.abortSignal)}))}));return a.resolve(n.calculateStat(e,u,-1))}function s(e,t,r){try{var n=e.getVariables();if(n.length>0){for(var i=[],o=0;o<n.length;o++){var s={name:n[o]};i.push(t.evaluateIdentifier(r,s))}return a.all(i).then((function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e}))}return a.resolve(e)}catch(e){return a.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.stdev=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("stdev",r,0,a,t,e)}))},e.functions.variance=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("variance",r,0,a,t,e)}))},e.functions.average=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("mean",r,0,a,t,e)}))},e.functions.mean=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("mean",r,0,a,t,e)}))},e.functions.sum=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("sum",r,0,a,t,e)}))},e.functions.min=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("min",r,0,a,t,e)}))},e.functions.max=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return o("max",r,0,a,t,e)}))},e.functions.count=function(t,n){return e.standardFunctionAsync(t,n,(function(e,t,n){if(r.pcCheck(n,1,1),r.isFeatureSet(n[0]))return n[0].count(e.abortSignal);if(r.isArray(n[0])||r.isString(n[0]))return n[0].length;if(r.isImmutableArray(n[0]))return n[0].length();throw new Error("Invalid Parameters for Count")}))})}}.apply(null,n))||(e.exports=a)},1986:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1134),r(1049)],void 0===(a=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.domainname=function(t,a){return e.standardFunctionAsync(t,a,(function(e,t,a){if(n.pcCheck(a,2,4),a[0]instanceof r)return a[0].domainValueLookup(n.toString(a[1]),a[2],void 0===a[3]?void 0:n.toNumber(a[3]));if(n.isFeatureSet(a[0]))return a[0]._ensureLoaded().then((function(){var e=n.getDomain(n.toString(a[1]),a[0],null,void 0===a[3]?void 0:n.toNumber(a[3]));return n.getDomainValue(e,a[2])}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"domainname",min:"2",max:"4"}),e.functions.domaincode=function(t,a){return e.standardFunctionAsync(t,a,(function(e,t,a){if(n.pcCheck(a,2,4),a[0]instanceof r)return a[0].domainCodeLookup(n.toString(a[1]),a[2],void 0===a[3]?void 0:n.toNumber(a[3]));if(n.isFeatureSet(a[0]))return a[0]._ensureLoaded().then((function(){var e=n.getDomain(n.toString(a[1]),a[0],null,void 0===a[3]?void 0:n.toNumber(a[3]));return n.getDomainCode(e,a[2])}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"domaincode",min:"2",max:"4"})),e.functions.text=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(n.pcCheck(r,1,2),!n.isFeatureSet(r[0]))return n.toStringExplicit(r[0],r[1]);var a=n.defaultUndefined(r[1],"");return""===a?r[0].castToText():"schema"===a.toLowerCase()?r[0].convertToText("schema",e.abortSignal):"featureset"===a.toLowerCase()?r[0].convertToText("featureset",e.abortSignal):void 0}))}}}.apply(null,n))||(e.exports=a)},769:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(13),r(98),r(1140),r(1141),r(1142)],void 0===(a=function(e,t,r,n,a,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,l=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function f(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function d(e,t,r,n,a,i,o,s,u){if(void 0===r&&(r="0"),void 0===n&&(n="0"),void 0===a&&(a="0"),void 0===i&&(i="0"),void 0===o&&(o=""),void 0===s&&(s="0"),void 0===u&&(u="0"),"+"===o||"-"===o){var l=f(parseInt(e,10),4)+"-"+f(parseInt(t,10),2)+"-"+f(parseInt(r,10),2),c="";parseFloat(i)<10&&(c="0");var p=f(parseInt(n,10),2)+":"+f(parseInt(a,10),2)+":"+(c+parseFloat(i).toString()),d=""+o+f(parseInt(s,10),2)+":"+f(parseInt(u,10),2);return new Date(l+"T"+p+d)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(a,10),parseFloat(i))}var h=function(){function e(){}return e.makeBool=function(e){return m(e)},e.featureValue=function(e,t,r,n){return E(e,t,r,n)},e.equalsNull=function(e){return null===e},e.applyLike=function(e,t,r){return x(e,t,r)},e.ensureArray=function(e){return _(e)},e.applyIn=function(e,t){return F(e,t)},e.currentDate=function(){var e=new Date;return e.setHours(0,0,0,0),e},e.makeSqlInterval=function(e,t,r){return i.SqlInterval.createFromValueAndQualifer(e,t,r)},e.convertInterval=function(e){return e instanceof i.SqlInterval?e.valueInMilliseconds():e},e.currentTimestamp=function(){return new Date},e.compare=function(e,t,r){return T(e,t,r)},e.calculate=function(e,t,r){return C(e,t,r)},e.makeComparable=function(e){return I(e)},e.evaluateFunction=function(e,t){return i.evaluateFunction(e,t)},e.lookup=function(e,t){var r=t[e];return void 0===r?null:r},e.between=function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]},e.notbetween=function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]},e.ternaryNot=function(e){return S(e)},e.ternaryAnd=function(e,t){return b(e,t)},e.ternaryOr=function(e,t){return w(e,t)},e}(),y=function(){function e(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=o.WhereGrammar.parse(e);var r=this.extractExpressionInfo(t),n=r.isStandardized,a=r.isAggregate,i=r.referencedFieldNames;this.referencedFieldNames=i,this.isStandardized=n,this.isAggregate=a}return e.create=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0}),e.prototype.testSet=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);for(var n={},a=function(t){n[t]=e.map((function(e){return r.getAttribute(e,t)}))},i=0,o=this.fieldNames;i<o.length;i++)a(o[i]);return!!this.evaluateNode(this.parseTree,{attributes:n},t.defaultAttributeAdapter)},e.prototype.calculateValue=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);var n=this.evaluateNode(this.parseTree,e,r);return n instanceof i.SqlInterval?n.valueInMilliseconds()/864e5:n},e.prototype.calculateValueCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.calculateValue(e,n):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.testFeature=function(e,r){return void 0===r&&(r=t.defaultAttributeAdapter),!!this.evaluateNode(this.parseTree,e,r)},e.prototype.testFeatureCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.testFeature(e,n):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.push(t.name.toLowerCase())})),R(e)},e.prototype.getExpressions=function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var a=n.column,i=r+"-"+a;e.has(i)||e.set(i,{aggregateType:r,field:a})}}})),n.valuesOfMap(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.push(t.value.toLowerCase())})),R(e)},e.prototype.compileMe=function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(h)},e.prototype.extractExpressionInfo=function(e){var t=this,r=[],n=!0,o=!0;return this.visitAll(this.parseTree,(function(s){switch(s.type){case"column_ref":var u=e.get(s.column),l=u&&u.name;!u||"date"!==u.type&&"esriFieldTypeDate"!==u.type||(t.datefields[u.name]=1),void 0!==l?(r.push(l),s.column=l):r.push(s.column);break;case"function":var c=s.name,p=s.args.value.length;n&&(n=i.isStandardized(c,p)),o&&(o=a.isAggregate(c,p))}})),{referencedFieldNames:R(r),isStandardized:n,isAggregate:o}},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var a=n[r];this.visitAll(a,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var i=0,o=e.value;i<o.length;i++)a=o[i],this.visitAll(a,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNodeToJavaScript=function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{for(t="( ",n=0;n<e.clauses.length;n++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":for(var a="[",i=0,o=e.value;i<o.length;i++){var s=o[i];"["!==a&&(a+=","),a+=this.evaluateNodeToJavaScript(s)}return a+"]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+g(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+v(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)},e.prototype.evaluateNode=function(e,t,r){switch(e.type){case"interval":var n=this.evaluateNode(e.value,t,r);return i.SqlInterval.createFromValueAndQualifer(n,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var o=I(this.evaluateNode(e.operand,t,r)),s=0;s<e.clauses.length;s++)if(o===I(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(s=0;s<e.clauses.length;s++)if(m(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var u=[],l=0,c=e.value;l<c.length;l++){var p=c[l];u.push(this.evaluateNode(p,t,r))}return u;case"unary_expr":return S(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return b(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return w(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var f=_(this.evaluateNode(e.right,t,r));return F(this.evaluateNode(e.left,t,r),f);case"NOT IN":return f=_(this.evaluateNode(e.right,t,r)),S(F(this.evaluateNode(e.left,t,r),f));case"BETWEEN":var d=this.evaluateNode(e.left,t,r),h=this.evaluateNode(e.right,t,r);return null==d||null==h[0]||null==h[1]?null:d>=I(h[0])&&d<=I(h[1]);case"NOTBETWEEN":return d=this.evaluateNode(e.left,t,r),h=this.evaluateNode(e.right,t,r),null==d||null==h[0]||null==h[1]?null:d<I(h[0])||d>I(h[1]);case"LIKE":return x(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return S(x(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return T(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return C(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return g(e.value);case"timestamp":return v(e.value);case"current_time":var y=new Date;return"date"===e.mode&&y.setHours(0,0,0,0),y;case"column_ref":return E(t,e.column,this.datefields,r);case"function":var R=this.evaluateNode(e.args,t,r);return this.isAggregate?a.aggregateFunction(e.name,R):i.evaluateFunction(e.name,R)}throw new Error("Unsupported sql syntax "+e.type)},e}();function v(e){var t=u.exec(e);if(null!==t)return d(t[1],t[2],t[3],t[4],t[5],t[6]);if(null!==(t=l.exec(e)))return d(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);if(null!==(t=c.exec(e)))return d(t[1],t[2],t[3],t[4],t[5],"0",t[6],t[7],t[8]);if(null!==(t=p.exec(e)))return d(t[1],t[2],t[3],t[4],t[5]);if(null!==(t=s.exec(e)))return d(t[1],t[2],t[3]);throw new Error("SQL Invalid Timestamp")}function g(e){var t=s.exec(e);if(null===t)throw new Error("SQL Invalid Date");var r=t[1],n=t[2],a=t[3];return new Date(parseInt(r,10),parseInt(n,10)-1,parseInt(a,10))}function m(e){return!0===e}function _(e){return Array.isArray(e)?e:[e]}function S(e){return null!==e?!0!==e:null}function b(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function w(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function F(e,t){if(null==e)return null;for(var r=!1,n=0,a=t;n<a.length;n++){var i=a[n];if(null==i)r=null;else if(e===i){r=!0;break}}return r}function x(e,t,r){if(null==e)return null;for(var n=t,a=r,i="",o=0,s=0;s<n.length;s++){var u=n.charAt(s);switch(o){case 0:u===a?o=1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?i+="\\"+u:i+="%"===u?".*":"_"===u?".":u;break;case 1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?i+="\\"+u:i+=u,o=0}}return new RegExp("^"+i+"$").test(e)}function I(e){return e instanceof Date?e.valueOf():e}function T(e,t,r){if(null==t||null==r)return null;var n=I(t),a=I(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function R(e){for(var t=[],r={},n=0,a=e;n<a.length;n++){var i=a[n],o=i.toLowerCase();void 0===r[o]&&(t.push(i),r[o]=1)}return t}function C(e,t,r){if(t instanceof i.SqlInterval)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof i.SqlInterval)switch(e){case"+":return i.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return i.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof i.SqlInterval)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function E(e,t,r,n){var a=n.getAttribute(e,t);return null!=a&&1===r[t]?new Date(a):a}t.WhereClause=y,t.defaultAttributeAdapter={getAttribute:function(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}}.apply(null,n))||(e.exports=a)},770:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(14),r(8),r(240),r(6),r(261),r(28),r(851),r(1074)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t=l.parsePBFFeatureQuery(e.buffer,e.options);if(e.options&&"dehydrated"===e.options.type){var r=t;if(t.spatialReference=r.spatialReference.toJSON(),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=r.fields[n].toJSON()}return i.resolve(t)},e}(),p=function(e){function t(){var t=e.call(this)||this;return t._thread=void 0,o.open("PBFWorker",{strategy:"dedicated"}).then((function(e){void 0===t._thread?t._thread=e:e.close()})),t}return r(t,e),t.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},t.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?(t.sourceSpatialReference&&t.sourceSpatialReference instanceof s&&(t=n({},t,{sourceSpatialReference:t.sourceSpatialReference.toJSON()})),this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then((function(e){if(t&&"dehydrated"===t.type){var r=e;if(r.spatialReference=s.fromJSON(r.spatialReference),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=u.fromJSON(r.fields[n]);for(var i=r.spatialReference,o=0,l=r.features;o<l.length;o++){var c=l[o];c.uid=a.generateUID(),c.geometry&&(c.geometry.spatialReference=i)}}return e}))):i.resolve(l.parsePBFFeatureQuery(e,t)):i.resolve(null)},t}(c);t.PBFWorker=p,t.default=function(){return new c}}.apply(null,n))||(e.exports=a)},827:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(25),r(5),r(97),r(99),r(837),r(836)],void 0===(a=function(e,t,r,n,a,i,o,s,u){Object.defineProperty(t,"__esModule",{value:!0});var l=a.getLogger("esri.renderers.support.utils"),c={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},p={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function f(e,t,r){var n="";return 0===t?n="< ":t===r&&(n="> "),n+e}function d(e){var t=e.minValue,r=e.maxValue,n=e.isFirstBreak?"":"> ",a="percent-of-total"===e.normalizationType?"%":"";return n+(t=null==t?"":s.format(t))+a+" – "+(r=null==r?"":s.format(r))+a}function h(e,t){return"normalizationField"in e&&e.normalizationField?{type:"normalized-field",field:e.field,normalizationField:e.normalizationField}:"field"in e&&e.field?y(e.field):"valueExpression"in e&&e.valueExpression?{type:"expression",expression:e.valueExpression,title:e.valueExpressionTitle,returnType:t}:null}function y(e){return{type:"field",field:e}}t.meterIn={inches:i.convertUnit(1,"meters","inches"),feet:i.convertUnit(1,"meters","feet"),"us-feet":i.convertUnit(1,"meters","us-feet"),yards:i.convertUnit(1,"meters","yards"),miles:i.convertUnit(1,"meters","miles"),"nautical-miles":i.convertUnit(1,"meters","nautical-miles"),millimeters:i.convertUnit(1,"meters","millimeters"),centimeters:i.convertUnit(1,"meters","centimeters"),decimeters:i.convertUnit(1,"meters","decimeters"),meters:i.convertUnit(1,"meters","meters"),kilometers:i.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/i.lengthToDegrees(1,"meters")},t.timelineDateFormatOptions=o.convertDateFormatToIntlOptions("short-date"),t.createColorStops=function(e){var t=e.values,r=e.colors,n=e.labelIndexes,a=e.isDate,i=e.dateFormatOptions;return t.map((function(e,l){var c=null;if(!n||n.indexOf(l)>-1){var p;(p=a?o.formatDate(e,i):s.format(e))&&(c=f(p,l,t.length-1))}return new u({value:e,color:r[l],label:c})}))},t.updateColorStops=function(e){for(var t=e.stops,r=e.changes,n=e.isDate,a=e.dateFormatOptions,i=t.map((function(e){return e.value})),u=[],l=0,c=r;l<c.length;l++){var p=c[l];u.push(p.index),i[p.index]=p.value}var d=s.round(i,{indexes:u});t.forEach((function(e,r){if(e.value=i[r],null!=e.label){var u,l=null;(u=n?o.formatDate(d[r],a):s.format(d[r]))&&(l=f(u,r,t.length-1)),e.label=l}}))},t.createClassBreakLabel=d,t.setLabelsForClassBreaks=function(e){var t=e.classBreakInfos,r=e.normalizationType,n=[];if(t&&t.length)if("standard-deviation"!==e.classificationMethod)if(e.round){n.push(t[0].minValue);for(var a=0,i=t;a<i.length;a++){var o=i[a];n.push(o.maxValue)}n=s.round(n),t.forEach((function(e,t){e.label=d({minValue:0===t?n[0]:n[t],maxValue:n[t+1],isFirstBreak:0===t,normalizationType:r})}))}else t.forEach((function(e,t){e.label=d({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===t,normalizationType:r})}));else l.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")},t.updateClassBreak=function(e){if("standard-deviation"!==e.classificationMethod){var t=e.classBreaks,r=e.change,n=r.index,a=r.value,i=t.length,o=-1,s=-1;0===n?o=n:n===i?s=n-1:(s=n-1,o=n);var u=e.normalizationType,c=null;o>-1&&o<i&&((c=t[o]).minValue=a,c.label=d({minValue:c.minValue,maxValue:c.maxValue,isFirstBreak:0===o,normalizationType:u})),s>-1&&s<i&&((c=t[s]).maxValue=a,c.label=d({minValue:c.minValue,maxValue:c.maxValue,isFirstBreak:0===s,normalizationType:u}))}else l.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.")},t.calculateDateFormatInterval=function(e){for(var t=e.map((function(e){return new Date(e)})),r=t.length,n=1/0,a=null,i=0;i<r-1;i++){for(var o=t[i],s=[],u=1/0,l=null,p=i+1;p<r;p++){var f=t[p],d=(o.getFullYear()!==f.getFullYear()?"year":o.getMonth()!==f.getMonth()&&"month")||o.getDate()!==f.getDate()&&"day"||o.getHours()!==f.getHours()&&"hour"||o.getMinutes()!==f.getMinutes()&&"minute"||o.getSeconds()!==f.getSeconds()&&"second"||"millisecond",h=c[d];h<u&&(u=h,l=d),s.push(d)}u<n&&(n=u,a=l)}return a},t.createUniqueValueLabel=function(e){var t=e.value,r=e.domain,n=e.fieldInfo,a=e.dateFormatInterval,i=String(t),u=r&&"codedValues"in r&&r.codedValues?r.getName(t):null;return u?i=u:"number"==typeof t&&(i=n&&"date"===n.type?o.formatDate(t,a&&o.convertDateFormatToIntlOptions(p[a])):s.format(t)),i},t.getAttributes=function(e,t){var r=[];if("class-breaks"===e.type||"heatmap"===e.type)r.push(h(e,"number"));else if("unique-value"===e.type){var a=e.uniqueValueInfos[0],i=null;if(a&&a.value){var o=typeof e.uniqueValueInfos[0].value;"string"!==o&&"number"!==o||(i=o)}r.push(h(e,i)),[e.field2,e.field3].forEach((function(e){return e&&r.push(y(e))}))}else"dot-density"===e.type&&e.attributes.forEach((function(e){return r.push(h(e,"number"))}));var s=t?t(e):"visualVariables"in e?e.visualVariables:null;return s&&s.forEach((function(e){return r.push(h(e,"number"))})),n.unique(r.filter(Boolean),(function(e,t){return"field"===e.type&&"field"===t.type?e.field===t.field:"normalized-field"===e.type&&"normalized-field"===t.type?e.field===t.field&&e.normalizationField===t.normalizationField:"expression"===e.type&&"expression"===t.type&&e.expression===t.expression}))}}.apply(null,n))||(e.exports=a)},836:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(38),r(4),r(2),r(17)],void 0===(a=function(e,t,r,n,a,i,o,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.label=null,r.value=null,r}var i;return r(t,e),i=t,t.prototype.writeValue=function(e,t,r){t[r]=null==e?0:e},t.prototype.clone=function(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})},n([o.property({type:a,json:{type:[s.Integer],write:!0}})],t.prototype,"color",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({type:Number,json:{write:{allowNull:!0}}})],t.prototype,"value",void 0),n([o.writer("value")],t.prototype,"writeValue",null),i=n([o.subclass("esri.renderers.visualVariables.support.ColorStop")],t)}(o.declared(i.JSONSupport))}.apply(null,n))||(e.exports=a)},837:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(244)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=/^-?(\d+)(\.(\d+))?$/i;function a(e,t){return e-t}function i(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function o(e,t,r,n,a){var i=u(e,t,r,n),o=null==i.previous||i.previous<=a,s=null==i.next||i.next<=a;return o&&s||i.previous+i.next<=2*a}function s(e){var t=String(e),r=t.match(n);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){var a=t.split("e"),i=a[0],o=a[1];if(i&&o){var u=Number(i),l=Number(o),c=l>0;c||(l=Math.abs(l));var p=s(u);return c?(p.integer+=l,l>p.fractional?p.fractional=0:p.fractional-=l):(p.fractional+=l,l>p.integer?p.integer=1:p.integer-=l),p}}return{integer:0,fractional:0}}function u(e,t,r,n){var a,i={previous:null,next:null};if(null!=r){var o=t-r-(a=e-r);i.previous=Math.floor(Math.abs(100*o/a))}null!=n&&(o=n-t-(a=n-e),i.next=Math.floor(Math.abs(100*o/a)));return i}t.numDigits=s,t.percentChange=u,t.round=function(e,t){void 0===t&&(t={});var r=e.slice(0),n=t.tolerance,u=void 0===n?2:n,l=t.strictBounds,c=void 0!==l&&l,p=t.indexes,f=void 0===p?r.map((function(e,t){return t})):p;f.sort(a);for(var d=0;d<f.length;d++){var h=f[d],y=r[h],v=0===h?null:r[h-1],g=h===r.length-1?null:r[h+1],m=s(y).fractional;if(m){for(var _=0,S=!1,b=void 0;_<=m&&!S;){var w=i(y,_);S=o(y,b=c&&0===d?w[1]:w[0],v,g,u),_++}S&&(r[h]=b)}}return r};var l={maximumFractionDigits:20};t.format=function(e){return r.formatNumber(e,l)}}.apply(null,n))||(e.exports=a)},838:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(36),r(33),r(141),r(892),r(252)],void 0===(a=function(e,t,r,n,a,i,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;a.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||i.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},n))&&(t[r]=e)}}}}}},t.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",writer:function(e,t,r){t[r]=!e}}}},t.labelsVisible={type:Boolean,value:!0,json:{read:{source:"showLabels"},write:{target:"showLabels"}}},t.url={type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writer:n.write}}},t.legendEnabled={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}},t.elevationInfo={value:null,type:o,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}},t.readOnlyService=function(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}},t.opacity={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0}}}},t.opacityDrawingInfo=r({},t.opacity,{json:r({},t.opacity.json,{origins:{"web-document":r({},t.opacity.json.origins["web-document"],{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?s.transparencyToOpacity(t.layerDefinition.drawingInfo.transparency):void 0:s.transparencyToOpacity(t.drawingInfo.transparency)}}})})}.apply(null,n))||(e.exports=a)},851:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(18),r(4),r(2),r(17),r(249),r(248)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l){var c=new a.default({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});return function(e){function t(t){var r=e.call(this,t)||this;return r.alias=null,r.defaultValue=void 0,r.description=null,r.domain=null,r.editable=!0,r.length=-1,r.name=null,r.nullable=!0,r.type=null,r.valueType=null,r}var a;return r(t,e),a=t,t.prototype.readDescription=function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(e){}return r?r.value:null},t.prototype.readValueType=function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(e){}return r?c.fromJSON(r.fieldValueType):null},t.prototype.clone=function(){return new a({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})},n([o.property({type:String,json:{write:!0}})],t.prototype,"alias",void 0),n([o.property({type:[String,Number],json:{write:{allowNull:!0}}})],t.prototype,"defaultValue",void 0),n([o.property()],t.prototype,"description",void 0),n([o.reader("description")],t.prototype,"readDescription",null),n([o.property({types:u.types,json:{read:{reader:u.fromJSON},write:!0}})],t.prototype,"domain",void 0),n([o.property({type:Boolean,json:{write:!0}})],t.prototype,"editable",void 0),n([o.property({type:s.Integer,json:{write:!0}})],t.prototype,"length",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),n([o.property({type:Boolean,json:{write:!0}})],t.prototype,"nullable",void 0),n([o.enumeration.serializable()(l.kebabDict)],t.prototype,"type",void 0),n([o.property()],t.prototype,"valueType",void 0),n([o.reader("valueType",["description"])],t.prototype,"readValueType",null),a=n([o.subclass("esri.layers.support.Field")],t)}(o.declared(i.JSONSupport))}.apply(null,n))||(e.exports=a)},853:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(32),r(18),r(4),r(3),r(2)],void 0===(a=function(e,t,r,n,a,i,o,s,u){Object.defineProperty(t,"__esModule",{value:!0});var l=new i.default({upperLeft:"upper-left",lowerLeft:"lower-left"}),c=function(e){function t(t){var r=e.call(this,t)||this;return r.extent=null,r.mode="view",r.originPosition="upper-left",r.tolerance=1,r}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i(s.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))},n([u.property({type:a.Extent,json:{write:!0}})],t.prototype,"extent",void 0),n([u.property({type:["view","edit"],json:{write:!0}})],t.prototype,"mode",void 0),n([u.property({type:String,json:{read:l.read,write:l.write}})],t.prototype,"originPosition",void 0),n([u.property({type:Number,json:{write:!0}})],t.prototype,"tolerance",void 0),i=n([u.subclass("esri.tasks.support.QuantizationParameters")],t)}(u.declared(o.JSONSupport));t.default=c}.apply(null,n))||(e.exports=a)},856:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(9),r(6),r(2),r(104),r(141),r(838)],void 0===(a=function(e,t,n,a,i,o,s,u,l,c){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationalLayer=function(e){return function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.title="Layer",t}return n(r,e),r.prototype.writeListMode=function(e,t,r,n){(n&&"ground"===n.layerContainerType||e&&l.willPropertyWrite(this,r,{},n))&&(t[r]=e)},r.prototype.writeTitle=function(e,t){t.title=e||"Layer"},r.prototype.writeOperationalLayerType=function(e,t){e&&(t.layerType=e)},r.prototype.read=function(e,t){var r=this,n=arguments;t&&(t.layer=this),u.readLoadable(this,e,(function(t){return r.inherited(n,[e,t])}),t)},r.prototype.write=function(e,r){if(r&&r.origin){var n=r.origin+"/"+(r.layerContainerType||"operational-layers"),a=t.supportedTypes[n],o=a&&a[this.operationalLayerType];if("write"!==o&&"readwrite"!==o)return r.messages&&r.messages.push(new i("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+n+"'",{layer:this})),null}var s=this.inherited(arguments,[e,r]),u=!!r&&!!r.messages&&!!r.messages.filter((function(e){return e instanceof i&&"web-document-write:property-required"===e.name})).length;return!this.url&&u?null:s},a([s.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"id",void 0),a([s.property({json:{write:{ignoreOrigin:!0}}})],r.prototype,"listMode",void 0),a([s.writer("listMode")],r.prototype,"writeListMode",null),a([s.property({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"title",void 0),a([s.writer("title")],r.prototype,"writeTitle",null),a([s.property({type:String,readOnly:!0,json:{write:{target:"layerType",ignoreOrigin:!0}}})],r.prototype,"operationalLayerType",void 0),a([s.writer("operationalLayerType")],r.prototype,"writeOperationalLayerType",null),a([s.property(c.opacity)],r.prototype,"opacity",void 0),a([s.property({type:Boolean,json:{read:{source:"visibility"},write:{target:"visibility"},origins:{"web-document":{read:{source:"visibility"},write:{target:"visibility"},default:!0}}}})],r.prototype,"visible",void 0),a([s.subclass("esri.layers.mixins.OperationalLayer")],r)}(s.declared(e))},t.typeModuleMap={ArcGISFeatureLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(6),r.e(98)]).then(function(){var t=[r(904)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISImageServiceLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(3),r.e(7),r.e(11),r.e(63)]).then(function(){var t=[r(1011)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISImageServiceVectorLayer:function(){return o.resolve(null)},ArcGISMapServiceLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(9),r.e(80)]).then(function(){var t=[r(1006)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISSceneServiceLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(6),r.e(85)]).then(function(){var t=[r(1014)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISStreamLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(22)]).then(function(){var t=[r(1018)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISTiledElevationServiceLayer:function(){return o.create((function(e){return r.e(14).then(function(){var t=[r(768)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISTiledImageServiceLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(9),r.e(28)]).then(function(){var t=[r(890)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},ArcGISTiledMapServiceLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(9),r.e(28)]).then(function(){var t=[r(890)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},BingMapsAerial:function(){return o.create((function(e){return r.e(17).then(function(){var t=[r(840)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},BingMapsRoad:function(){return o.create((function(e){return r.e(17).then(function(){var t=[r(840)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},BingMapsHybrid:function(){return o.create((function(e){return r.e(17).then(function(){var t=[r(840)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},BuildingSceneLayer:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(20)]).then(function(){var t=[r(1015)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},CSV:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(5),r.e(6),r.e(87)]).then(function(){var t=[r(1009)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},GeoRSS:function(){return o.create((function(e){return r.e(103).then(function(){var t=[r(1010)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},GroupLayer:function(){return o.create((function(e){return r.e(112).then(function(){var t=[r(1007)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},IntegratedMeshLayer:function(){return o.create((function(e){return r.e(96).then(function(){var t=[r(1012)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},KML:function(){return o.create((function(e){return Promise.all([r.e(1),r.e(2),r.e(27)]).then(function(){var t=[r(1016)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},OpenStreetMap:function(){return o.create((function(e){return r.e(97).then(function(){var t=[r(1013)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},PointCloudLayer:function(){return o.create((function(e){return r.e(21).then(function(){var t=[r(1017)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},VectorTileLayer:function(){return o.create((function(e){return Promise.all([r.e(15),r.e(25)]).then(function(){var t=[r(1019)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},WebTiledLayer:function(){return o.create((function(e){return r.e(99).then(function(){var t=[r(1004)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},WFS:function(){return o.resolve(null)},WMS:function(){return o.create((function(e){return r.e(30).then(function(){var t=[r(1020)];e.apply(null,t)}.bind(this)).catch(r.oe)}))},RasterDataLayer:function(){return o.resolve(null)},RasterDataElevationLayer:function(){return o.resolve(null)}},t.supportedTypes={"web-scene/operational-layers":{ArcGISFeatureLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISSceneServiceLayer:"readwrite",ArcGISTiledElevationServiceLayer:"read",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",BuildingSceneLayer:"readwrite",GroupLayer:"readwrite",IntegratedMeshLayer:"readwrite",PointCloudLayer:"readwrite",WebTiledLayer:"readwrite",CSV:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",KML:"readwrite",RasterDataLayer:"readwrite"},"web-scene/basemap":{ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",WebTiledLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",WMS:"readwrite",ArcGISMapServiceLayer:"readwrite"},"web-scene/ground":{ArcGISTiledElevationServiceLayer:"readwrite",RasterDataElevationLayer:"readwrite"},"web-map/operational-layers":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISStreamLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",ArcGISFeatureLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite",CSV:"readwrite",GeoRSS:"readwrite",KML:"readwrite",VectorTileLayer:"readwrite",WFS:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite"},"web-map/basemap":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite"}}}.apply(null,n))||(e.exports=a)},891:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(32),r(32),r(142),r(100),r(18),r(4),r(3),r(2),r(17),r(35),r(143),r(853),r(896)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y,v){var g=new u.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new u.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cacheHint=!1,r.datumTransformation=null,r.distance=void 0,r.gdbVersion=null,r.geometry=null,r.geometryPrecision=void 0,r.groupByFieldsForStatistics=null,r.having=null,r.historicMoment=null,r.maxAllowableOffset=void 0,r.maxRecordCountFactor=1,r.multipatchOption=null,r.num=void 0,r.objectIds=null,r.orderByFields=null,r.outFields=null,r.outSpatialReference=null,r.outStatistics=null,r.parameterValues=null,r.pixelSize=null,r.quantizationParameters=null,r.rangeValues=null,r.relationParameter=null,r.resultType=null,r.returnCentroid=!1,r.returnDistinctValues=!1,r.returnExceededLimitFeatures=!0,r.returnGeometry=!1,r.returnQueryGeometry=!1,r.returnM=void 0,r.returnZ=void 0,r.source=null,r.spatialRelationship="intersects",r.start=void 0,r.sqlFormat=null,r.text=null,r.timeExtent=null,r.units=null,r.where=null,r}var u;return r(t,e),u=t,t.from=function(e){return f.ensureClass(u,e)},t.prototype.castDatumTransformation=function(e){return"number"==typeof e||"object"==typeof e?e:null},t.prototype.writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.writeParameterValues=function(e,t){if(e){var r={};for(var n in e){var a=e[n];Array.isArray(a)?r[n]=a.map((function(e){return e instanceof Date?e.getTime():e})):a instanceof Date?r[n]=a.getTime():r[n]=a}t.parameterValues=r}},t.prototype.writeStart=function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"},t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.clone=function(){return new u(c.clone({cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},t.MAX_MAX_RECORD_COUNT_FACTOR=5,n([p.property({type:Boolean,json:{write:!0,default:!1}})],t.prototype,"cacheHint",void 0),n([p.property({json:{write:!0}})],t.prototype,"datumTransformation",void 0),n([p.cast("datumTransformation")],t.prototype,"castDatumTransformation",null),n([p.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([p.property({types:i.geometryTypes,json:{read:d.fromJSON,write:!0}})],t.prototype,"geometry",void 0),n([p.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"groupByFieldsForStatistics",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"having",void 0),n([p.property({type:Date})],t.prototype,"historicMoment",void 0),n([p.writer("historicMoment")],t.prototype,"writeHistoricMoment",null),n([p.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([p.property({type:Number,cast:function(e){return e<1?1:e>u.MAX_MAX_RECORD_COUNT_FACTOR?u.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],t.prototype,"maxRecordCountFactor",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"multipatchOption",void 0),n([p.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([p.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"orderByFields",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([p.property({type:a.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([p.property({type:[v],json:{write:!0}})],t.prototype,"outStatistics",void 0),n([p.property({json:{write:!0}})],t.prototype,"parameterValues",void 0),n([p.writer("parameterValues")],t.prototype,"writeParameterValues",null),n([p.property({types:o.symbolTypes,json:{read:h.read,write:!0}})],t.prototype,"pixelSize",void 0),n([p.property({type:y.default,json:{write:!0}})],t.prototype,"quantizationParameters",void 0),n([p.property({type:[Object],json:{write:!0}})],t.prototype,"rangeValues",void 0),n([p.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],t.prototype,"relationParameter",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"resultType",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnCentroid",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnDistinctValues",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:!e}}}}})],t.prototype,"returnExceededLimitFeatures",void 0),n([p.property({type:Boolean,json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnQueryGeometry",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnM",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnZ",void 0),n([p.property({json:{write:!0}})],t.prototype,"source",void 0),n([p.property({type:String,json:{read:{source:"spatialRel",reader:g.read},write:{target:"spatialRel",writer:g.write}}})],t.prototype,"spatialRelationship",void 0),n([p.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([p.writer("start"),p.writer("num")],t.prototype,"writeStart",null),n([p.property({type:String,json:{write:!0}})],t.prototype,"sqlFormat",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),n([p.property({type:s,json:{write:!0}})],t.prototype,"timeExtent",void 0),n([p.property({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),n([p.property({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],t.prototype,"where",void 0),n([p.writer("where")],t.prototype,"writeWhere",null),u=n([p.subclass("esri.tasks.support.Query")],t)}(p.declared(l.JSONSupport))}.apply(null,n))||(e.exports=a)},892:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(10),r(11),r(18),r(4),r(15),r(2),r(894),r(895)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p){var f=o.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),d=new o.JSONMap({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offset=null,t}var a;return r(t,e),a=t,t.prototype.readFeatureExpressionInfo=function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0},t.prototype.writeFeatureExpressionInfo=function(e,t,r,n){t[r]=e.write(null,n),"0"===e.expression&&(t.featureExpression={value:0})},Object.defineProperty(t.prototype,"mode",{get:function(){return this._isOverridden("mode")?this._get("mode"):u.isSome(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unit",{set:function(e){this._set("unit",e)},enumerable:!0,configurable:!0}),t.prototype.write=function(){return this.offset||this.mode||this.featureExpressionInfo||this.unit?this.inherited(arguments):null},t.prototype.clone=function(){return new a({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})},n([l.property({type:c,json:{write:!0}})],t.prototype,"featureExpressionInfo",void 0),n([l.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t.prototype,"readFeatureExpressionInfo",null),n([l.writer("featureExpressionInfo",{featureExpressionInfo:{type:c},"featureExpression.value":{type:[0]}})],t.prototype,"writeFeatureExpressionInfo",null),n([l.property({type:f.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:f.jsonValues,read:f.read,write:{writer:f.write,isRequired:!0}}})],t.prototype,"mode",null),n([l.property({type:Number,json:{write:!0}})],t.prototype,"offset",void 0),n([l.property({type:p.supportedUnits,json:{type:String,read:d.read,write:d.write}})],t.prototype,"unit",null),a=n([l.subclass("esri.layers.support.ElevationInfo")],t)}(l.declared(s.JSONSupport))}.apply(null,n))||(e.exports=a)},893:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(10),r(11),r(51),r(9),r(5),r(15),r(6),r(146),r(148),r(28),r(37),r(31),r(1002),r(1003)],void 0===(a=function(e,t,r,n,a,i,o,s,u,l,c,p,f,d,h,y){Object.defineProperty(t,"__esModule",{value:!0});var v=o.getLogger("esri.geometry.support.normalizeUtils"),g={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new c({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator}),minus180Line:new c({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new c({paths:[[[180,-180],[180,180]]],spatialReference:p.WGS84}),minus180Line:new c({paths:[[[-180,-180],[-180,180]]],spatialReference:p.WGS84})}};function m(e){return"polygon"===e.type}function _(e){return m(e)?e.rings:e.paths}function S(e,t){return Math.ceil((e-t)/(2*t))}function b(e,t){for(var r=0,n=_(e);r<n.length;r++)for(var a=0,i=n[r];a<i.length;a++)i[a][0]+=t;return e}function w(e){for(var t=[],r=0,n=0,a=0;a<e.length;a++){for(var i=e[a],o=null,s=0;s<i.length;s++)o=i[s],t.push(o),0===s?n=r=o[0]:(r=Math.min(r,o[0]),n=Math.max(n,o[0]));o&&t.push([(r+n)/2,0])}return t}function F(e,t){if(!(e instanceof c||e instanceof l)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw v.error(r),new i(r)}for(var n=[],a=0,o=_(e);a<o.length;a++){var s=o[a],u=[];n.push(u),u.push([s[0][0],s[0][1]]);for(var p=0;p<s.length-1;p++){var f=s[p][0],d=s[p][1],h=s[p+1][0],y=s[p+1][1],g=Math.sqrt((h-f)*(h-f)+(y-d)*(y-d)),S=(y-d)/g,b=(h-f)/g,w=g/t;if(w>1){for(var F=1;F<=w-1;F++){var x=F*t,I=b*x+f,T=S*x+d;u.push([I,T])}var R=(g+Math.floor(w-1)*t)/2,C=b*R+f,E=S*R+d;u.push([C,E])}u.push([h,y])}}return m(e)?new l({rings:n,spatialReference:e.spatialReference}):new c({paths:n,spatialReference:e.spatialReference})}function x(e,t,r){if(t){var n=F(e,1e6);e=d.webMercatorToGeographic(n,!0)}return r&&(e=b(e,r)),e}function I(e,t,r){var n;if(Array.isArray(e))if((n=e[0])>t){var a=S(n,t);e[0]=n+a*(-2*t)}else n<r&&(a=S(n,r),e[0]=n+a*(-2*r));else(n=e.x)>t?(a=S(n,t),e=e.clone().offset(a*(-2*t),0)):n<r&&(a=S(n,r),e=e.clone().offset(a*(-2*r),0));return e}t.straightLineDensify=F,t.normalizeCentralMeridian=function e(t,i,o){return n(this,void 0,void 0,(function(){var n,p,v,m,w,F,T,R,C,E,N,A,D,k,P,O,M,L,j,G,B,q,U,V,W,z,J,Q,Z,Y,H,K,X,$,ee,te,re;return r(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],i)];for(n=i?i.url:a.geometryServiceUrl,E=0,N=[],A=[],D=0,k=t;D<k.length;D++)P=k[D],s.isNone(P)?A.push(P):(p||(p=P.spatialReference,v=f.getInfo(p),m=p.isWebMercator,w=g[T=m?102100:4326].maxX,F=g[T].minX,R=g[T].plus180Line,C=g[T].minus180Line),v?"mesh"===P.type?A.push(P):"point"===P.type?A.push(I(P.clone(),w,F)):"multipoint"===P.type?((O=P.clone()).points=O.points.map((function(e){return I(e,w,F)})),A.push(O)):"extent"===P.type?(L=P.clone(),M=L._normalize(!1,!1,v),A.push(M.rings?new l(M):M)):P.extent?(L=P.extent,j=S(L.xmin,F),B=0==(G=j*(2*w))?P.clone():b(P.clone(),G),L.offset(G,0),L.intersects(R)&&L.xmax!==w?(E=L.xmax>E?L.xmax:E,B=x(B,m),N.push(B),A.push("cut")):L.intersects(C)&&L.xmin!==F?(E=L.xmax*(2*w)>E?L.xmax*(2*w):E,B=x(B,m,360),N.push(B),A.push("cut")):A.push(B)):A.push(P.clone()):A.push(P));for(q=S(E,w),U=-90,V=q,W=new c;q>0;)z=360*q-180,W.addPath([[z,U],[z,-1*U]]),U*=-1,q--;return N.length>0&&V>0?[4,h.cut(n,N,W,o)]:[3,3];case 1:for(J=r.sent(),Q=function(e,t){for(var r=-1,n=function(n){for(var a=t.cutIndexes[n],i=t.geometries[n],o=_(i),s=function(e){var t=o[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,a=0;a<t.length;a++){var o=t[a][0];n=o>n?o:n}for(var s=-360*S(n=Number(n.toFixed(9)),180),u=0;u<t.length;u++){var l=i.getPoint(e,u);i.setPoint(e,u,l.clone().offset(s,0))}return!0}))},u=0;u<o.length;u++)s(u);if(a===r){if("polygon"===e[0].type)for(var l=0,c=_(i);l<c.length;l++){var p=c[l];e[a]=e[a].addRing(p)}else if(function(e){return"polyline"===e[0].type}(e))for(var f=0,d=_(i);f<d.length;f++){var h=d[f];e[a]=e[a].addPath(h)}}else r=a,e[a]=i},a=0;a<t.cutIndexes.length;a++)n(a);return e}(N,J),Z=[],Y=[],ee=0;ee<A.length;ee++)"cut"!==(te=A[ee])?Y.push(te):(re=Q.shift(),H=t[ee],s.isSome(H)&&"polygon"===H.type&&H.rings&&H.rings.length>1&&re.rings.length>=H.rings.length?(Z.push(re),Y.push("simplify")):Y.push(m?d.geographicToWebMercator(re):re));return Z.length?[4,y.simplify(n,Z,o)]:[2,Y];case 2:for(K=r.sent(),X=[],ee=0;ee<Y.length;ee++)"simplify"!==(te=Y[ee])?X.push(te):X.push(m?d.geographicToWebMercator(K.shift()):K.shift());return[2,X];case 3:for($=[],ee=0;ee<A.length;ee++)"cut"!==(te=A[ee])?$.push(te):(re=N.shift(),$.push(!0===m?d.geographicToWebMercator(re):re));return[2,u.resolve($)]}}))}))},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&f.getInfo(e.spatialReference);if(!n)return r;var a,i=n.valid,o=i[0],s=i[1],u=2*s,l=r.width,c=r.xmin,p=r.xmax;if(c=(t=[p,c])[0],p=t[1],"extent"===e.type||0===l||l<=s||l>u||c<o||p>s)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;a=w(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;a=w(e.paths);break;case"multipoint":a=e.points}for(var d=r.clone(),h=0;h<a.length;h++){var y=a[h][0];y<0?(y+=s,p=Math.max(y,p)):(y-=s,c=Math.min(y,c))}return d.xmin=c,d.xmax=p,d.width<l?(d.xmin-=s,d.xmax-=s,d):r},t.normalizeMapX=function(e,t){var r=f.getInfo(t);if(r){var n=r.valid,a=n[0],i=n[1],o=i-a;if(e<a)for(;e<a;)e+=o;if(e>i)for(;e>i;)e-=o}return e}}.apply(null,n))||(e.exports=a)},894:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(10),r(11),r(4),r(2),r(140)],void 0===(a=function(e,t,r,n,a,i,o,s,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return r(t,e),o=t,t.prototype.collectRequiredFields=function(e,t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return[2,u.collectArcadeFieldNames(e,t,this.expression)]}))}))},t.prototype.clone=function(){return new o({expression:this.expression,title:this.title})},n([s.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),o=n([s.subclass("esri.layers.support.FeatureExpressionInfo")],t)}(s.declared(o.JSONSupport))}.apply(null,n))||(e.exports=a)},895:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(827)],void 0===(a=function(e,t,r){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)},t.supportedUnits=((n=Object.keys(r.meterIn)).sort(),n)}.apply(null,n))||(e.exports=a)},896:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(18),r(4),r(3),r(2)],void 0===(a=function(e,t,r,n,a,i,o,s){var u=new a.default({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"});return function(e){function t(t){var r=e.call(this,t)||this;return r.maxPointCount=void 0,r.maxRecordCount=void 0,r.maxVertexCount=void 0,r.onStatisticField=null,r.outStatisticFieldName=null,r.statisticType=null,r.statisticParameters=null,r}var a;return r(t,e),a=t,t.prototype.writeStatisticParameters=function(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=o.clone(e))},t.prototype.clone=function(){return new a({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:o.clone(this.statisticParameters)})},n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxPointCount",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxRecordCount",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxVertexCount",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"outStatisticFieldName",void 0),n([s.property({type:String,json:{read:{source:"statisticType",reader:u.read},write:{target:"statisticType",writer:u.write}}})],t.prototype,"statisticType",void 0),n([s.property({type:Object})],t.prototype,"statisticParameters",void 0),n([s.writer("statisticParameters")],t.prototype,"writeStatisticParameters",null),a=n([s.subclass("esri.tasks.support.StatisticDefinition")],t)}(s.declared(i.JSONSupport))}.apply(null,n))||(e.exports=a)},900:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(13),r(50)],void 0===(a=function(e,t,r,n){var a=r("esri-text-decoder")?new TextDecoder("utf-8"):null,i=r("safari")||r("ios")?6:r("ff")?12:32;return function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=e?e.byteLength:0),this._tag=0,this._dataType=99,this.init(e,t,r,n)}return e.prototype.init=function(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n},e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.processMessageWithArgs=function(e,t,r,n){var a=this.getMessage(),i=e(a,t,r,n);return a.release(),i},e.prototype.processMessage=function(e){var t=this.getMessage(),r=e(t);return t.release(),r},e.prototype.getMessage=function(){var t=this._getLength(),r=e.pool.acquire();return r.init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r},e.prototype.release=function(){e.pool.release(this)},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var a=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*a,a*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*a}return this._pos=r,n},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if((r=Math.min(this._end,r))-t>i&&a){var n=e.subarray(t,r);return a.decode(n)}for(var o="",s="",u=t;u<r;++u){var l=e[u];128&l?s+="%"+l.toString(16):(o+=decodeURIComponent(s)+String.fromCharCode(l),s="")}return s.length&&(o+=decodeURIComponent(s)),o},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e.pool=new n(e,!1,(function(e){e._data=null,e._dataView=null})),e}()}.apply(null,n))||(e.exports=a)}}]);